!function(e,t,i){"use strict";var a,n,l,r=t.Lib.Util,s=t.$,c=(e.module("backendApp",["ngCookies","ui.router","ui.bootstrap","ui-notification","ui.grid","ui.grid.edit","ui.grid.resizeColumns","ui.grid.expandable","ui.grid.selection","ui.grid.treeView","ngTagsInput","ng.ueditor","datetime","dndLists"]),e.module("backendApp"));document.URL.indexOf("local.ycs.com")>-1||document.URL.indexOf("suadm.ycs.com")>-1?(a="http://api.ycs.com/",n="fs.ycs.com",l="1.70"):document.URL.indexOf("local165.ycs.com")>-1||document.URL.indexOf("adm165.ycs.com")>-1||document.URL.indexOf("suadm165.ycs.com")>-1?(a="http://api165.ycs.com/",n="fs.ycs.com",l="1.65"):document.URL.indexOf("1caishui.com")>-1?(a="http://api.1caishui.com/",n="fs.1caishui.com",l="1.65"):(a="http://api2.ycs.com:8080/",n="fs.ycs.com",l="api2"),c.constant("appSettings",{apiHost:a,fsHost:n,apiVer:l,appVer:"1.65"}),c.constant("fsErrorCode",{3101:"图片读取失败",3102:"文件规范配置已经存在",3103:"文件规范配置不存在",3104:"指定尺寸不存在",3105:"时间戳过期",3106:"不可信赖的客户端",3107:"图片像素超过限制",3108:"图片大小超过限制",3109:"图片类型不支持",3110:"拒绝处理请求",3111:"文件服务器未知错误",3112:"签名版本号错误"}),c.run(["$templateCache",function(e){e.put("ui-grid/ui-grid-filter","<div class='ui-grid-filter-container' ng-repeat='colFilter in col.filters' ng-class='{\"filtering\": colFilter.term && colFilter.term.toString().length > 0, \"ui-grid-filter-cancel-button-hidden\" : colFilter.disableCancelFilterButton === true }'><div ng-if='colFilter.type !== \"select\"'><input type='text' class='ui-grid-filter-input' ng-model='colFilter.term' ng-attr-placeholder='{{colFilter.placeholder || \"\"}}'><div class='ui-grid-filter-button' ng-click='colFilter.term = null' ng-if='!colFilter.disableCancelFilterButton'><i class='ui-grid-icon-cancel' ng-show='colFilter.term !== undefined && colFilter.term !== null && colFilter.term !== \"\"'>&nbsp;</i></div></div><div ng-if='colFilter.type === \"select\"'><select class='ui-grid-filter-select' ng-model='colFilter.term' ng-attr-placeholder='{{colFilter.placeholder || \"\"}}' ng-options='option.value as option.label for option in colFilter.selectOptions'><option value=''></option></select><div class='ui-grid-filter-button-select' ng-click='colFilter.term = null' ng-if='!colFilter.disableCancelFilterButton'><i class='ui-grid-icon-cancel' ng-show='colFilter.term !== undefined && colFilter.term != null'>&nbsp;</i></div></div></div>")}]),c.config(["$stateProvider","$urlRouterProvider","$rootScopeProvider","NotificationProvider","$httpProvider",function(e,t,i,a,n){n.defaults.withCredentials=!0,t.when("/service","/service/pack").when("/service/predefined","/service/predefined/specs").when("/system","/system/tag").when("/system/pages","/system/pages/sliderHome").when("/vendor","/vendor/corp").when("/cms","/cms/article").when("/ticket","/ticket/manage").when("/user","/user/info").when("/wechat","/wechat/client-service"),e.state("home",{url:"/home",templateUrl:"home.html"}).state("service",{url:"/service",views:{"":{},sidebarLeft:{templateUrl:"tpl/sidebar/sidebar-service.html"}}}).state("service.pack",{url:"/pack",views:{"@":{templateUrl:"tpl/service/service.html"},sidebarLeft:{templateUrl:"tpl/sidebar/sidebar-service.html"}}}).state("service.pack.edit",{url:"/edit/:serviceId",views:{"@":{templateUrl:"tpl/service/pack/edit.html",controller:["$scope","$stateParams",function(e,t){e.serviceId=t.serviceId}]},sidebarLeft:{templateUrl:"tpl/sidebar/sidebar-service.html"}}}).state("service.pack.supportRegion",{url:"/supportRegion/:serviceId",views:{"@":{templateUrl:"tpl/service/pack/supportRegion.html",controller:["$scope","$stateParams",function(e,t){e.serviceId=t.serviceId}]},sidebarLeft:{templateUrl:"tpl/sidebar/sidebar-service.html"}}}).state("service.item",{url:"/service/item",views:{"@":{templateUrl:"tpl/service/service-item.html"},sidebarLeft:{templateUrl:"tpl/sidebar/sidebar-service.html"}}}).state("service.item.edit",{url:"/edit/:itemId",views:{"@":{templateUrl:"tpl/service/serviceItem/edit.html",controller:["$scope","$stateParams",function(e,t){e.itemId=t.itemId}]},sidebarLeft:{templateUrl:"tpl/sidebar/sidebar-service.html"}}}).state("service.predefined",{url:"/predefined",views:{"@":{templateUrl:"tpl/service/predefined.html"},sidebarLeft:{templateUrl:"tpl/sidebar/sidebar-service.html"},"predefinedDetail@":{templateUrl:"tpl/service/predefined/specs.html"}}}).state("service.predefined.specs",{url:"/specs",views:{"@":{templateUrl:"tpl/service/predefined.html"},sidebarLeft:{templateUrl:"tpl/sidebar/sidebar-service.html"},"predefinedDetail@service.predefined.specs":{templateUrl:"tpl/service/predefined/specs.html"}}}).state("service.predefined.requirement",{url:"/requirement",views:{"@":{templateUrl:"tpl/service/predefined.html"},sidebarLeft:{templateUrl:"tpl/sidebar/sidebar-service.html"},"predefinedDetail@service.predefined.requirement":{templateUrl:"tpl/service/predefined/requirement.html"}}}).state("service.predefined.material",{url:"/material",views:{"@":{templateUrl:"tpl/service/predefined.html"},sidebarLeft:{templateUrl:"tpl/sidebar/sidebar-service.html"},"predefinedDetail@service.predefined.material":{templateUrl:"tpl/service/predefined/material.html"}}}).state("service.predefined.invoice",{url:"/invoice",views:{"@":{templateUrl:"tpl/service/predefined.html"},sidebarLeft:{templateUrl:"tpl/sidebar/sidebar-service.html"},"predefinedDetail@service.predefined.invoice":{templateUrl:"tpl/service/predefined/invoice.html"}}}).state("service.predefined.attention",{url:"/attention",views:{"@":{templateUrl:"tpl/service/predefined.html"},sidebarLeft:{templateUrl:"tpl/sidebar/sidebar-service.html"},"predefinedDetail@service.predefined.attention":{templateUrl:"tpl/service/predefined/attention.html"}}}).state("service.predefined.faq",{url:"/faq",views:{"@":{templateUrl:"tpl/service/predefined.html"},sidebarLeft:{templateUrl:"tpl/sidebar/sidebar-service.html"},"predefinedDetail@service.predefined.faq":{templateUrl:"tpl/service/predefined/faq.html"}}}).state("vendor",{url:"/vendor",views:{"":{},sidebarLeft:{templateUrl:"tpl/sidebar/sidebar-vendor.html"}}}).state("vendor.corp",{url:"/corp",views:{"@":{templateUrl:"tpl/vendor/vendor.html"},sidebarLeft:{templateUrl:"tpl/sidebar/sidebar-vendor.html"}}}).state("vendor.corp.edit",{url:"/edit/:vendorId",views:{"@":{templateUrl:"tpl/vendor/corp/index.html",controller:["$scope","$stateParams",function(e,t){e.vendorId=t.vendorId}]},sidebarLeft:{templateUrl:"tpl/sidebar/sidebar-vendor.html"}}}).state("vendor.corp.edit.modifyArea",{url:"/modifyArea",views:{"@":{templateUrl:"tpl/vendor/corp/modifyArea.html",controller:["$scope","$stateParams",function(e,t){e.srid=t.vendorId}]},sidebarLeft:{templateUrl:"tpl/sidebar/sidebar-vendor.html"}}}).state("vendor.corp.rating",{url:"/rating",views:{"@":{templateUrl:"tpl/vendor/rating.html"},sidebarLeft:{templateUrl:"tpl/sidebar/sidebar-vendor.html"}}}).state("vendor.notification",{url:"/notification",views:{"@":{templateUrl:"tpl/vendor/notification.html"},sidebarLeft:{templateUrl:"tpl/sidebar/sidebar-vendor.html"}}}).state("system",{url:"/system",views:{"":{},sidebarLeft:{templateUrl:"tpl/sidebar/sidebar-system.html"}}}).state("system.tag",{url:"/tag",views:{"@":{templateUrl:"tpl/system/tag.html"},sidebarLeft:{templateUrl:"tpl/sidebar/sidebar-system.html"}}}).state("system.category",{url:"/category",views:{"@":{templateUrl:"tpl/system/category.html"},sidebarLeft:{templateUrl:"tpl/sidebar/sidebar-system.html"}}}).state("system.pages",{url:"/pages",views:{"@":{templateUrl:"tpl/system/pages.html"},sidebarLeft:{templateUrl:"tpl/sidebar/sidebar-system.html"},"sliderDetail@":{templateUrl:"tpl/system/pages/sliders.html"}}}).state("system.pages.sliderHome",{url:"/sliderHome",views:{"@":{templateUrl:"tpl/system/pages.html"},sidebarLeft:{templateUrl:"tpl/sidebar/sidebar-system.html"},"sliderDetail@system.pages.sliderHome":{templateUrl:"tpl/system/pages/sliders.html"}}}).state("system.pages.sliderNews",{url:"/sliderNews",views:{"@":{templateUrl:"tpl/system/pages.html"},sidebarLeft:{templateUrl:"tpl/sidebar/sidebar-system.html"},"sliderDetail@system.pages.sliderNews":{templateUrl:"tpl/system/pages/sliders.html"}}}).state("cms",{url:"/cms",views:{"":{},sidebarLeft:{templateUrl:"tpl/sidebar/sidebar-cms.html"}}}).state("cms.article",{url:"/article",views:{"@":{templateUrl:"tpl/cms/article.html"},sidebarLeft:{templateUrl:"tpl/sidebar/sidebar-cms.html"}}}).state("cms.article.edit",{url:"/edit/:articleId",views:{"@":{templateUrl:"tpl/cms/article/edit.html",controller:["$scope","$stateParams",function(e,t){e.articleId=t.articleId}]},sidebarLeft:{templateUrl:"tpl/sidebar/sidebar-cms.html"}}}).state("cms.feed",{url:"/feed",views:{"@":{templateUrl:"tpl/cms/feed.html"},sidebarLeft:{templateUrl:"tpl/sidebar/sidebar-cms.html"}}}).state("cms.seofeed",{url:"/seofeed",views:{"@":{templateUrl:"tpl/cms/seofeed.html"},sidebarLeft:{templateUrl:"tpl/sidebar/sidebar-cms.html"}}}).state("cms.seofeed.edit",{url:"/edit/:articleId",views:{"@":{templateUrl:"tpl/cms/seo/edit.html",controller:["$scope","$stateParams",function(e,t){e.articleId=t.articleId}]},sidebarLeft:{templateUrl:"tpl/sidebar/sidebar-cms.html"}}}).state("cms.help",{url:"/help",views:{"@":{templateUrl:"tpl/cms/help.html"},sidebarLeft:{templateUrl:"tpl/sidebar/sidebar-cms.html"}}}).state("cms.help.edit",{url:"/edit/:helpId",views:{"@":{templateUrl:"tpl/cms/help/edit.html",controller:["$scope","$stateParams",function(e,t){e.helpId=t.helpId}]},sidebarLeft:{templateUrl:"tpl/sidebar/sidebar-cms.html"}}}).state("ticket",{url:"/ticket",views:{"":{},sidebarLeft:{templateUrl:"tpl/sidebar/sidebar-ticket.html"}}}).state("ticket.manage",{url:"/manage",views:{"@":{templateUrl:"tpl/ticket/ticket.html"},sidebarLeft:{templateUrl:"tpl/sidebar/sidebar-ticket.html"}}}).state("ticket.message",{url:"/message",views:{"@":{templateUrl:"tpl/ticket/message-list.html"},sidebarLeft:{templateUrl:"tpl/sidebar/sidebar-ticket.html"}}}).state("user",{url:"/user",views:{"":{},sidebarLeft:{templateUrl:"tpl/sidebar/sidebar-user.html"}}}).state("user.info",{url:"/info",views:{"@":{templateUrl:"tpl/user/user.html"},sidebarLeft:{templateUrl:"tpl/sidebar/sidebar-user.html"}}}).state("user.add",{url:"/add",views:{"@":{templateUrl:"tpl/user/add.html"},sidebarLeft:{templateUrl:"tpl/sidebar/sidebar-user.html"}}}).state("user.notification",{url:"/notification",views:{"@":{templateUrl:"tpl/user/notification.html"},sidebarLeft:{templateUrl:"tpl/sidebar/sidebar-user.html"}}}).state("wechat",{url:"/wechat",views:{"":{},sidebarLeft:{templateUrl:"tpl/sidebar/sidebar-wechat.html"}}}).state("wechat.client-service",{url:"/client-service",views:{"@":{templateUrl:"tpl/wechat/wechat.html"},sidebarLeft:{templateUrl:"tpl/sidebar/sidebar-wechat.html"}}}).state("wechat.add",{url:"/add",views:{"@":{templateUrl:"tpl/wechat/add.html"},sidebarLeft:{templateUrl:"tpl/sidebar/sidebar-wechat.html"}}}),t.otherwise("/home"),a.setOptions({delay:1500,startTop:10,startLeft:10,verticalSpacing:20,horizontalSpacing:20,positionX:"right",positionY:"bottom"})}]);var o=41;c.controller("winCtrl",["$scope","ycsApi","appSettings","$location","$cookies","$modal","$timeout","$rootScope",function(e,t,i,a,n,l,c,d){e.admin={},e.admin.username="unknown",e.apiVer=i.apiVer,e.appVer=i.appVer,e.updateAdminInfo=function(){var t=r.Data.get("ycsAdminUser","local");t&&(e.admin.username=t.username||"unknown",e.admin.adminId=t.id,e.admin.rank=t.rank)},e.resizeHeight=function(){s(".fixed-win-height").css("height",r.Win.h+"px"),s(".content-body-height").css("height",r.Win.h-o+"px")},e.logout=function(){var e="admin/user/loginout";t.post(e,{}),c(function(){n.remove("JSESSIONID"),r.Data.deleteStorage("ycsAdminUser","local"),window.location.replace("../index.html")},500)},e["goto"]=function(e){var t=a.absUrl(),i=t+"/"+e;window.location=i},e.updateAdminInfo(),e.chgPwd=function(t){var i=l.open({animation:!0,templateUrl:"tpl/modal/chgAdminPsw.html",controller:"chgAdminPswCtrl",size:"md",keyboard:!1,backdrop:"static",resolve:{}});i.result.then(function(t){e.logout()})},d.$on("$stateChangeStart",function(e,i,a,n,l){c(function(){t.checkUserInfo()},500)})}]),c.directive("winResize",["$window",function(e){var i={name:"watch",restrict:"A",link:function(i,a,n,l){var s=t.el(e);i.getWinMetrics=function(){return{w:r.Win.w,h:r.Win.h}},i.$watch(i.getWinMetrics,function(e,t){i.resizeHeight()},!0),s.bind("resize",function(){i.$apply()})}};return i}]),c.controller("chgAdminPswCtrl",["$scope","ycsApi","$modalInstance",function(e,t,i){e.needsLogout=!1,e.cred={},e.changeAdminCred=function(i){var a="admin/updateUserPassword",n={oldpassword:i.oldpassword,newpassword:i.newpassword,confirmpassword:i.confirmpassword};t.post(a,n,e.pswChanged)},e.pswChanged=function(t){t&&t.status&&"200"===t.status&&(e.needsLogout=!0)},e.toLogout=function(){i.close(!0),e.closePswModal()},e.closePswModal=function(){i.dismiss("cancel")}}])}(window.angular,window.Neo,window.CryptoJS),function(e,t){"use strict";var i=e.module("backendApp"),a=t.Lib.Util;t.$;i.factory("ycsApi",["appSettings","fsErrorCode","$http","Notification","$timeout","$cookies",function(e,t,i,n,l,r){var s={};return s.baseUrl=e.apiHost,s.getQueryUrl=function(e,t,i){var a=(t&&t.length>0?String(t):"")+(i&&i.length>0?":"+i+"/":"")+s.baseUrl+String(e);return a},s.fsUrl="http://"+e.fsHost+"/",s.getFsQueryUrl=function(e,t,i){var a=(t&&t.length>0?String(t):"")+(i&&i.length>0?":"+i+"/":"")+s.fsUrl+String(e);return a},s.get=function(e,t,a,n){if(this.checkUserInfo()){var l=s.getQueryUrl(e,a,n);i({method:"GET",url:l,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e){return e&&"200"===e.status?t&&"function"==typeof t&&t(e):s.errHandler(e),e}).error(function(){s.errHandler()})}},s.post=function(e,t,a,n,l,r){if("admin/user/login"===e||this.checkUserInfo()){var c=s.getQueryUrl(e,n,l);i({method:"POST",url:c,data:s.translateJSONparams(t),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e){return e&&"200"===e.status?a&&"function"==typeof a&&a(e):s.errHandler(e,r),e}).error(function(e){s.errHandler(e,r)})}},s.postForm=function(e,t,a,n,l,r){if(this.checkUserInfo()){var c=s.getQueryUrl(e,l,r);i({method:"POST",url:c,data:t,headers:{"Content-Type":void 0},transformRequest:function(e){var t=new FormData;return Object.keys(e).forEach(function(i){t.append(i,e[i])}),t}}).success(function(e){return e&&"200"===e.status?a&&"function"==typeof a&&a(e):n&&"function"==typeof n?n(e):s.errHandler(e),e}).error(function(e){s.errHandler(e,n)})}},s.postImage=function(e,t,a,l,r,c){if(this.checkUserInfo()){var o=s.getFsQueryUrl(e,r,c);n("开始上传"),i({method:"POST",url:o,data:t,headers:{"Content-Type":void 0},transformRequest:function(e){var t=new FormData;return Object.keys(e).forEach(function(i){t.append(i,e[i])}),t}}).success(function(e){return a&&"function"==typeof a&&a(e),e}).error(function(e){s.errHandler(e)})}},s.postFS=function(e,t,a,n,l,r){if(this.checkUserInfo()){var c=s.getFsQueryUrl(e,l,r);i({method:"POST",url:c,data:s.translateJSONparams(t),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e){return e&&"200"===e.status?a&&"function"==typeof a&&a(e):n&&"function"==typeof n?n(e):s.errHandler(e),e}).error(function(e){s.errHandler(e,n)})}},s.postToGetStream=function(e,t,a,n,l){if(this.checkUserInfo()){var r=s.getQueryUrl(e,n,l);i({method:"POST",url:r,data:s.translateJSONparams(t),responseType:"arraybuffer",headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e){return a(e),e}).error(function(e){s.errHandler(e)})}},s.errHandler=function(e,i){return 1034===Number(e.errorcode)?(s.forceLogout(),void n.error({message:e.errormsg,title:"ERROR: "+e.errorcode,delay:5e3})):3233===Number(e.errorcode)||3113===Number(e.errorcode)?(n.error({message:e.errormsg,title:"账户已存在",delay:5e3}),i&&"function"==typeof i&&i(e),e):(e&&e.errormsg&&e.errorcode?n.error({message:e.errormsg,title:"ERROR: "+e.errorcode,delay:5e3}):e&&e.errorcode?t[e.errorcode]&&t[e.errorcode].length>0?n.error({message:t[e.errorcode],title:"ERROR: "+e.errorcode,delay:5e3}):n.error({message:"ERROR:"+e.errorcode,delay:5e3}):window.console.warn("Oops, please check your requested URL"),void(i&&"function"==typeof i&&i(e)))},s.translateJSONparams=function(e){var t="",i=0;return Object.keys(e).forEach(function(a){t+=(i>0?"&":"")+String(a)+"="+encodeURIComponent(String(e[a])),i++}),t},s.checkUserInfo=function(){var e=a.Data.get("ycsAdminUser","local");return e&&e.username&&0!==e.username.length?!0:(s.forceLogout(),n.error({message:"会话已失效，请重新登录",delay:5e3}),!1)},s.forceLogout=function(){l(function(){r.remove("JSESSIONID"),a.Data.deleteStorage("ycsAdminUser","local"),window.location.replace("../index.html")},500)},s}])}(window.angular,window.Neo),function(e,t,i){"use strict";var a=i.Lib.Util,n=e.module("backendApp");n.controller("loginCtrl",["appSettings","$scope","ycsApi","Notification",function(e,t,i,n){var l=e.apiHost+"vc";t.vcImg="",t.refreshVC=function(){t.vcImg=l+"?ts="+(new Date).getTime()},t.checkLogin=function(e){if(!e)return void n.error("请正确填写用户名、密码和验证码");var a={username:e.username,password:e.password,validateCodeImg:e.validateCodeImg};i.post("admin/user/login",a,t.feedBack)},t.feedBack=function(e){e&&e.re&&a.Data.store("ycsAdminUser",a.Data.objToJSON(e.re),"local"),window.setTimeout(function(){window.location.replace("app/index.html")},500)},t.refreshVC()}])}(window.angular,window.CryptoJS,window.Neo),function(e,t){"use strict";var i=e.module("backendApp");i.controller("tagsCompoundCtrl",["$scope","tagsCmpInfo","ycsUtil","ycsApi","Notification","$modalInstance","$filter",function(t,i,a,n,l,r,s){t.tagsCmpInfo=i,t.isBulkEdit=i.isBulkEdit,t.currentSelected=e.copy(t.tagsCmpInfo.currentSelected,[]),t.ajaxUrl=i.ajaxUrl,t.sum={category:0,extend:0,general:0},t.qData={tagsInput:[]},t.loadTags=function(e){return s("filter")(t.tagList,{$:e})},t.renderTagList=function(e){t.tagList=[],e.re&&e.re.tags&&e.re.tags.length>0&&e.re.tags.forEach(function(e){t.tagList.push({text:e})})},t.getAllTags=function(){var e="admin/tag/getAllTag",i={};n.post(e,i,t.renderTagList)},t.updateSum=function(e,i){var a=t.tagCategoryArray.indexOf(e),n=t.tagExtendArray.indexOf(e),l=t.tagGeneralArray.indexOf(e);i?(t.sum.category+=a>-1?1:0,t.sum.extend+=n>-1?1:0,t.sum.general+=l>-1?1:0):(t.sum.category+=a>-1?-1:0,t.sum.extend+=n>-1?-1:0,t.sum.general+=l>-1?-1:0)},t.toggleSelected=function(e,i){var a=t.currentSelected.indexOf(e);-1===a?(t.currentSelected.push(e),t.updateSum(e,!0),i||t.qData.tagsInput.push({text:e})):(t.currentSelected.splice(a,1),t.updateSum(e,!1),i||t.qData.tagsInput.forEach(function(i,a){return i.text===e?void t.qData.tagsInput.splice(a,1):void 0}))},t.checkIfSelected=function(e){return-1===t.currentSelected.indexOf(e)?!1:!0},t.deleteTag=function(e){t.toggleSelected(e.text)},t.addedTag=function(e){t.toggleSelected(e.text,!0)},t.fillDataList=function(e){var i=e.re;t.tagCategory=i.sort,t.tagExtend=i.extend,t.tagGeneral=i.general,t.tagCategoryArray=[],t.tagCategory.forEach(function(e){t.tagCategoryArray.push(e.name)}),t.tagExtendArray=[],t.tagExtend.forEach(function(e){t.tagExtendArray.push(e.name)}),t.tagGeneralArray=[],t.tagGeneral.forEach(function(e){t.tagGeneralArray.push(e.name)}),t.currentSelected.length>0&&t.currentSelected.forEach(function(e){t.updateSum(e,!0),t.qData.tagsInput.push({text:e})})},t.fillExistingData=function(){t.getTagListGroup(),t.getAllTags()},t.getTagListGroup=function(){var e="admin/article/getTag",i={};n.post(e,i,t.fillDataList)},t.dataSaved=function(){r.close(t.tagsCmpInfo)},t.save=function(e){t.tagsCmpInfo.currentSelected=t.currentSelected,t.dataSaved()},t.bulkSave=function(e){if(t.ajaxUrl&&!(t.ajaxUrl.length<1)){t.tagsCmpInfo.currentSelected=t.currentSelected;var i=t.ajaxUrl,a={infoid:t.tagsCmpInfo.ids.join(","),ids:t.tagsCmpInfo.ids.join(","),serviceids:t.tagsCmpInfo.ids.join(",")};a.tag="",e.forEach(function(e,t){a.tag+=(t>0?",":"")+e.text}),n.post(i,a,t.dataSaved)}},t.cancel=function(){r.dismiss("cancel")},t.fillExistingData()}])}(window.angular,window.Neo),function(e,t){"use strict";var i=e.module("backendApp");i.factory("ycsUtil",["appSettings","fsErrorCode","ycsApi","Notification","$interval","$timeout",function(e,i,a,n,l,r){var s={};return s.spliter=function(e,t){return e.split(t)},s.sortByObjParameter=function(e,t,i){return!e||e.length<1?(window.console.warn("utilFactory.sortByObjParamete: `target` mush be an array"),e):t&&""!==String(t).trim()?(i?e.sort(function(e,i){return i[t]-e[t]}):e.sort(function(e,i){return e[t]-i[t]}),e):(window.console.warn("utilFactory.sortByObjParamete: Please provide a proper `parameter`"),e)},s.getAreaLabelByCode=function(e,i){if(!(!e||1e5>e||e>999999)){var a=1e4*~~(e/1e4),n=100*~~(e/100),l=e%1e4===0,r=e%100===0,s="";i=i||"";for(var c=t.Lib.Address,o=0;o<c.length;o++)if(c[o].c===a){if(s+=c[o].n,l)return s;for(var d=c[o].s,u=0;u<d.length;u++)if(d[u].c===n){if(s+=i+d[u].n,r)return s;for(var p=d[u].s,f=0;f<p.length;f++)if(p[f].c===e)return s+=i+p[f].n}}return s}},s.disableButton=function(e,t,i){if(e){var a=i&&i.length>0?i:"uploadBtnDisabled";t?e[a]=!0:e[a]=!1}},s.isFileError=function(e,t,a,r){i[r.errorcode]&&i[r.errorcode].length>0?n.error({message:i[r.errorcode],title:"ERROR: "+r.errorcode,delay:5e3}):n.error({message:"ERROR:"+r.errorcode,delay:5e3}),s.disableButton(t,!1,a),l.cancel(e)},s.loopCheckProgress=function(e,t,i){if(i&&i.re&&Number(i.re.progress)>=100){if(l.cancel(e),n.success("上传成功！"),!t||"function"!=typeof t)return i.re.url;t(i.re.url)}},s.returnImageUrl=function(e,t,i,n){var r="qryUploadResult.htm?progressId="+e,c=l(function(){a.postFS(r,{},s.loopCheckProgress.bind(this,c,t),s.isFileError.bind(this,c,i,n))},3e3)},s.imageUploaded=function(e){},s.uploadImage=function(t,i,l,c,o){if(t.size>5242880)return n.error({title:"图片太大了！",message:"图片大小超过系统限制",delay:5e3}),void r(function(){s.disableButton(c,!1,o)},800);var d=(new Date).valueOf()+""+~~(1e4+9e4*Math.random()),u="upload.htm?progressId="+d,p={photo:t,type:i,browserVer:"OTHER",domain:e.fsHost,keepFileName:0};a.postImage(u,p,this.commonFileUploaded),this.returnImageUrl(d,l,c,o)},s.returnFileUrl=function(e,t){var i="qryUploadResult.htm?progressId="+e,n=l(function(){a.postFS(i,{},s.loopCheckProgress.bind(this,n,t))},3e3)},s.commonFileUploaded=function(e){},s.uploadCommonFile=function(t,i,l,c,o){if(t.size>5242880)return n.error({title:"文件太大了！",message:"文件大小超过系统限制",delay:5e3}),void r(function(){s.disableButton(c,!1,o)},800);var d=(new Date).valueOf()+""+~~(1e4+9e4*Math.random()),u="uploadFile.htm?progressId="+d,p={file:t,type:"admcontract",subSavePath:"vendorcontract",browserVer:"OTHER",domain:e.fsHost,keepFileName:0};a.postImage(u,p,this.commonFileUploaded),l&&"function"==typeof l&&this.returnFileUrl(d,l)},s}]),i.directive("commonFileUpload",function(){var e={scope:!0,link:function(e,t,i,a){t.bind("change",function(t){var i=t.target.getAttribute("input-index"),a=t.target.files;e.$emit("commonFileSelected",a[0],i)})}};return e}),i.directive("imageUpload",["Notification",function(e){var t={scope:!0,link:function(t,i,a,n){i.bind("change",function(i){var n=i.target.files;t.checkSize=function(n){if(!(a.heightFixed||a.widthFixed||a.sizeMax||a.widthMax||a.heightMax))return void t.$emit("imageSelected",n,i.target);if(a.sizeMax&&Number(a.sizeMax)>0&&n.size>1048576*Number(a.sizeMax))return void e.warning({title:"图片太大了！",message:"你上传的图片大小超过了系统要求的 "+a.sizeMax+"M，请重新选择",delay:5e3});var l,r;if(!(a.heightFixed||a.widthFixed||a.widthMax||a.heightMax))return void t.$emit("imageSelected",n,i.target);if(a.heightFixed||a.widthFixed){var s={w:Number(a.widthFixed),h:Number(a.heightFixed)};l=window.URL||window.webkitURL,r=new Image,r.onload=function(){this.width!==s.w&&this.height!==s.h?e.warning({title:"图片尺寸不符",message:"你上传的图片尺寸（"+this.width+"x"+this.height+"）与系统要求不符，请重新选择",delay:5e3}):t.$emit("imageSelected",n,i.target)},r.src=l.createObjectURL(n)}else if(a.widthMax||a.heightMax){var c={w:Number(a.widthMax),h:Number(a.heightMax)};l=window.URL||window.webkitURL,r=new Image,r.onload=function(){this.width>c.w||this.height>c.h?e.warning({title:"图片尺寸过大",message:"你上传的图片尺寸（"+this.width+"x"+this.height+"）超过了系统要求，请重新选择",delay:5e3}):t.$emit("imageSelected",n,i.target)},r.src=l.createObjectURL(n)}else window.console.log("Image file error")},t.checkSize(n[0])})}};return t}]),i.directive("fileUpload",function(){var e={scope:!0,link:function(e,t,i,a){t.bind("change",function(t){for(var i=t.target.files,a=[],n=0;n<i.length;n++)a.push(i[n]);e.$emit("fileSelected",a)})}};return e}),i.directive("imagePreview",["$timeout",function(e){var t={restrict:"EA",link:function(t,i,a,n){t.readFile=function(e,i){var a=new FileReader;a.onload=function(e){t.img.previews[i]={fileIndex:i,imgDataURI:e.target.result}},a.readAsDataURL(e)},t.$on("sentToPreview",function(i,a,n){if(a){0===a.length?t.img.previews=[]:n&&t.img&&t.img.previews&&t.img.previews.length>0&&a.length<t.img.previews.length&&t.img.previews.splice(a.length-1,t.img.previews.length-a.length);for(var l=0;l<a.length;l++)t.readFile(a[l],l);e(function(){t.$apply()},1e3)}})}};return t}]),i.directive("alterFileUpload",function(){var e={scope:!0,link:function(e,t,i,a){t.bind("change",function(t){var i=t.target.files;e.$emit("alterfileSelected",i[0])})}};return e}),i.directive("alterImagePreview",["$timeout",function(e){var t={restrict:"EA",scope:!0,link:function(t,i,a,n){t.readFile=function(e){var i=new FileReader;i.onload=function(e){t.alterImg.preview={imgDataURI:e.target.result}},i.readAsDataURL(e)},t.$on("sentToAltPreview",function(i,a){return a?(t.readFile(a),void e(function(){t.$apply()},1e3)):void(t.alterImg.preview={})})}};return t}]),i.directive("selectLocation",["ycsApi",function(e){var i={name:"init",require:"?ngModel",restrict:"EA",templateUrl:"tpl/util/select-location.html",scope:!0,replace:!0,link:function(e,i,a,n){e.provinceList=[],e.cityList=[],e.districtList=[],e.provinceIndex=null,e.cityIndex=null,e.cityDisabled=!0,e.$watch("selectCity",function(t){e.cityList&&0!==e.cityList.length&&("number"==typeof t&&(e.cityCode=e.cityList[t].code,e.cityIndex=t,n.$setViewValue(e.cityCode)),e.getDistrictOpts())}),e.inputName="",a.$observe("inputName",function(t){e.inputName=t}),e.renderProvinceOpts=function(i){e.provinceList=[],t.Lib.Address.forEach(function(t,i){e.provinceList.push({name:t.n,code:t.c,index:i})})},e.refreshCities=function(){e.selectCity=null,e.cityIndex=null,e.cityDisabled=!0,e.provinceIndex=e.selectProvince,e.renderCityOpts(e.provinceIndex)},e.renderCityOpts=function(i){var a=[];a=t.Lib.Address[i].s,e.cityList=[],a.length>0&&(e.cityDisabled=!1,a.forEach(function(t,i){e.cityList.push({name:t.n,code:t.c,index:i})}))},e.getDistrictOpts=function(){if(e.districtList=[],"number"==typeof e.provinceIndex&&"number"==typeof e.cityIndex){var i=[];i=t.Lib.Address[e.provinceIndex].s[e.cityIndex].s,i.forEach(function(t,i){e.districtList.push({name:t.n,code:t.c,index:i})})}},n.$render=function(){var i=n.$modelValue,a=t.Lib.Address,l=1e4*~~(i/1e4);0===e.provinceList.length&&e.renderProvinceOpts();for(var r=0;r<a.length;r++)if(a[r].c===l){e.selectProvince=r,e.provinceIndex=r,e.cityDisabled=!1,e.refreshCities();for(var s=a[r].s,c=0;c<s.length;c++)if(s[c].c===i)return e.selectCity=c,void(e.cityIndex=c);return}},e.renderProvinceOpts()}};return i}]),i.directive("selectDistrict",["ycsApi",function(e){var i={name:"init",require:"?ngModel",restrict:"EA",templateUrl:"tpl/util/select-district.html",scope:!0,replace:!0,link:function(e,i,a,n){e.provinceList=[],e.cityList=[],e.districtList=[],e.provinceIndex=null,e.cityIndex=null,e.districtIndex=null,e.cityDisabled=!0,e.districtDisabled=!0,e.$watch("selectDistrict",function(t){e.districtList&&0!==e.districtList.length&&"number"==typeof t&&(e.districtCode=e.districtList[t].code,e.districtIndex=t,n.$setViewValue(e.districtCode))}),e.inputName="",a.$observe("inputName",function(t){e.inputName=t}),e.renderProvinceOpts=function(i){e.provinceList=[],t.Lib.Address.forEach(function(t,i){e.provinceList.push({name:t.n,code:t.c,index:i})})},e.refreshCities=function(){e.selectCity=null,e.cityIndex=null,e.cityDisabled=!0,e.districtDisabled=!0,e.provinceIndex=e.selectProvince,e.renderCityOpts(e.provinceIndex),e.districtCode=e.provinceList[e.selectProvince].code,n.$setViewValue(e.districtCode)},e.refreshDistricts=function(){e.selectDistrict=null,e.districtDisabled=!0,e.districtIndex=null,e.districtCode=null,e.cityIndex=e.selectCity,e.getDistrictOpts(),e.districtCode=e.cityList[e.selectCity].code,n.$setViewValue(e.districtCode)},e.renderCityOpts=function(i){var a=[];a=t.Lib.Address[i].s,e.cityList=[],a.length>0&&(e.cityDisabled=!1,a.forEach(function(t,i){e.cityList.push({name:t.n,code:t.c,index:i})}))},e.getDistrictOpts=function(){if(e.districtList=[],"number"==typeof e.provinceIndex&&"number"==typeof e.cityIndex){var i=[];i=t.Lib.Address[e.provinceIndex].s[e.cityIndex].s,i.length>0&&(e.districtDisabled=!1,i.forEach(function(t,i){e.districtList.push({name:t.n,code:t.c,index:i})}))}},n.$render=function(){var i=n.$modelValue;if(isNaN(i))return e.selectProvince=null,e.selectCity=null,e.selectDistrict=null,e.cityDisabled=!0,e.districtDisabled=!0,void delete e.districtCode;var a=t.Lib.Address,l=1e4*~~(i/1e4),r=100*~~(i/100),s=i%1e4===0,c=i%100===0;0===e.provinceList.length&&e.renderProvinceOpts();for(var o=0;o<a.length;o++)if(a[o].c===l){if(e.selectProvince=o,e.provinceIndex=o,e.cityDisabled=!1,e.refreshCities(),s)return;for(var d=a[o].s,u=0;u<d.length;u++)if(d[u].c===r){if(e.selectCity=u,e.cityIndex=u,e.districtDisabled=!1,e.refreshDistricts(e.cityIndex),c)return;for(var p=d[u].s,f=0;f<p.length;f++)if(p[f].c===i)return e.selectDistrict=f,void(e.districtIndex=f);return}return}},e.renderProvinceOpts()}};return i}]),i.directive("districtCheckboxes",["ycsApi",function(e){var i={name:"init",require:"?ngModel",restrict:"EA",templateUrl:"tpl/util/district-checkboxes.html",scope:!0,replace:!0,link:function(e,i,a,n){e.districtList=[],e.selectedDistricts=[],e.city=null,a.$observe("city",function(t){e.city=t,e.getDistOpts(t)}),e.checkAll=function(){e.selectedDistricts=[],e.districtList.forEach(function(t){e.selectedDistricts.push(t.code)}),n.$setViewValue(e.selectedDistricts)},e.checkIfSelected=function(t){return-1===e.selectedDistricts.indexOf(t)?!1:!0},e.toggleSelection=function(t){var i=e.selectedDistricts.indexOf(t.code);-1===i?e.selectedDistricts.push(t.code):e.selectedDistricts.splice(i,1),n.$setViewValue(e.selectedDistricts)},e.getDistOpts=function(i){i=Number(i);var n=1e4*~~(i/1e4);e.province=n;var l=t.Lib.Address;e.districtList=[];for(var r=0;r<l.length;r++)if(l[r].c===n)for(var s=l[r].s,c=0;c<s.length;c++)if(s[c].c===i)for(var o=s[c].s,d=0;d<o.length;d++)e.districtList.push({name:o[d].n,code:o[d].c,index:d});"true"===a.checkAll&&e.checkAll()},n.$render=function(){e.selectedDistricts=n.$modelValue}}};return i}])}(window.angular,window.Neo),function(e){"use strict";var t=e.module("backendApp");t.directive("integer",function(){return{require:"ngModel",link:function(e,t,i,a){a.$validators.integer=function(e,t){return a.$isEmpty(e)?!0:/^\-?\d+$/.test(t)?!0:!1}}}})}(window.angular),function(e,t){"use strict";var i=e.module("backendApp");i.controller("articleCtrl",["$scope","ycsUtil","ycsApi","uiGridConstants","Notification","$modal","$state",function(e,t,i,a,n,l,r){e.tempArray=[],e.isEditStatus=!1,e.loadingGrid=!0,e.toggleSelection=function(t){var i=e.tempArray.indexOf(t);-1===i?e.tempArray.push(t):e.tempArray.splice(i,1)},e.gridOptions={enableSorting:!0,enableFiltering:!0,flatEntityAccess:!0,onRegisterApi:function(t){e.gridApi=t,t.selection.on.rowSelectionChanged(e,function(t){e.toggleSelection(t.entity.articleid)}),t.selection.on.rowSelectionChangedBatch(e,function(t){t.forEach(function(t){e.toggleSelection(t.entity.articleid)})})},columnDefs:[{field:"articleid",displayName:"ID",width:100,type:"number",filter:{placeholder:"搜索..."},enableHiding:!1},{field:"articleid",displayName:"操作",width:80,enableHiding:!1,enableSorting:!1,enableFiltering:!1,enableColumnMenu:!1,cellClass:"text-center",headerCellClass:"text-center",cellTemplate:'<div class="ui-grid-cell-contents"><a ui-sref="cms.article.edit({articleId: COL_FIELD})">编辑</a></div>'
},{field:"title",displayName:"文章标题",filter:{placeholder:"搜索..."},enableHiding:!1},{field:"authorname",displayName:"作者",width:120,filter:{placeholder:"搜索..."},enableHiding:!1},{field:"source",displayName:"来源",filter:{placeholder:"搜索..."},enableHiding:!1},{field:"sourceurl",displayName:"原始链接",width:80,cellTemplate:'<div class="ui-grid-cell-contents"><a href="{{COL_FIELD}}" target="_blank" ng-if="COL_FIELD"><i class="fa fa-link"></i></a></div>',cellClass:"text-center",headerCellClass:"text-center",enableColumnMenu:!1,enableFiltering:!1,enableHiding:!1},{field:"username",displayName:"编辑",width:100,filter:{placeholder:"搜索..."},enableHiding:!1},{field:"status",displayName:"状态",filter:{type:a.filter.SELECT,selectOptions:[{value:"0",label:"未完成编辑"},{value:"2",label:"未发布"},{value:"4",label:"已发布"},{value:"6",label:"已撤稿"},{value:"8",label:"已删除"}]},width:100,cellClass:"text-center",headerCellClass:"text-center",enableHiding:!1,cellTemplate:'<div class="ui-grid-cell-contents"><span class="draft" ng-if="COL_FIELD === 0">未完成编辑</span><span class="unpublished" ng-if="COL_FIELD === 2">未发布</span><span class="published" ng-if="COL_FIELD === 4">已发布</span><span class="withdraw" ng-if="COL_FIELD === 6">已撤稿</span><span class="deleted" ng-if="COL_FIELD === 8">已删除</span></div>'},{field:"visits",displayName:"阅读数",type:"number",width:100,cellClass:"text-center",headerCellClass:"text-center",enableFiltering:!1,enableHiding:!1},{field:"modified",displayName:"最后更新时间",width:150,headerCellClass:"text-center",cellClass:"text-center time",filter:{placeholder:"搜索..."},enableHiding:!1},{field:"tag",displayName:"标签",filter:{placeholder:"搜索..."},enableHiding:!1}]},e.formatNumber=function(e){var t=Number(e);return t},e.clearAll=function(){e.gridApi.selection.clearSelectedRows(),e.tempArray=[],e.isEditStatus=!1},e.startToEditStatus=function(){e.isEditStatus=!0},e.statusChanged=function(t){n.success("已修改"),e.getExistingData()},e.editStatus=function(t){var a="admin/info/infoEditStatus",n={infoid:e.tempArray.join(","),status:Number(t)};i.post(a,n,e.statusChanged)},e.getExistingData=function(){e.loadingGrid=!0;var t="admin/article/getArticleList",a={pageSize:999999};i.post(t,a,e.fillExitingData)},e.fillExitingData=function(t){e.gridOptions.data=t.re.articleList,e.gridApi.selection.clearSelectedRows(),e.isEditStatus=!1,e.tempArray=[],e.loadingGrid=!1},e.addTagsCompound=function(){var t=l.open({animation:!0,templateUrl:"tpl/modal/addTags.html",size:"lg",backdrop:"static",controller:"tagsCompoundCtrl",resolve:{tagsCmpInfo:function(){return{currentSelected:[],ids:e.tempArray,ajaxUrl:"admin/info/infoEditTag",isBulkEdit:!0}}}});t.result.then(function(t){n.success("标签已更新"),e.getExistingData()})},e.getExistingData()}])}(window.angular,window.BASE64),function(e,t){"use strict";var i=e.module("backendApp");i.controller("articleEditCtrl",["$scope","ycsUtil","ycsApi","Notification","$modal","$state","$filter","$sce",function(t,i,a,n,l,r,s,c){t.sourceListOpts=[],t.isSureToPost=!1,t.editTime=!1,t.uploadBtnDisabled=!1,t.backToList=function(){r.go("cms.article")},t._ueditor={ueditorConfig:{enableContextMenu:!1,maximumWords:2e4},ueditorContent:"",ueditorHtml:""},t._ueditor.ready=function(e){},t._ueditor.updateHtml=function(){t._ueditor.ueditorHtml=c.trustAsHtml(t._ueditor.ueditorContent)},t.imageUploaded=function(e){t.qData.image=e,i.disableButton(t,!1)},t.uploadImage=function(e){i.uploadImage(e,"infotxt",t.imageUploaded,t)},t.$on("imageSelected",function(e,a){t.$apply(function(){t.uploadImage(a),i.disableButton(t,!0)})}),t.deleteImage=function(){delete t.qData.image},t.clearTime=function(){delete t.qData.postTime,t.editPostTime(!1)},t.updateTime=function(){t.qData.postTime=new Date},t.getSourceList=function(){var e="admin/info/sourceList",i={};a.post(e,i,t.renderSourceList)},t.renderSourceList=function(e){t.sourceList=e.re;var i=[];t.sourceList.forEach(function(e){i.push({value:e.id,label:e.name})}),t.sourceListOpts=i},t.editTags=function(){var e=l.open({animation:!0,templateUrl:"tpl/modal/addTags.html",size:"lg",backdrop:"static",controller:"tagsCompoundCtrl",resolve:{tagsCmpInfo:function(){return{currentSelected:t.qData.tagsInput,isBulkEdit:!1}}}});e.result.then(function(e){t.qData.tagsInput=e.currentSelected})},t.getExistingData=function(e){if(e=e||t.articleId,!e||"new"===e)return void t.fillExistingData();var i="admin/article/getDetail",n={id:t.articleId};a.post(i,n,t.fillExistingData)},t.fillExistingData=function(e){if(e&&e.re?t.qData=e.re.article:t.qData={},t.qData.tagsInput=[],"new"!==t.articleId){if(t._ueditor.ueditorContent=t.qData.content,t.qData.tag&&t.qData.tag.length>0){var a=i.spliter(t.qData.tag,",");a.forEach(function(e){e.length>0&&t.qData.tagsInput.push(e)})}t.qData.image&&t.qData.image.length>0&&(t.qData.image=t.qData.image[0]),4!==t.qData.status&&(t.editTime=!1)}},t.changePostStatus=function(e){t.isSureToPost=e},t.editPostTime=function(e){e&&(t.qData.postTime=new Date),t.editTime=e},t.statusChanged=function(){n.success("文章状态已更新！"),t.getExistingData()},t.changeStatus=function(i,n){var l="admin/article/updateArticle",r=e.copy(n,{});r.status=i,r.tag=n.tagsInput.join(","),r.content=t._ueditor.ueditorContent,r.id=Number(t.articleId),n.image&&n.image>0&&(r.image=n.image.join(",")),4===Number(i)&&(r.isrealtime=0),a.post(l,r,t.statusChanged)},t.dataSaved=function(e,i){n.success("文章保存成功！"),t.getExistingData(),e&&t.backToList()},t.save=function(e,i){var n,l=e;"new"===t.articleId?(n="admin/article/addArticle",l.status=0,l.isrealtime=0):(n="admin/article/updateArticle",l.id=Number(t.articleId),e.postTime?(l.isrealtime=1,l.released=s("date")(e.postTime,"yyyy-MM-dd HH:mm:ss")):(delete l.isrealtime,delete l.released)),e.image&&e.image>0&&(l.image=e.image.join(",")),l.tag=e.tagsInput.join(","),l.content=t._ueditor.ueditorContent,a.post(n,l,t.dataSaved.bind(this,i))},t.getExistingData(),t.getSourceList()}])}(window.angular,window.UE),function(e){"use strict";var t=e.module("backendApp");t.controller("feedCtrl",["$scope","ycsUtil","ycsApi","uiGridConstants","Notification","$modal",function(e,t,i,a,n,l){e.tempArray=[],e.loadingGrid=!0,e.uploadBtnDisabled=!1,e.csv={},e.toggleSelection=function(t){var i=e.tempArray.indexOf(t);-1===i?e.tempArray.push(t):e.tempArray.splice(i,1)},e.gridOptions={enableFiltering:!0,flatEntityAccess:!0,onRegisterApi:function(t){e.gridApi=t,t.selection.on.rowSelectionChanged(e,function(t){e.toggleSelection(t.entity.id)}),t.selection.on.rowSelectionChangedBatch(e,function(t){t.forEach(function(t){e.toggleSelection(t.entity.id)})})},columnDefs:[{field:"id",displayName:"ID",width:100,type:"number",filter:{placeholder:"搜索..."},enableHiding:!1},{field:"title",displayName:"文章标题",filter:{placeholder:"搜索..."},enableHiding:!1},{field:"webname",displayName:"采集网站",filter:{placeholder:"搜索..."},enableHiding:!1},{field:"sourcename",displayName:"来源",filter:{placeholder:"搜索..."},enableHiding:!1},{field:"authorname",displayName:"作者",width:120,filter:{placeholder:"搜索..."},enableHiding:!1},{field:"sourceurl",displayName:"原始链接",width:80,cellTemplate:'<div class="ui-grid-cell-contents"><a href="{{COL_FIELD}}" target="_blank" ng-if="COL_FIELD"><i class="fa fa-link"></i></a></div>',cellClass:"text-center",headerCellClass:"text-center",enableHiding:!1,enableFiltering:!1},{field:"username",displayName:"操作人",width:100,filter:{placeholder:"搜索..."},enableHiding:!1},{field:"status",displayName:"状态",filter:{type:a.filter.SELECT,selectOptions:[{value:"0",label:"未入库"},{value:"1",label:"已入库"},{value:"4",label:"已删除"}]},width:100,cellClass:"text-center",headerCellClass:"text-center",enableHiding:!1,cellTemplate:'<div class="ui-grid-cell-contents"><span class="intact" ng-if="COL_FIELD === 0">未入库</span><span class="imported" ng-if="COL_FIELD === 1">已入库</span><span class="deleted" ng-if="COL_FIELD === 4">已删除</span></div>'},{field:"created",displayName:"导入时间",width:150,headerCellClass:"text-center",cellClass:"text-center time",filter:{placeholder:"搜索..."},enableHiding:!1},{field:"tag",filter:{placeholder:"搜索..."},enableHiding:!1,displayName:"原文关键字/标签"}]},e.addToDatabase=function(){var t="admin/gather/storage",a={ids:e.tempArray.join(",")};i.post(t,a,e.getExistingData)},e.deleteData=function(){var t="admin/gather/delete",a={ids:e.tempArray.join(",")};i.post(t,a,e.getExistingData)},e.csvImported=function(i){if(i.re&&i.re.unImpRow&&i.re.unImpRow.length>0){var a="";i.re.unImpRow.forEach(function(e){a+="第"+e.rownum+"行 "+e.title+"\\n"}),n.warning({title:"部分数据未能成功导入",message:a,delay:8e3})}else n.success("数据已成功导入！"),t.disableButton(e,!1);e.csv={},e.getExistingData()},e.csvImportErr=function(i){t.disableButton(e,!1),i&&i.errormsg&&i.errorcode?n.error({message:i.errormsg,title:"ERROR: "+i.errorcode,delay:5e3}):n.error({message:"ERROR: "+i.errormsg,delay:5e3})},e.importCSV=function(t){var a="admin/csv/importArticle",n={file:t};i.postForm(a,n,e.csvImported,e.csvImportErr)},e.$on("commonFileSelected",function(i,a){e.$apply(function(){e.importCSV(a),t.disableButton(e,!0)})}),e.selectAll=function(){e.gridApi.selection.selectAllRows()},e.clearAll=function(){e.gridApi.selection.clearSelectedRows(),e.tempArray=[]},e.reverseSelection=function(){e.gridApi.selection.toggleRowSelection(),e.gridOptions.data.forEach(function(t){e.gridApi.selection.toggleRowSelection(t)})},e.fillExitingData=function(t){e.gridOptions.data=t.re.article,e.gridApi.selection.clearSelectedRows(),e.loadingGrid=!1},e.getExistingData=function(){var t="admin/gather/getArticleList",a={};i.post(t,a,e.fillExitingData),e.loadingGrid=!0},e.getExistingData()}])}(window.angular),function(e){"use strict";var t=e.module("backendApp");t.controller("helpCtrl",["$scope","ycsUtil","ycsApi","uiGridConstants","Notification","$modal",function(e,t,i,a,n,l){e.tempArray=[],e.isEditStatus=!1,e.loadingGrid=!0,e.toggleSelection=function(t){var i=e.tempArray.indexOf(t);-1===i?e.tempArray.push(t):e.tempArray.splice(i,1)},e.gridOptions={enableSorting:!0,enableFiltering:!0,flatEntityAccess:!0,onRegisterApi:function(t){e.gridApi=t,t.selection.on.rowSelectionChanged(e,function(t){e.toggleSelection(t.entity.id)}),t.selection.on.rowSelectionChangedBatch(e,function(t){t.forEach(function(t){e.toggleSelection(t.entity.id)})})},columnDefs:[{field:"id",displayName:"ID",width:100,type:"number",filter:{placeholder:"搜索..."},enableHiding:!1},{field:"id",displayName:"操作",width:80,enableHiding:!1,enableSorting:!1,enableFiltering:!1,enableColumnMenu:!1,cellClass:"text-center",headerCellClass:"text-center",cellTemplate:'<div class="ui-grid-cell-contents"><a ui-sref="cms.help.edit({helpId: COL_FIELD})">编辑</a></div>'},{field:"title",displayName:"帮助标题",filter:{placeholder:"搜索..."},enableHiding:!1},{field:"category",displayName:"帮助分类",filter:{placeholder:"搜索..."},enableHiding:!1},{field:"username",displayName:"编辑",width:100,filter:{placeholder:"搜索..."},enableHiding:!1},{field:"status",displayName:"状态",width:100,filter:{type:a.filter.SELECT,selectOptions:[{value:"0",label:"未完成编辑"},{value:"4",label:"显示中"},{value:"6",label:"已隐藏"},{value:"8",label:"已删除"}]},cellClass:"text-center",headerCellClass:"text-center",enableHiding:!1,cellTemplate:'<div class="ui-grid-cell-contents"><span class="draft" ng-if="COL_FIELD === 0">未完成编辑</span><span class="show" ng-if="COL_FIELD === 4">显示中</span><span class="is-hidden" ng-if="COL_FIELD === 6">已隐藏</span><span class="deleted" ng-if="COL_FIELD === 8">已删除</span></div>'},{field:"visits",displayName:"阅读",type:"number",width:120,cellClass:"text-center",headerCellClass:"text-center",enableFiltering:!1,enableHiding:!1},{field:"useful",displayName:"有帮助",type:"number",width:100,cellClass:"text-center",headerCellClass:"text-center",enableFiltering:!1,enableHiding:!1},{field:"useless",displayName:"没有帮助",type:"number",width:100,cellClass:"text-center",headerCellClass:"text-center",enableFiltering:!1,enableHiding:!1},{field:"modified",displayName:"最后更新时间",width:150,headerCellClass:"text-center",cellClass:"text-center time",filter:{placeholder:"搜索..."},enableHiding:!1},{field:"tag",displayName:"标签",filter:{placeholder:"搜索..."},enableHiding:!1}]},e.clearAll=function(){e.gridApi.selection.clearSelectedRows(),e.tempArray=[],e.isEditStatus=!1},e.startToEditStatus=function(){e.isEditStatus=!0},e.editStatus=function(t){var a="admin/help/editBatchHelpArticle",n={ids:e.tempArray.join(","),status:Number(t),tag:""};i.post(a,n,e.getExistingData)},e.getExistingData=function(){e.loadingGrid=!0;var t="admin/help/qryHelpList",a={pageSize:999999};i.post(t,a,e.fillExitingData)},e.fillExitingData=function(t){e.gridOptions.data=t.re.helplists,e.gridApi.selection.clearSelectedRows(),e.isEditStatus=!1,e.tempArray=[],e.loadingGrid=!1},e.addTagsCompound=function(){var t=l.open({animation:!0,templateUrl:"tpl/modal/addTags.html",size:"lg",backdrop:"static",controller:"tagsCompoundCtrl",resolve:{tagsCmpInfo:function(){return{currentSelected:[],ids:e.tempArray,ajaxUrl:"admin/help/editBatchHelpArticle",isBulkEdit:!0}}}});t.result.then(function(t){n.success("标签已更新"),e.getExistingData()})},e.getExistingData()}])}(window.angular),function(e,t){"use strict";var i=e.module("backendApp");i.controller("helpEditCtrl",["$scope","ycsUtil","ycsApi","Notification","$modal","$state","$filter","$sce",function(t,i,a,n,l,r,s,c){t.sourceListOpts=[],t.backToList=function(){r.go("cms.help")},t.categoryListOpts=[{value:10,label:"购买指南"},{value:20,label:"订单相关"},{value:30,label:"支付相关"},{value:40,label:"服务及售后"},{value:50,label:"账户管理"},{value:60,label:"壹财税特色"},{value:70,label:"服务商帮助"},{value:80,label:"壹财税资讯"}],t._ueditor={ueditorConfig:{enableContextMenu:!1,maximumWords:2e4},ueditorContent:"",ueditorHtml:""},t._ueditor.ready=function(e){},t._ueditor.updateHtml=function(){t._ueditor.ueditorHtml=c.trustAsHtml(t._ueditor.ueditorContent)},t.editTags=function(){var e=l.open({animation:!0,templateUrl:"tpl/modal/addTags.html",size:"lg",backdrop:"static",controller:"tagsCompoundCtrl",resolve:{tagsCmpInfo:function(){return{currentSelected:t.qData.tagsInput,isBulkEdit:!1}}}});e.result.then(function(e){t.qData.tagsInput=e.currentSelected})},t.getExistingData=function(e){if(e=e||t.helpId,!e||"new"===e)return void t.fillExistingData();var i="admin/help/qryHelpArticleById",n={id:t.helpId};a.post(i,n,t.fillExistingData)},t.fillExistingData=function(e){if(e&&e.re?t.qData=e.re:t.qData={},t.qData.tagsInput=[],"new"!==t.helpId&&(t._ueditor.ueditorContent=t.qData.content,t.qData.tag&&t.qData.tag.length>0)){var a=i.spliter(t.qData.tag,",");a.forEach(function(e){e.length>0&&t.qData.tagsInput.push(e)})}},t.statusChanged=function(){n.success("帮助状态已更新！"),t.getExistingData()},t.changeStatus=function(i,n){var l="admin/help/editHelpArticle",r=e.copy(n,{});r.status=Number(i),r.tag=n.tagsInput.join(","),r.content=t._ueditor.ueditorContent,a.post(l,r,t.statusChanged)},t.dataSaved=function(e,i){n.success("帮助保存成功！"),t.getExistingData(),e&&t.backToList()},t.save=function(e,i){var n,l=e;"new"===t.helpId?(n="admin/help/addHelpArticle",l.status=0):(n="admin/help/editHelpArticle",l.id=Number(t.helpId)),l.tag=e.tagsInput.join(","),l.content=t._ueditor.ueditorContent,a.post(n,l,t.dataSaved.bind(this,i))},t.getExistingData()}])}(window.angular,window.UE),function(e,t){"use strict";var i=e.module("backendApp");i.controller("seoEditCtrl",["$scope","ycsUtil","ycsApi","Notification","$modal","$state","$filter","$sce",function(t,i,a,n,l,r,s,c){t.sourceListOpts=[],t.isSureToPost=!1,t.editTime=!1,t.uploadBtnDisabled=!1,t.backToList=function(){r.go("cms.seofeed")},t._ueditor={ueditorConfig:{enableContextMenu:!1,maximumWords:2e4},ueditorContent:"",ueditorHtml:""},t._ueditor.ready=function(e){},t._ueditor.updateHtml=function(){t._ueditor.ueditorHtml=c.trustAsHtml(t._ueditor.ueditorContent)},t.imageUploaded=function(e){t.qData.image=e,i.disableButton(t,!1)},t.uploadImage=function(e){i.uploadImage(e,"infotxt",t.imageUploaded,t)},t.$on("imageSelected",function(e,a){t.$apply(function(){t.uploadImage(a),i.disableButton(t,!0)})}),t.deleteImage=function(){delete t.qData.image},t.clearTime=function(){delete t.qData.postTime,t.editPostTime(!1)},t.updateTime=function(){t.qData.postTime=new Date},t.getSourceList=function(){var e="admin/info/sourceList",i={};a.post(e,i,t.renderSourceList)},t.renderSourceList=function(e){t.sourceList=e.re;var i=[];t.sourceList.forEach(function(e){i.push({value:e.id,label:e.name})}),t.sourceListOpts=i},t.editTags=function(){var e=l.open({animation:!0,templateUrl:"tpl/modal/addTags.html",size:"lg",backdrop:"static",controller:"tagsCompoundCtrl",resolve:{tagsCmpInfo:function(){return{currentSelected:t.qData.tagsInput,isBulkEdit:!1}}}});e.result.then(function(e){t.qData.tagsInput=e.currentSelected})},t.getExistingData=function(e){if(e=e||t.articleId,!e||"new"===e)return void t.fillExistingData();var i="admin/article/getDetail4Seo",n={id:t.articleId};a.post(i,n,t.fillExistingData)},t.fillExistingData=function(e){if(e&&e.re?t.qData=e.re.article:t.qData={},t.qData.tagsInput=[],"new"!==t.articleId){if(t._ueditor.ueditorContent=t.qData.content,t.qData.tag&&t.qData.tag.length>0){var a=i.spliter(t.qData.tag,",");a.forEach(function(e){e.length>0&&t.qData.tagsInput.push(e)})}t.qData.image&&t.qData.image.length>0&&(t.qData.image=t.qData.image[0]),4!==t.qData.status&&(t.editTime=!1)}},t.changePostStatus=function(e){t.isSureToPost=e},t.editPostTime=function(e){e&&(t.qData.postTime=new Date),t.editTime=e},t.statusChanged=function(){n.success("文章状态已更新！"),t.getExistingData()},t.changeStatus=function(i,n){var l="admin/article/updateArticle4Seo",r=e.copy(n,{});r.status=i,r.tag=n.tagsInput.join(","),r.content=t._ueditor.ueditorContent,r.id=Number(t.articleId),n.image&&n.image>0&&(r.image=n.image.join(",")),4===Number(i)&&(r.isrealtime=0),a.post(l,r,t.statusChanged)},t.articleDeleted=function(){n.success("文章已删除！"),r.go("cms.seofeed")},t.deleteArticle=function(e){var i="admin/article/batchDel4Seo",n={ids:Number(e)};a.post(i,n,t.articleDeleted)},t.dataSaved=function(e,i){n.success("文章保存成功！"),t.getExistingData(),e&&t.backToList()},t.save=function(e,i){var n,l=e;"new"===t.articleId?(n="admin/article/addArticle",l.status=0,l.isrealtime=0):(n="admin/article/updateArticle4Seo",l.id=Number(t.articleId),e.postTime?(l.isrealtime=1,l.released=s("date")(e.postTime,"yyyy-MM-dd HH:mm:ss")):(delete l.isrealtime,delete l.released)),e.image&&e.image>0&&(l.image=e.image.join(",")),l.tag=e.tagsInput.join(","),l.content=t._ueditor.ueditorContent,a.post(n,l,t.dataSaved.bind(this,i))},t.getExistingData(),t.getSourceList()}])}(window.angular,window.UE),function(e){"use strict";var t=e.module("backendApp");t.controller("seofeedCtrl",["$scope","ycsUtil","ycsApi","uiGridConstants","Notification","$modal",function(e,t,i,a,n,l){e.tempArray=[],e.isEditStatus=!1,e.loadingGrid=!0,e.uploadBtnDisabled=!1,e.toggleSelection=function(t){var i=e.tempArray.indexOf(t);-1===i?e.tempArray.push(t):e.tempArray.splice(i,1)},e.csv={},e.gridOptions={enableFiltering:!0,flatEntityAccess:!0,onRegisterApi:function(t){e.gridApi=t,t.selection.on.rowSelectionChanged(e,function(t){e.toggleSelection(t.entity.articleid)}),t.selection.on.rowSelectionChangedBatch(e,function(t){t.forEach(function(t){e.toggleSelection(t.entity.articleid)})})},columnDefs:[{field:"articleid",displayName:"ID",width:100,type:"number",filter:{placeholder:"搜索..."},enableHiding:!1},{field:"articleid",displayName:"操作",width:80,enableHiding:!1,enableSorting:!1,enableFiltering:!1,enableColumnMenu:!1,cellClass:"text-center",headerCellClass:"text-center",cellTemplate:'<div class="ui-grid-cell-contents"><a ui-sref="cms.seofeed.edit({articleId: COL_FIELD})">编辑</a></div>'},{field:"title",displayName:"文章标题",filter:{placeholder:"搜索..."},enableHiding:!1},{field:"authorname",displayName:"作者",width:120,filter:{placeholder:"搜索..."},enableHiding:!1},{field:"source",displayName:"来源",filter:{placeholder:"搜索..."},enableHiding:!1},{field:"sourceurl",displayName:"原始链接",width:80,cellTemplate:'<div class="ui-grid-cell-contents"><a href="{{COL_FIELD}}" target="_blank" ng-if="COL_FIELD"><i class="fa fa-link"></i></a></div>',cellClass:"text-center",headerCellClass:"text-center",enableHiding:!1,enableFiltering:!1},{field:"username",displayName:"操作人",width:100,filter:{placeholder:"搜索..."},enableHiding:!1},{field:"status",displayName:"状态",width:100,cellClass:"text-center",headerCellClass:"text-center",enableHiding:!1,enableSorting:!1,enableFiltering:!1,cellTemplate:'<div class="ui-grid-cell-contents"><span class="imported" ng-if="COL_FIELD === 4">已发布</span><span class="deleted" ng-if="COL_FIELD === 8">已删除</span></div>'},{field:"tag",displayName:"标签",filter:{placeholder:"搜索..."},enableHiding:!1}]},e.csvImported=function(i){if(i.re&&i.re.unImpRow&&i.re.unImpRow.length>0){var a="";i.re.unImpRow.forEach(function(e){a+="第"+e.rownum+"行 "+e.title+"\\n"}),n.warning({title:"部分数据未能成功导入",message:a,delay:8e3})}else n.success("数据已成功导入！"),t.disableButton(e,!1);e.csv={},e.getExistingData()},e.clearAll=function(){e.gridApi.selection.clearSelectedRows(),e.tempArray=[],e.isEditStatus=!1},e.startToEditStatus=function(){e.isEditStatus=!0},e.statusChanged=function(t){n.success("已修改"),e.getExistingData()},e.editStatus=function(t){var a="admin/article/batchDel4Seo",n={ids:e.tempArray.join(",")};i.post(a,n,e.statusChanged)},e.csvImportErr=function(i){t.disableButton(e,!1),i&&i.errormsg&&i.errorcode?n.error({message:i.errormsg,title:"ERROR: "+i.errorcode,delay:5e3}):n.error({message:"ERROR: "+i.errormsg,delay:5e3})},e.importCSV=function(t){var a="admin/csv/importArticle4Seo",n={file:t};i.postForm(a,n,e.csvImported,e.csvImportErr)},e.$on("commonFileSelected",function(i,a){e.$apply(function(){e.importCSV(a),t.disableButton(e,!0)})}),e.fillExitingData=function(t){e.gridOptions.data=t.re.articleList,e.gridApi.selection.clearSelectedRows(),e.isEditStatus=!1,e.tempArray=[],e.loadingGrid=!1},e.getExistingData=function(){var t="admin/article/getArticleList4Seo",a={pageSize:999999};i.post(t,a,e.fillExitingData),e.loadingGrid=!0},e.getExistingData()}])}(window.angular),function(e){"use strict";var t=e.module("backendApp");t.controller("categoryCtrl",["$scope","ycsUtil","ycsApi","Notification","$modal","uiGridTreeViewConstants",function(t,i,a,n,l,r){t.loadingGrid=!0,t.gridOptions={enableSorting:!0,enableFiltering:!0,flatEntityAccess:!0,showTreeExpandNoChildren:!1,treeRowHeaderAlwaysVisible:!1,columnDefs:[{field:"name",name:"分类名称",filter:{placeholder:"搜索..."},cellTemplate:'<div class="ui-grid-cell-contents" ng-class="{bold: row.entity.pid === -1}">{{COL_FIELD}}</div>',enableHiding:!1},{field:"code",type:"number",name:"编码",width:100,filter:{placeholder:"搜索..."},cellClass:"text-center",headerCellClass:"text-center",cellTemplate:'<div class="ui-grid-cell-contents" ng-class="{bold: row.entity.pid === -1}">{{COL_FIELD}}</div>',enableHiding:!1},{field:"tag",name:"绑定标签",filter:{placeholder:"搜索..."},cellTemplate:'<div class="ui-grid-cell-contents"><span ng-if="row.entity.pid !== -1">{{COL_FIELD}}</span><span ng-if="row.entity.pid === -1">—</span></div>',enableHiding:!1},{field:"sort",type:"number",name:"排序",width:80,enableFiltering:!1,cellClass:"text-center",headerCellClass:"text-center",cellTemplate:'<div class="ui-grid-cell-contents" ng-class="{bold: row.entity.pid === -1}">{{COL_FIELD}}</div>',enableHiding:!1},{field:"func",name:"操作",width:200,enableColumnMenu:!1,enableHiding:!1,enableFiltering:!1,headerCellClass:"text-center",cellClass:"text-center",cellTemplate:'<div class="ui-grid-cell-contents func"><a ng-if="row.entity.pid === -1" ng-click="grid.appScope.editSubCategory(\'\', \'add\')">增加子类</a><a ng-if="row.entity.pid !== -1" ng-click="grid.appScope.editSubCategory(row.entity.id, \'edit\')">编辑</a><a ng-if="row.entity.pid === -1" ng-click="grid.appScope.editCategory(row.entity.id, edit)">编辑</a><a class="link-delete" ng-click="grid.appScope.delCategory(row.entity.id)">删除</a></div>'}],onRegisterApi:function(e){t.gridApi=e}},t.expandAll=function(){t.gridApi.treeBase.expandAllRows()},t.collapseAll=function(){t.gridApi.treeBase.collapseAllRows()},t.toggleRow=function(e){t.gridApi.treeBase.toggleRowTreeState(t.gridApi.grid.renderContainers.body.visibleRowCache[e])},t.toggleExpandNoChildren=function(){t.gridOptions.showTreeExpandNoChildren=!t.gridOptions.showTreeExpandNoChildren,t.gridApi.grid.refresh()},t.getExistingData=function(){t.loadingGrid=!0;var e="admin/tag/qryParentSubSvicCategory",i={};a.post(e,i,t.fillExitingData)},t.editCategory=function(i,a){for(var n,r=0;r<t.allCateData.length;r++)if(t.allCateData[r].id===i){n=e.copy(t.allCateData[r],[]);break}var s=l.open({animation:!0,templateUrl:"tpl/modal/system/editCategory.html",size:"md",controller:"editCategoryModalCtrl",backdrop:"static",resolve:{categoryInfo:function(){return{func:a,id:i,data:n}}}});s.result.then(function(e){t.getExistingData()})},t.fillExitingData=function(e){var i=e.re.serviceParentSubCategoryList,a=[];t.allCateData=[];for(var n=0;n<i.length;n++){var l=1e3+1e3*n;a[l]=i[n],a[l].$$treeLevel=0,t.allCateData.push(i[n]);for(var r=i[n].subServiceList,s=0;s<r.length;s++){var c=l+s+1;a[c]=r[s],a[c].$$treeLevel=1,t.allCateData.push(r[s])}}t.tempArray=[],e.re.serviceParentSubCategoryList.forEach(function(e,i){t.tempArray.push({value:e.id,label:e.name})}),t.gridOptions.data=a,t.loadingGrid=!1},t.editSubCategory=function(i,a){for(var n,r=0;r<t.allCateData.length;r++)if(t.allCateData[r].id===i){n=e.copy(t.allCateData[r],[]);break}var s=l.open({animation:!0,templateUrl:"tpl/modal/system/editSubCategory.html",size:"md",controller:"editSubCategoryModalCtrl",backdrop:"static",resolve:{subCategoryInfo:function(){return{func:a,data:n,nameOpts:t.tempArray}}}});s.result.then(function(e){t.getExistingData()})},t.expandAllRows=function(){t.gridApi.expandable.expandAllRows()},t.collapseAllRows=function(){t.gridApi.expandable.collapseAllRows()},t.delCategory=function(e){var i="admin/tag/deleteServiceCategory",n={ids:e};a.post(i,n,t.getExistingData)},t.getExistingData()}]),t.controller("editCategoryModalCtrl",["$scope","categoryInfo","$modalInstance","ycsApi","Notification",function(t,i,a,n,l){t.categoryInfo=i,t.isEdit=!1,"add"===i.func?t.detail=[]:(t.isEdit=!0,t.detail=e.extend({},i.data)),t.dataSaved=function(){l.success("保存成功！"),a.close(i)},t.save=function(e){var i,a=e;i=t.isEdit?"admin/tag/updateServiceCategory":"admin/tag/addServiceCategory",n.post(i,a,t.dataSaved)},t.cancel=function(){a.dismiss("cancel")}}]),t.controller("editSubCategoryModalCtrl",["$scope","subCategoryInfo","$modalInstance","ycsApi","ycsUtil","Notification","$filter",function(t,i,a,n,l,r,s){if(t.subCategoryInfo=i,t.isEdit=!1,"add"===i.func)t.detail=[];else if(t.isEdit=!0,t.detail=e.extend({},i.data),t.detail.tagsInput=[],t.detail.tag&&t.detail.tag.length>0){var c=l.spliter(t.detail.tag,",");c.forEach(function(e){e.length>0&&t.detail.tagsInput.push({text:e})})}t.dataSaved=function(){r.success("保存成功！"),a.close(i)},t.save=function(e){var i="admin/tag/updateServiceCategory",a=e;a.tag="",a.tagsInput.forEach(function(e,t){a.tag+=(t>0?",":"")+e.text}),n.post(i,a,t.dataSaved)},t.cancel=function(){a.dismiss("cancel")},t.loadTags=function(e){return s("filter")(t.tagList,{$:e})},t.renderTagList=function(e){t.tagList=[],e.re&&e.re.tags&&e.re.tags.length>0&&e.re.tags.forEach(function(e){t.tagList.push({text:e})})},t.getAllTags=function(){var e="admin/tag/getAllTag",i={};n.post(e,i,t.renderTagList)},t.getAllTags()}])}(window.angular),function(e){"use strict";var t=e.module("backendApp");t.controller("tagCtrl",["$scope","ycsUtil","ycsApi","uiGridConstants","Notification","$modal","$rootScope",function(t,i,a,n,l,r,s){t.loadingGrid=!0,t.gridOptions={enableSorting:!0,enableFiltering:!0,flatEntityAccess:!0,columnDefs:[{field:"name",displayName:"标签",filter:{placeholder:"搜索..."},enableHiding:!1},{field:"typeid",displayName:"类型",width:120,filter:{type:n.filter.SELECT,selectOptions:[{value:1,label:"分类标签"},{value:2,label:"扩展标签"},{value:3,label:"一般标签"}]},cellClass:"text-center",headerCellClass:"text-center",cellTemplate:'<div class="ui-grid-cell-contents"><span class="" ng-if="COL_FIELD === 1">分类标签</span><span class="" ng-if="COL_FIELD === 2">扩展标签</span><span class="" ng-if="COL_FIELD === 3">一般标签</span></div>',enableHiding:!1},{field:"id",displayName:"编辑",width:80,cellClass:"text-center",headerCellClass:"text-center",enableColumnMenu:!1,enableFiltering:!1,enableHiding:!1,cellTemplate:'<div class="ui-grid-cell-contents"><a ng-click="grid.appScope.editData(COL_FIELD, edit)">编辑</a></div>'},{field:"username",displayName:"添加人",filter:{placeholder:"搜索..."},enableHiding:!1},{field:"tag",displayName:"统计",enableColumnMenu:!1,enableFiltering:!1,enableHiding:!1,cellTemplate:'<div class="ui-grid-cell-contents">服务({{row.entity.services}}), 文章({{row.entity.articles}}), 帮助({{row.entity.helps}})</div>'},{field:"visits",displayName:"相关页面浏览量",width:150,cellClass:"text-center",headerCellClass:"text-center",type:"number",enableFiltering:!1,enableHiding:!1},{field:"created",displayName:"添加日期",width:150,headerCellClass:"text-center",cellClass:"text-center time",filter:{placeholder:"搜索..."},enableHiding:!1},{field:"id",displayName:"操作",width:80,cellClass:"text-center",headerCellClass:"text-center",enableColumnMenu:!1,enableFiltering:!1,enableHiding:!1,cellTemplate:'<div class="ui-grid-cell-contents"><a class="link-delete" ng-click="grid.appScope.delData(COL_FIELD)">删除</a></div>'}]},t.getExistingData=function(){t.loadingGrid=!0;var e="admin/tag/getTagList",i={};a.post(e,i,t.fillExitingData)},t.editData=function(i,a){for(var n,l=e.extend([],t.gridOptions.data),s=0;s<l.length;s++)if(l[s].id===i){n=e.extend({},l[s]);break}var c=r.open({animation:!0,templateUrl:"tpl/modal/system/editTag.html",size:"md",backdrop:"static",controller:"tagModalCtrl",resolve:{tagInfo:function(){return{func:a,id:i,data:n}}}});c.result.then(function(e){t.getExistingData()})},t.delData=function(e){var i="admin/tag/deleteTag",n={id:e};a.post(i,n,t.fillExitingData)},t.fillExitingData=function(e){t.gridOptions.data=e.re.list,t.gridOptions.data.forEach(function(e,t){e.sequence=t}),t.loadingGrid=!1},t.getExistingData()}]),t.controller("tagModalCtrl",["$scope","tagInfo","$modalInstance","ycsApi","Notification",function(t,i,a,n,l){t.tagInfo=i,t.isEdit=!1,t.detail=[],t.typeUnitOpts=[{value:1,label:"分类标签"},{value:2,label:"扩展标签"},{value:3,label:"一般标签"}],t.dataSaved=function(){l.success("保存成功！"),a.close(i)},t.save=function(e){var i,a=e;i=t.isEdit?"admin/tag/editTag":"admin/tag/addTag",n.post(i,a,t.dataSaved)},t.cancel=function(){a.dismiss("cancel")},"add"!==i.func&&(t.isEdit=!0,t.detail=e.extend({},i.data))}])}(window.angular),function(e){"use strict";var t=e.module("backendApp");t.controller("ticketMessageCtrl",["$scope","ycsUtil","ycsApi","$filter","Notification","$modal","$interval",function(e,t,i,a,n,l,r){var s;e.isFiltering=!1,e.ticketStatusOpts=[{value:0,label:"待审核"},{value:5,label:"待付款"},{value:10,label:"已付款"},{value:15,label:"已收款"},{value:20,label:"服务中"},{value:30,label:"已完成"},{value:40,label:"申请中止"},{value:42,label:"已取消"},{value:44,label:"已中止"},{value:46,label:"已删除"},{value:48,label:"已作废"}],e.qData={},e.getMessageData=function(){var t="admin/order/getMsgList",a={};e.filterData&&(a=e.filterData),a.pageSize=999999,i.post(t,a,e.renderMessageData)},e.renderMessageData=function(t){e.tempMsgList=t.re.msgList,e.messages=[].concat(e.tempMsgList)},e.autoRefresh=function(){n.info({message:"消息列表每3分钟自动刷新一次",delay:5e3}),s=r(function(){n("消息列表已刷新"),e.getMessageData()},18e4)},e.$on("$destroy",function(){s&&(r.cancel(s),n.info("Timer destroyed"))}),e.checkAllMsgs=function(){if(0!==e.messages.length){var t=[];e.messages.forEach(function(e){0===e.status&&t.push(e.id)});var i=t.join(",");e.changeMsgStatus(i)}},e.changeMsgStatus=function(t){if(t&&""!==String(t).trim()){var a="admin/order/setMsgReaded",n={msgids:t+""};i.post(a,n,e.getMessageData)}},e.editOrder=function(t,a,n){!isNaN(parseFloat(a))&&isFinite(a)&&0===a&&n&&e.changeMsgStatus(n);var r=l.open({animation:!0,templateUrl:"tpl/modal/ticket/editOrder.html",size:"xl",backdrop:"static",controller:"editOrderModalCtrl",resolve:{orderInfo:function(){return{id:t,checkRecyle:e.checkRecyle}}}});r.result.then(function(t){
var a="admin/order/getOrderList",n={};t.filterData?(n=t.filterData,t.checkRecyle?n.status=46:delete n.status):(n.pageSize=999999,t.checkRecyle?n.status=46:delete n.status),i.post(a,n,e.fillExitingData)})},e.renderDate=function(){e.qData._sendTim||(e.qData._sendTime=new Date)},e.filterTickets=function(t){var n="admin/order/getMsgList";t.pageSize=999999,t._sendTime&&(t.sendTime=a("date")(t._sendTime,"yyyy-MM-dd")),e.filterData=t,e.isFiltering=!0,i.post(n,t,e.renderMessageData)},e.clearFilterData=function(){e.isFiltering=!1,e.qData={},delete e.filterData,e.getMessageData()},e.refreshList=function(){e.getMessageData(),n("消息列表已刷新")},e.getMessageData(),e.autoRefresh()}])}(window.angular),function(e){"use strict";var t=e.module("backendApp");t.controller("ticketCtrl",["$scope","ycsUtil","ycsApi","uiGridConstants","Notification","$modal","$interval",function(e,t,i,a,n,l,r){e.loadingGrid=!0,e.loadingMsg=!0;var s,c=[{value:0,label:"待审核"},{value:5,label:"待付款"},{value:10,label:"已付款"},{value:11,label:"已付款(金额有误)"},{value:15,label:"已收款"},{value:20,label:"服务中"},{value:30,label:"已完成"},{value:40,label:"申请中止"},{value:42,label:"已取消"},{value:44,label:"已中止"},{value:48,label:"已作废"}],o=[{value:46,label:"已删除"}];e.msgBoxFolded=!1,e.qData={},e.gridOptions={enableSorting:!0,enableFiltering:!0,flatEntityAccess:!0,rowHeight:65,onRegisterApi:function(t){e.gridApi=t},columnDefs:[{field:"workorderno",displayName:"工单号",width:140,cellClass:"multiline",filter:{placeholder:"搜索..."},enableHiding:!1},{field:"sdname",displayName:"服务名称",cellClass:"multiline",width:140,filter:{placeholder:"搜索..."},enableHiding:!1},{field:"orderno",displayName:"操作",width:60,cellTemplate:'<div class="ui-grid-cell-contents"><a ng-click="grid.appScope.editOrder(COL_FIELD)">详情</a></div>',cellClass:"text-center",headerCellClass:"text-center",enableColumnMenu:!1,enableSorting:!1,enableFiltering:!1,enableHiding:!1},{field:"sourceid",displayName:"来源",width:90,cellClass:"text-center",headerCellClass:"text-center",filter:{type:a.filter.SELECT,selectOptions:[{value:10,label:"网站"},{value:20,label:"微信"},{value:30,label:"直销"},{value:40,label:"渠道"},{value:50,label:"服务商"},{value:60,label:"aV"},{value:70,label:"pV"},{value:80,label:"内部测试"},{value:90,label:"其他"}]},cellTemplate:'<div class="ui-grid-cell-contents"><span ng-if="COL_FIELD === 10">网站</span><span ng-if="COL_FIELD === 20">微信</span><span ng-if="COL_FIELD === 30">直销</span><span ng-if="COL_FIELD === 40">渠道</span><span ng-if="COL_FIELD === 50">服务商</span><span ng-if="COL_FIELD === 60">aV</span><span ng-if="COL_FIELD === 70">pV</span><span ng-if="COL_FIELD === 80">内部测试</span><span ng-if="COL_FIELD === 90">其他</span></div>',enableHiding:!1},{field:"area",displayName:"服务区域",width:100,cellTemplate:'<div class="ui-grid-cell-contents area"><p>{{row.entity.province}}</p><p>{{row.entity.city}}</p><p>{{row.entity.district}}</p></div>',cellClass:"text-center",headerCellClass:"text-center",enableColumnMenu:!1,enableSorting:!1,enableFiltering:!1,enableHiding:!1},{field:"cc",displayName:"联系人/手机/用户名",width:150,cellTemplate:'<div class="ui-grid-cell-contents contact"><p class="cname">{{row.entity._cName}}</p><p class="cellphone">{{row.entity.ccmobile}}</p><p class="uname">{{row.entity._uName}}</p></div>',filter:{placeholder:"搜索..."},enableColumnMenu:!1,cellClass:"text-center",headerCellClass:"text-center",enableSorting:!1,enableHiding:!1},{field:"sernickname",displayName:"服务商",width:140,cellClass:"multiline",filter:{placeholder:"搜索..."},enableHiding:!1},{field:"due",displayName:"总金额",width:100,type:"number",cellTemplate:'<div class="ui-grid-cell-contents prices"><p>￥{{row.entity.due}}</p></div>',headerCellClass:"text-center",cellClass:"text-right",filter:{placeholder:"搜索..."},enableHiding:!1},{field:"uniquetradeid",displayName:"支付单号",width:140,cellClass:"paymentnum multiline",filter:{placeholder:"搜索..."},enableHiding:!1},{field:"paychannel",displayName:"支付渠道",width:100,cellClass:"text-center",headerCellClass:"text-center",filter:{type:a.filter.SELECT,selectOptions:[{value:"支付宝",label:"支付宝"},{value:"微信",label:"微信"}]},enableHiding:!1},{field:"modified",displayName:"最后更新时间",width:145,cellClass:"text-center time multiline",headerCellClass:"text-center",filter:{placeholder:"搜索..."},enableHiding:!1},{field:"status",displayName:"订单状态",width:90,type:"number",cellClass:"text-center multiline",headerCellClass:"text-center",filter:{condition:a.filter.STARTS_WITH,type:a.filter.SELECT,selectOptions:[]},cellTemplate:'<div class="ui-grid-cell-contents"><span ng-if="COL_FIELD === 0">待审核</span><span ng-if="COL_FIELD === 5">待付款</span><span ng-if="COL_FIELD === 10">已付款</span><span ng-if="COL_FIELD === 11">已付款(金额有误)</span><span ng-if="COL_FIELD === 15">已收款</span><span ng-if="COL_FIELD === 20">服务中</span><span ng-if="COL_FIELD === 30">已完成</span><span ng-if="COL_FIELD === 40">申请中止</span><span ng-if="COL_FIELD === 42">已取消</span><span ng-if="COL_FIELD === 44">已中止</span><span ng-if="COL_FIELD === 46">已删除</span><span ng-if="COL_FIELD === 48">已作废</span></div>',enableHiding:!1},{field:"serviceStatus",displayName:"服务状态",width:100,cellClass:"multiline",enableColumnMenu:!1,enableSorting:!1,enableFiltering:!1,enableHiding:!1},{field:"remark",displayName:"备注",width:140,cellClass:"multiline",filter:{placeholder:"搜索..."}}]},e.getExistingData=function(){e.loadingGrid=!0;var t="admin/order/getOrderList",a={pageSize:999999};i.post(t,a,e.fillExitingData),e.checkRecyle=!1,delete e.qData.district,e.gridOptions.columnDefs[11].filter.selectOptions=c},e.fillExitingData=function(t){var i=t.re.orderList;i.length>0&&i.forEach(function(e){var t=e.cc.split("/");e._cName=t[0],e._uName=t[1]}),e.gridOptions.data=i,e.loadingGrid=!1},e.getMessageData=function(){e.loadingMsg=!0;var t="admin/order/getMsgList",a={pageSize:100};i.post(t,a,e.renderMessageData)},e.renderMessageData=function(t){e.tempMsgList=t.re.msgList,e.messages=[].concat(e.tempMsgList),e.loadingMsg=!1},e.autoRefresh=function(){n.info({message:"消息列表每3分钟自动刷新一次",delay:5e3}),s=r(function(){n("消息列表已刷新"),e.getMessageData()},18e4)},e.$on("$destroy",function(){s&&(r.cancel(s),n.info("Timer destroyed"))}),e.changeMsgStatus=function(t){if(t&&""!==String(t).trim()){var a="admin/order/setMsgReaded",n={msgids:t+""};i.post(a,n,e.getMessageData)}},e.editOrder=function(t,a,n){!isNaN(parseFloat(a))&&isFinite(a)&&0===a&&n&&e.changeMsgStatus(n);var r=l.open({animation:!0,templateUrl:"tpl/modal/ticket/editOrder.html",size:"xl",backdrop:"static",controller:"editOrderModalCtrl",resolve:{orderInfo:function(){return{id:t,checkRecyle:e.checkRecyle,filterData:e.filterData}}}});r.result.then(function(t){var a="admin/order/getOrderList",n={};t.filterData?(n=t.filterData,t.checkRecyle?n.status=46:delete n.status):(n.pageSize=999999,t.checkRecyle?n.status=46:delete n.status),i.post(a,n,e.fillExitingData)})},e.filterTicket=function(){e.filterData={},e.loadingGrid=!0,e.qData.district%1e4===0&&e.qData.district%100===0?e.filterData.province=e.qData.district:e.qData.district%100===0&&e.qData.district%1e4!==0?(e.filterData.city=100*Math.round(e.qData.district/100),e.filterData.province=1e4*Math.round(e.qData.district/1e4)):(e.filterData.district=e.qData.district,e.filterData.city=100*Math.round(e.qData.district/100),e.filterData.province=1e4*Math.round(e.qData.district/1e4));var t="admin/order/getOrderList",a={};a=e.filterData,a.pageSize=999999,e.checkRecyle&&(a.status=e.statusForNow),i.post(t,a,e.fillExitingData)},e.getRecycleData=function(){var t="admin/order/getOrderList",a={pageSize:999999,status:46};e.loadingGrid=!0,e.statusForNow=46,i.post(t,a,e.fillExitingData),e.checkRecyle=!0,delete e.qData.district,e.gridOptions.columnDefs[10].filter.selectOptions=o},e.clearFilterData=function(){var t="admin/order/getOrderList",a={};e.checkRecyle&&(a.status=e.statusForNow),e.loadingGrid=!0,delete e.qData.district,e.filterData&&i.post(t,a,e.fillExitingData)},e.refreshList=function(){e.getExistingData(),e.getMessageData(),n.info("工单列表已刷新"),n("消息列表已刷新")},e.toggleMsgBox=function(t){"fold"===t?e.msgBoxFolded=!0:"unfold"===t&&(e.msgBoxFolded=!1)},e.exportTickets=function(){l.open({animation:!0,templateUrl:"tpl/modal/ticket/exportTicket.html",size:"md",backdrop:"static",controller:"exportTicketModalCtrl",resolve:{orderInfo:function(){return{}}}})},e.getExistingData(),e.getMessageData(),e.autoRefresh()}]),t.controller("editOrderModalCtrl",["$scope","orderInfo","$modalInstance","ycsApi","ycsUtil","Notification",function(e,t,i,a,n,l){e.orderInfo=t,e.newOrder={step:0},e.orderUser={id:null},e.orderModal={showServiceTab:!1},e.orderModal.close=function(){i.close(t)},e.tabsTpl={client:"tpl/ticket/client.html",order:"tpl/ticket/order-edit.html",service:"tpl/ticket/service.html"},e.currentTab=e.tabsTpl.order,e.switchTab=function(t){switch(t){case"service":case"client":e.currentTab=e.tabsTpl[t];break;default:case"order":e.currentTab=e.tabsTpl.order}},e.orderModal.fillExistingFullData=function(t){switch(e.qData=t.re,e.qData.status){case 20:e.orderModal.showServiceTab=!0,e.orderModal.serviceActive=!0;break;case 30:case 40:case 44:e.orderModal.showServiceTab=!0,e.orderModal.serviceActive=!1;break;default:e.orderModal.showServiceTab=!1,e.orderModal.serviceActive=!1}e.qData.company&&""!==String(e.qData.company).trim()||(e.qData.company="无"),e.qData.noAvailableSpecs=!0;for(var i=0;i<e.qData.serviceitems.length;i++){var a=e.qData.serviceitems[i];a.options&&a.options.length>0&&(e.qData.noAvailableSpecs=!1,a.optionsGroup=n.spliter(a.options,"|"))}},e.orderModal.getExistingData=function(){var t="admin/order/qryOrderByNo",i={orderno:e.orderInfo.id};a.post(t,i,e.orderModal.fillExistingFullData)},e.toNextStep=function(t){e.newOrder.step=1,e.orderUser.id=t},"new"!==e.orderInfo.id&&e.orderModal.getExistingData()}]),t.controller("exportTicketModalCtrl",["$scope","orderInfo","$modalInstance","ycsApi","ycsUtil","Notification","$filter",function(e,t,i,a,n,l,r){e.orderInfo=t,e.qData={},e.qData.option="all",e.renderTimeFrame=function(){var t=new Date,i=new Date(t.getTime()-864e5);i.setHours(18),i.setMinutes(0),i.setSeconds(0),i.setMilliseconds(0);var a=t;a.setHours(18),a.setMinutes(0),a.setSeconds(0),a.setMilliseconds(0),e.qData.beginTime=i,e.qData.endTime=a},e.cancel=function(){i.dismiss("cancel")},e.dataSaved=function(){e.ticketsExported(),i.close()},e.ticketsExported=function(e){var t=new Blob([e],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),i=new Date,a=i.getFullYear()+"-"+(i.getMonth()+1)+"-"+(i.getDate()<10?"0":"")+i.getDate(),n=i.getHours()+"-"+((i.getMinutes()<10?"0":"")+i.getMinutes())+"-"+((i.getSeconds()<10?"0":"")+i.getSeconds()),l="YCS_"+a+"_"+n+".xls",r=URL.createObjectURL(t),s=document.createElement("a");s.href=r,s.target="_blank",s.download=l,document.body.appendChild(s),s.click()},e.exportTickets=function(t){var i="admin/order/exportOrderList",n={};n=t,"all"===n.option?n={}:(n.beginTime=r("date")(t.beginTime,"yyyy-MM-dd HH:mm"),n.endTime=r("date")(t.endTime,"yyyy-MM-dd HH:mm")),a.postToGetStream(i,n,e.ticketsExported)},e.renderTimeFrame()}])}(window.angular),function(e){"use strict";var t=e.module("backendApp");t.controller("userAddCtrl",["$scope","ycsUtil","ycsApi","uiGridConstants","Notification","$state",function(e,t,i,a,n,l){e.accAvailable=!0,e.userRoleOpts=[{value:"1",label:"普通用户"},{value:"88",label:"运营人员"},{value:"99",label:"系统管理员"}],e.backToList=function(){l.go("user")},e.checkAccountResult=function(t){t&&200===Number(t.status)?e.accAvailable=!0:e.accAvailable=!1},e.checkUsernameAvailability=function(t,a){if(!t){var n="admin/user/validateUsername",l={username:a};i.post(n,l,e.checkAccountResult,null,null,e.checkAccountResult)}},e.dataSaved=function(t,i){n.success("新建用户成功！"),t&&e.backToList()},e.save=function(t,a){var n="admin/user/addUser",l=t;l.contactscity=100*Math.round(l.contactsdistrict/100),l.contactsprovince=1e4*Math.round(l.contactsdistrict/1e4),l.title&&l.title.trim(),l.company&&l.company.trim(),l.contacts&&l.contacts.trim(),i.post(n,l,e.dataSaved.bind(this,a))}}])}(window.angular),function(e){"use strict";var t=e.module("backendApp");t.controller("userBasicInfoCtrl",["$scope","ycsUtil","ycsApi","uiGridConstants","Notification","$state",function(e,t,i,a,n,l){e.typeUnitOpts=[{value:1,label:"服务商机构"},{value:2,label:"服务商分支机构"},{value:3,label:"客户公司"},{value:4,label:"客户分支公司"}],e.dataSaved=function(){n.success("用户基本信息保存成功！")},e.save=function(t){var a="admin/user/editUser",n=t;n.userid=e.userInfo.id,i.post(a,n,e.dataSaved)}}])}(window.angular),function(e){"use strict";var t=e.module("backendApp");t.controller("userContactInfoCtrl",["$scope","ycsUtil","ycsApi","uiGridConstants","Notification","$state",function(e,t,i,a,n,l){e.dataSaved=function(){n.success("用户联系人信息保存成功！")},e.save=function(t){var a="admin/user/editUser",n=t;n.contacts&&n.contacts.trim(),n.userid=e.userInfo.id,n.contactscity=100*Math.round(n.contactsdistrict/100),n.contactsprovince=1e4*Math.round(n.contactsdistrict/1e4),i.post(a,n,e.dataSaved)}}])}(window.angular),function(e,t){"use strict";var i=e.module("backendApp");i.controller("userCorpInfoCtrl",["$scope","ycsUtil","ycsApi","uiGridConstants","Notification","$modal",function(e,t,i,a,n,l){e.qData={},e.peopleUnitOpts=[{value:0,label:"1-10"},{value:1,label:"11-20"},{value:2,label:"21-50"},{value:3,label:"51-100"},{value:4,label:"101-300"},{value:5,label:"301-1000"},{value:6,label:"1000-5000"},{value:7,label:"5000-10000"},{value:8,label:"10000以上"}],e.qData.registedTime||(e.qData.registedTime=new Date),e.chooseIndustry=function(){var t=l.open({animation:!0,templateUrl:"tpl/modal/industryCategory.html",size:"lg",controller:"industryCategoryModalCtrl",backdrop:"static",resolve:{industryInfo:function(){return{category:e.qData.tmpCategory,industry:e.qData.tmpIndustry,code:e.qData.code}}}});t.result.then(function(t){e.qData.tmpCategory=t.category,e.qData.tmpIndustry=t.industry,e.qData.code=t.code})}}]),i.controller("industryCategoryModalCtrl",["$scope","industryInfo","$modalInstance","ycsApi","Notification",function(e,i,a,n,l){e.industryInfo=i,e.currentSelected={},e.industryInfo.code&&e.industryInfo.industry&&e.industryInfo.category&&(e.currentSelected=e.industryInfo),e.checkIfSelected=function(t){return e.industryInfo.code!==t?!1:!0},e.industries=[],e.getExistingData=function(){var i=t.Lib.industryCategory;e.industries=i},e.toggleSelected=function(t,i,a){e.currentSelected.category=t,e.currentSelected.industry=i,e.currentSelected.code=a},e.save=function(){i=e.currentSelected,a.close(i)},e.cancel=function(){a.dismiss("cancel")},e.getExistingData()}])}(window.angular,window.Neo),function(e){"use strict";var t=e.module("backendApp");t.controller("userOrdersCtrl",["$scope","ycsUtil","ycsApi","uiGridConstants","Notification","$state","$modal",function(e,t,i,a,n,l,r){e.loadingGrid=!0,e.gridOptions={enableSorting:!0,enableFiltering:!0,onRegisterApi:function(t){e.gridApi=t},columnDefs:[{field:"orderno",displayName:"订单号",width:140,filter:{placeholder:"搜索..."},enableHiding:!1},{field:"orderno",displayName:"操作",width:100,cellTemplate:'<div class="ui-grid-cell-contents"><a ng-click="grid.appScope.editOrder(COL_FIELD)">查看订单</a></div>',cellClass:"text-center",headerCellClass:"text-center",enableColumnMenu:!1,enableSorting:!1,enableFiltering:!1,enableHiding:!1},{field:"servicename",displayName:"服务名称",filter:{placeholder:"搜索..."},enableHiding:!1},{field:"area",displayName:"服务区域",width:200,cellTemplate:'<div class="ui-grid-cell-contents area">{{row.entity.provincecn}}{{row.entity.citycn}}{{row.entity.districtcn}}</div>',enableColumnMenu:!1,enableFiltering:!1,enableHiding:!1},{field:"amount",displayName:"总金额",width:120,type:"number",cellTemplate:'<div class="ui-grid-cell-contents prices"><p>￥{{row.entity.amount}}</p></div>',headerCellClass:"text-center",cellClass:"text-right",filter:{placeholder:"搜索..."},enableHiding:!1},{field:"created",displayName:"下单时间",width:150,headerCellClass:"text-center",cellClass:"text-center time multiline",filter:{placeholder:"搜索..."},enableHiding:!1},{field:"status",displayName:"订单状态",width:100,type:"number",cellClass:"text-center",headerCellClass:"text-center",filter:{condition:a.filter.STARTS_WITH,type:a.filter.SELECT,selectOptions:[{value:0,label:"待审核"},{value:5,label:"待付款"},{value:10,label:"已付款"},{value:11,label:"已付款(金额有误)"},{value:15,label:"已收款"},{value:20,label:"服务中"},{value:30,label:"已完成"},{value:40,label:"申请中止"},{value:42,label:"已取消"},{value:44,label:"已中止"},{value:46,label:"已删除"},{value:48,label:"已作废"}]},cellTemplate:'<div class="ui-grid-cell-contents"><span ng-if="COL_FIELD === 0">待审核</span><span ng-if="COL_FIELD === 5">待付款</span><span ng-if="COL_FIELD === 10">已付款</span><span ng-if="COL_FIELD === 11">已付款(金额有误)</span><span ng-if="COL_FIELD === 15">已收款</span><span ng-if="COL_FIELD === 20">服务中</span><span ng-if="COL_FIELD === 30">已完成</span><span ng-if="COL_FIELD === 40">申请中止</span><span ng-if="COL_FIELD === 42">已取消</span><span ng-if="COL_FIELD === 44">已中止</span><span ng-if="COL_FIELD === 46">已删除</span><span ng-if="COL_FIELD === 48">已作废</span></div>',enableHiding:!1}]},e.editOrder=function(t){var a=r.open({animation:!0,templateUrl:"tpl/modal/ticket/editOrder.html",size:"xl",backdrop:"static",controller:"editOrderModalCtrl",resolve:{orderInfo:function(){return{id:t,checkRecyle:e.checkRecyle,filterData:e.filterData}}}});a.result.then(function(t){var a="admin/order/getOrderList",n={};t.filterData?(n=t.filterData,t.checkRecyle?n.status=46:delete n.status):(n.pageSize=999999,t.checkRecyle?n.status=46:delete n.status),i.post(a,n,e.fillExitingData)})},e.fillExitingData=function(t){e.gridOptions.data=t.re.order,e.loadingGrid=!1},e.getExistingData=function(){e.loadingGrid=!0;var t="admin/user/getOrderListByUserid",a={userid:e.userInfo.id};i.post(t,a,e.fillExitingData)},e.getExistingData()}])}(window.angular),function(e){"use strict";var t=e.module("backendApp");t.controller("userCtrl",["$scope","ycsUtil","ycsApi","uiGridConstants","Notification","$modal",function(e,t,i,a,n,l){e.loadingGrid=!0,e.qData={},e.userRoleOpts=[{value:"0",label:"普通用户"},{value:"1",label:"普通用户(带订单)"},{value:"2",label:"已冻结用户"},{value:"4",label:"已删除用户"}],e.gridOptions={enableSorting:!0,enableFiltering:!0,flatEntityAccess:!0,rowHeight:50,onRegisterApi:function(t){e.gridApi=t},columnDefs:[{field:"username",displayName:"用户名",cellClass:"multiline",filter:{placeholder:"搜索..."},enableHiding:!1},{field:"id",displayName:"操作",width:70,cellTemplate:'<div class="ui-grid-cell-contents"><a ng-click="grid.appScope.editUser(COL_FIELD)">详情</a></div>',cellClass:"text-center",headerCellClass:"text-center",enableColumnMenu:!1,enableSorting:!1,enableFiltering:!1,enableHiding:!1},{field:"company",displayName:"公司简称",cellClass:"multiline",filter:{placeholder:"搜索..."},enableHiding:!1},{field:"mobile",displayName:"账户手机号码",width:130,filter:{placeholder:"搜索..."},enableHiding:!1},{field:"area",displayName:"所在区域",width:200,cellClass:"multiline",cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.contactsprovincecn}}{{row.entity.contactscitycn}}{{row.entity.contactsdistrictcn}}</div>',enableFiltering:!1,enableHiding:!1},{field:"contacts",displayName:"联系人",width:100,cellClass:"multiline",filter:{placeholder:"搜索..."},enableHiding:!1},{field:"contactsmobile",displayName:"联系人手机号码",width:130,filter:{placeholder:"搜索..."},enableHiding:!1},{field:"contactsemail",displayName:"联系人电子邮箱",cellClass:"multiline",filter:{placeholder:"搜索..."},enableHiding:!1},{field:"order",displayName:"订单情况",width:180,headerCellClass:"text-center",cellClass:"text-center",cellTemplate:'<div class="ui-grid-cell-contents order-statics"><div><span ng-class="{notZero: row.entity.executeCount > 0}">进行中：{{row.entity.executeCount}}</span><span> | </span><span ng-class="{notZero: row.entity.finishedCount > 0}">已完成：{{row.entity.finishedCount}}</span><div><span ng-class="{notZero: row.entity.cancelCount > 0}">已取消：{{row.entity.cancelCount}}</span><span> | </span><span ng-class="{notZero: row.entity.stopCount > 0}">已中止：{{row.entity.stopCount}}</span></div>',enableColumnMenu:!1,enableSorting:!1,enableFiltering:!1,enableHiding:!1},{field:"status",displayName:"更多操作",width:90,cellTemplate:'<div class="ui-grid-cell-contents"><div><a ng-if="COL_FIELD === 0" ng-click="grid.appScope.changeUserPassword(row.entity.id)">修改密码</a></div><div> <a ng-if="COL_FIELD === 0" ng-click="grid.appScope.userPermission(row.entity.id, row.entity.username, COL_FIELD, \'freeze\')">冻结</a><a ng-if="COL_FIELD === 1" ng-click="grid.appScope.userPermission(row.entity.id, row.entity.username, COL_FIELD, \'unfreeze\')">解冻</a> <a class="link-delete" ng-if="COL_FIELD === 0 || COL_FIELD === 1" ng-click="grid.appScope.userPermission(row.entity.id, row.entity.username, COL_FIELD, \'delete\')">删除</a><a ng-if="COL_FIELD === 4" ng-click="grid.appScope.userPermission(row.entity.id, row.entity.username, COL_FIELD, \'restore\')">恢复</a> </div></div>',cellClass:"text-center",headerCellClass:"text-center",enableColumnMenu:!1,enableSorting:!1,enableFiltering:!1,enableHiding:!1}]},e.chooseIndustry=function(){var e=l.open({animation:!0,templateUrl:"tpl/modal/industryCategory.html",size:"lg",controller:"industryCategoryModalCtrl",backdrop:"static",resolve:{industryInfo:function(){return{}}}});e.result.then(function(e){})},e.editUser=function(t){var a=l.open({animation:!0,templateUrl:"tpl/modal/user/editUser.html",size:"xl",backdrop:"static",controller:"editUserModalCtrl",resolve:{userInfo:function(){return{id:t,filterData:e.filterData}}}});a.result.then(function(t){var a="admin/user/getUserList",n={};n.pageSize=999999,t.filterData&&(n=t.filterData),i.post(a,n,e.fillExitingData)})},e.userPermission=function(t,i,a,n){var r=l.open({animation:!0,templateUrl:"tpl/modal/user/userPermission.html",size:"md",backdrop:"static",controller:"userPermissionModalCtrl",resolve:{userInfo:function(){return{id:t,username:i,status:a,func:n}}}});r.result.then(function(){e.getExistingData()})},e.changeUserPassword=function(t,i){var a=l.open({animation:!0,templateUrl:"tpl/modal/user/changeUserPassword.html",size:"md",backdrop:"static",controller:"changeUserPasswordModalCtrl",resolve:{userInfo:function(){return{id:t}}}});a.result.then(function(){e.getExistingData()})},e.fillExitingData=function(t){e.gridOptions.data=t.re.users,e.loadingGrid=!1},e.getExistingData=function(){e.loadingGrid=!0;var t="admin/user/getUserList",a={pageSize:999999};i.post(t,a,e.fillExitingData),delete e.qData.contactsdistrict,delete e.qData.userrole},e.filterUser=function(){e.loadingGrid=!0,e.filterData={},e.qData.contactsdistrict&&(e.qData.contactsdistrict%1e4===0&&e.qData.contactsdistrict%100===0?e.filterData.contactsprovince=e.qData.contactsdistrict:e.qData.contactsdistrict%100===0&&e.qData.contactsdistrict%1e4!==0?(e.filterData.contactscity=100*Math.round(e.qData.contactsdistrict/100),e.filterData.contactsprovince=1e4*Math.round(e.qData.contactsdistrict/1e4)):(e.filterData.contactsdistrict=e.qData.contactsdistrict,e.filterData.contactscity=100*Math.round(e.qData.contactsdistrict/100),e.filterData.contactsprovince=1e4*Math.round(e.qData.contactsdistrict/1e4))),e.qData.userrole&&(e.filterData.userrole=e.qData.userrole);var t="admin/user/getUserList",a={};a=e.filterData,a.pageSize=999999,i.post(t,a,e.fillExitingData)},e.getExistingData()}]),t.controller("editUserModalCtrl",["$scope","userInfo","$modalInstance","ycsApi","Notification",function(e,t,i,a,n){e.userInfo=t,e.userRoleOpts=[{value:1,label:"普通用户"},{value:88,label:"运营人员"},{value:99,label:"系统管理员"}],e.userModal={},e.userModal.close=function(){i.close(t)},e.tabsTpl={basicInfo:"tpl/user/basicInfo.html",contactInfo:"tpl/user/contactInfo.html",orders:"tpl/user/orders.html"},e.currentTab=e.tabsTpl.basicInfo,e.switchTab=function(t){switch(t){case"contactInfo":case"orders":e.currentTab=e.tabsTpl[t];break;default:case"basicInfo":e.currentTab=e.tabsTpl.basicInfo}},e.fillExitingData=function(t){e.qData=t.re},e.getExistingData=function(){var t="admin/user/getInfo",i={id:e.userInfo.id};a.post(t,i,e.fillExitingData)},e.getExistingData()}]),t.controller("userPermissionModalCtrl",["$scope","userInfo","$modalInstance","ycsApi","Notification",function(e,t,i,a,n){e.userInfo=t,e.userModal={},e.userModal.close=function(){i.close()},e.dataSaved=function(e){n.success("用户状态修改成功！"),i.close()},e.editUserStatus=function(t){var i="admin/user/freezeOrDelete",n=t;switch(n.id=e.userInfo.id,e.userInfo.func){case"freeze":n.status=1;break;case"unfreeze":n.status=0;break;case"delete":n.status=4;break;case"restore":n.status=0}a.post(i,n,e.dataSaved)},e.renderUserDetail=function(t){e.qData=t.re},e.getUserDetail=function(){var t="admin/user/getInfo",i={id:e.userInfo.id};a.post(t,i,e.renderUserDetail)},e.getUserDetail()}]),t.controller("changeUserPasswordModalCtrl",["$scope","userInfo","$modalInstance","ycsApi","Notification",function(e,t,i,a,n){e.userInfo=t,e.userModal={},e.userModal.close=function(){i.dismiss("cancel")},e.dataSaved=function(e){n.success("用户密码修改成功！"),i.dismiss("cancel")},e.editPassword=function(t){var i="admin/user/updatePassword",n=t;n.id=e.userInfo.id,a.post(i,n,e.dataSaved)},e.renderUserDetail=function(t){e.cred=t.re},e.getUserDetail=function(){var t="admin/user/getInfo",i={id:e.userInfo.id};a.post(t,i,e.renderUserDetail)},e.getUserDetail()}])}(window.angular),function(e){"use strict";var t=e.module("backendApp");t.controller("userNotificationCtrl",["$scope","ycsUtil","ycsApi","uiGridConstants","Notification","$modal",function(e,t,i,a,n,l){e.qData={},e.tempSelected=[],e.tempArray=[],e.choiceUsers=!1,e.getMsgList=!0,e.loadingGrid=!0,e.loadingHistory=!0,e.qData={isSendSms:0,isSendMessage:0},e.userRoleOpts=[{value:"0",label:"普通用户"},{value:"1",label:"普通用户(带订单)"},{value:"2",label:"已冻结用户"},{value:"4",label:"已删除用户"}],e.toggleSelection=function(t,i,a){var n=e.tempArray.indexOf(t);e.tempSelected.indexOf(i);-1===n?(e.tempArray.push(t),e.tempSelected.push({username:i,id:t})):(e.tempArray.splice(n,1),e.tempSelected.forEach(function(i,a){i.id===t&&e.tempSelected.splice(a,1)}),a&&e.gridApi.selection.getSelectedGridRows().forEach(function(e){e.entity.username===i&&(e.isSelected=!1)}))},e.historyGridOptions={enableColumnResizing:!0,enableSorting:!0,enableFiltering:!0,flatEntityAccess:!0,rowHeight:66,columnDefs:[{field:"message",displayName:"信息内容",cellClass:"multiline",filter:{placeholder:"搜索..."},enableHiding:!1},{field:"receiver",displayName:"发送到",width:250,cellClass:"multiline",filter:{placeholder:"搜索..."},enableHiding:!1},{field:"created",displayName:"发送时间",width:80,enableHiding:!1,cellClass:"text-center time multiline",headerCellClass:"text-center",filter:{placeholder:"搜索..."},enableColumnMenu:!1},{field:"id",displayName:"发送状态",width:80,enableHiding:!1,cellClass:"text-center",headerCellClass:"text-center",cellTemplate:'<div class="ui-grid-cell-contents"><a ng-click="grid.appScope.openMsgDetailList(COL_FIELD, \'user\', row.entity.message, row.entity.created)">详情</a></div>',enableFiltering:!1}]},e.gridOptions={enableSorting:!0,enableFiltering:!0,enableSelectAll:!1,flatEntityAccess:!0,onRegisterApi:function(t){e.gridApi=t,t.selection.on.rowSelectionChanged(e,function(t){e.toggleSelection(t.entity.id,t.entity.username)}),t.selection.on.rowSelectionChangedBatch(e,function(t){t.forEach(function(t){e.toggleSelection(t.entity.id,t.entity.username)})})},columnDefs:[{field:"username",displayName:"用户名",filter:{placeholder:"搜索..."},enableHiding:!1},{field:"company",displayName:"公司名称",filter:{placeholder:"搜索..."},width:250,enableHiding:!1},{field:"contacts",displayName:"联系人",filter:{placeholder:"搜索..."},width:150,cellClass:"text-center",headerCellClass:"text-center",enableHiding:!1},{field:"mobile",displayName:"账户手机号码",filter:{placeholder:"搜索..."},width:120,cellClass:"text-center",headerCellClass:"text-center",enableHiding:!1}]},e.fillMsgSentList=function(t){e.historyGridOptions.data=t.re.list,e.loadingHistory=!1},e.getMsgSentList=function(){e.loadingHistory=!0;var t="admin/user/getMessageSendList",a={type:0};i.post(t,a,e.fillMsgSentList)},e.fillMsgDetailData=function(t){e.msgDetailList=t.re.list},e.getMsgSentDetail=function(t){var a="admin/user/getMessageSendDetail",n={type:0,mslid:t};i.post(a,n,e.fillMsgDetailData)},e.fillExitingData=function(t){e.gridOptions.data=t.re.users,e.gridApi.selection.clearSelectedRows(),e.tempArray=[],e.tempSelected=[],e.tempArray.length=0,e.loadingGrid=!1},e.filterUserData=function(t){e.gridOptions.data=t.re.users,e.loadingGrid=!1},e.getExistingData=function(){var t="admin/user/getUserList",a={pageSize:999999};e.loadingGrid=!0,i.post(t,a,e.fillExitingData),delete e.qData.contactsdistrict,delete e.qData.userrole},e.filterUser=function(){e.filterData={},e.loadingGrid=!0,e.qData.contactsdistrict&&(e.qData.contactsdistrict%1e4===0&&e.qData.contactsdistrict%100===0?e.filterData.contactsprovince=e.qData.contactsdistrict:e.qData.contactsdistrict%100===0&&e.qData.contactsdistrict%1e4!==0?(e.filterData.contactscity=100*Math.round(e.qData.contactsdistrict/100),e.filterData.contactsprovince=1e4*Math.round(e.qData.contactsdistrict/1e4)):(e.filterData.contactsdistrict=e.qData.contactsdistrict,e.filterData.contactscity=100*Math.round(e.qData.contactsdistrict/100),e.filterData.contactsprovince=1e4*Math.round(e.qData.contactsdistrict/1e4))),e.qData.userrole&&(e.filterData.userrole=e.qData.userrole);var t="admin/user/getUserList",a={};a=e.filterData,a.pageSize=999999,i.post(t,a,e.filterUserData)},e.msgSent=function(){n.success("信息发送成功"),e.getExistingData()},e.sendMsg=function(t){var a,n="admin/user/sendMsg";a=t,a.ids=e.tempArray.join(","),i.post(n,a,e.msgSent)},e.clearContent=function(){e.qData.content=""},e.openUserList=function(){e.choiceUsers=!0,e.getMsgList=!1,e.getExistingData()},e.openMsgSentList=function(){e.choiceUsers=!1,e.getMsgList=!0,e.getMsgSentList()},e.openMsgDetailList=function(e,t,i,a){var n=l.open({animation:!0,templateUrl:"tpl/modal/notificationHistoryDetail.html",size:"xl",controller:"notificationHistoryDetailUserModalCtrl",backdrop:"static",resolve:{notifyDetail:function(){return{id:e,type:t,message:i,created:a}}}});n.result.then(function(e){})},e.getMsgSentList()}]),t.controller("notificationHistoryDetailUserModalCtrl",["$scope","notifyDetail","$modalInstance","ycsApi","Notification",function(e,t,i,a,n){e.notifyDetail=t,e.cancel=function(){i.dismiss("cancel")},e.fillMsgDetailData=function(t){e.msgDetailList=t.re.list},e.getMsgSentDetail=function(t){var i="admin/user/getMessageSendDetail",n={type:0,mslid:e.notifyDetail.id};a.post(i,n,e.fillMsgDetailData)},e.getMsgSentDetail()}])}(window.angular),function(e){"use strict";var t=e.module("backendApp");t.controller("vendorCtrl",["$scope","ycsUtil","ycsApi","uiGridConstants","Notification","$modal",function(e,t,i,a,n,l){e.qData={},e.loadingGrid=!0,e.gridOptions={enableSorting:!0,enableFiltering:!0,flatEntityAccess:!0,onRegisterApi:function(t){e.gridApi=t},columnDefs:[{field:"nickname",displayName:"服务商简称",filter:{placeholder:"搜索..."},enableHiding:!1},{field:"id",displayName:"操作",width:80,cellTemplate:'<div class="ui-grid-cell-contents"><a ui-sref="vendor.corp.edit({vendorId: COL_FIELD})">详情</a></div>',cellClass:"text-center",headerCellClass:"text-center",enableColumnMenu:!1,enableSorting:!1,enableHiding:!1,enableFiltering:!1},{field:"code",displayName:"服务商帐号",filter:{placeholder:"搜索..."},width:120,cellClass:"text-center",headerCellClass:"text-center",enableHiding:!1},{field:"score",displayName:"服务商评分",filter:{placeholder:"搜索..."},type:"number",width:120,cellClass:"text-center",headerCellClass:"text-center",enableHiding:!1},{field:"status",displayName:"合作关系",width:100,filter:{type:a.filter.SELECT,selectOptions:[{value:1,label:"未合作"},{value:2,label:"未生效"},{value:3,label:"生效中"},{value:4,label:"待续约"},{value:5,label:"已失效"},{value:6,label:"冻结中"},{value:8,label:"特约专用"}]},cellClass:"text-center",headerCellClass:"text-center",cellTemplate:'<div class="ui-grid-cell-contents"><span class="intact" ng-if="COL_FIELD === 1">未合作</span><span class="ready" ng-if="COL_FIELD === 2">未生效</span><span class="on-going" ng-if="COL_FIELD === 3">生效中</span><span class="due" ng-if="COL_FIELD === 4">待续约</span><span class="overdue" ng-if="COL_FIELD === 5">已失效</span><span class="frozen" ng-if="COL_FIELD === 6">冻结中</span><span ng-if="COL_FIELD === 8">特约专用</span></div>',
enableHiding:!1},{field:"id",displayName:"提供服务区域",width:120,cellTemplate:'<div class="ui-grid-cell-contents"><a ng-click="grid.appScope.supportArea(COL_FIELD, row.entity.nickname)"><i class="fa fa-map-marker fa-lg"></i></a></div>',cellClass:"text-center",headerCellClass:"text-center",enableColumnMenu:!1,enableSorting:!1,enableHiding:!1,enableFiltering:!1},{field:"id",displayName:"提供服务项",width:120,cellTemplate:'<div class="ui-grid-cell-contents"><a ng-click="grid.appScope.supportServiceItem(COL_FIELD, row.entity.nickname)"><i class="fa fa-tasks"></i></a></div>',cellClass:"text-center",headerCellClass:"text-center",enableColumnMenu:!1,enableSorting:!1,enableHiding:!1,enableFiltering:!1},{field:"contacts",displayName:"联系人",filter:{placeholder:"搜索..."},enableHiding:!1},{field:"contactstel",displayName:"联系人手机",filter:{placeholder:"搜索..."},enableHiding:!1},{field:"field",displayName:"专业领域",filter:{type:a.filter.SELECT,selectOptions:[{value:"工商",label:"工商"},{value:"财务会计",label:"财务会计"},{value:"审计",label:"审计"},{value:"税务",label:"税务"},{value:"法律",label:"法律"},{value:"资产评估",label:"资产评估"},{value:"许可证",label:"许可证"},{value:"商标专利",label:"商标专利"},{value:"人力资源",label:"人力资源"}]},enableHiding:!1}]},e.getExistingData=function(){e.loadingGrid=!0;var t="admin/servicer/servicerList",a={};i.post(t,a,e.fillExitingData),delete e.qData.district},e.fillExitingData=function(t){e.gridOptions.data=t.re.servicerList,e.loadingGrid=!1},e.supportArea=function(e,t){l.open({animation:!0,templateUrl:"tpl/modal/vendor/supportArea.html",size:"xl",controller:"getSupportAreaCtrl",resolve:{supportAreas:function(){return{id:e,name:t}}}})},e.supportServiceItem=function(e,t){l.open({animation:!0,templateUrl:"tpl/modal/vendor/supportServiceItem.html",size:"xl",controller:"getSupportItemCtrl",resolve:{supportItems:function(){return{id:e,name:t}}}})},e.filterTicket=function(){e.loadingGrid=!0,e.filterData={},e.qData.district%1e4===0&&e.qData.district%100===0?e.filterData.province=e.qData.district:e.qData.district%100===0&&e.qData.district%1e4!==0?(e.filterData.city=100*Math.round(e.qData.district/100),e.filterData.province=1e4*Math.round(e.qData.district/1e4)):(e.filterData.district=e.qData.district,e.filterData.city=100*Math.round(e.qData.district/100),e.filterData.province=1e4*Math.round(e.qData.district/1e4));var t="admin/servicer/servicerList",a={};a=e.filterData,a.pageSize=999999,i.post(t,a,e.fillExitingData)},e.getExistingData()}]),t.controller("getSupportAreaCtrl",["$scope","supportAreas","$modalInstance","ycsApi","Notification","$filter",function(e,t,i,a,n,l){e.supportAreas=t,e.ok=function(){i.close()},e.close=function(){i.dismiss("cancel")},e.detail={},e.getAreaData=function(){var t="admin/servicer/queryAreaByServicerId",i={servicerid:e.supportAreas.id};a.post(t,i,e.renderAreaData)},e.renderAreaData=function(t){e.detail.servicename=e.supportAreas.name,e.tempArea=t.re;var i=[];e.tempArea.forEach(function(e){var t=e.provinceName;e.cityList.forEach(function(e){var a=e.cityName,n="";e.districtList.forEach(function(e,t){n+=(t>0?", ":"")+e.districtName}),i.push({province:t,city:a,districts:n})})}),e.detail.list=i},e.getAreaData()}]),t.controller("getSupportItemCtrl",["$scope","supportItems","$modalInstance","ycsApi","Notification","$filter",function(e,t,i,a,n,l){e.supportItems=t,e.servicerName=t.name,e.detail={},e.ok=function(){i.close()},e.close=function(){i.dismiss("cancel")},e.renderItemData=function(t){e.detail.servicename=e.supportItems.name;var i=[];e.tempItem=t.re,e.tempItem.forEach(function(e){var t=e.topCatName;e.subCatList.forEach(function(e){var a=e.subCatName,n=[];e.serviceList.forEach(function(e,t){n.push(e.serviceName)}),i.push({topCatName:t,subCatName:a,services:n})})}),e.detail.list=i},e.getItemData=function(){var t="admin/servicer/querySeviceByServicerId",i={servicerid:e.supportItems.id};a.post(t,i,e.renderItemData)},e.getItemData()}])}(window.angular),function(e){"use strict";var t=e.module("backendApp");t.controller("vendorNotificationCtrl",["$scope","ycsUtil","ycsApi","uiGridConstants","Notification","$modal","$timeout",function(e,t,i,a,n,l,r){e.qData={},e.tempSelected=[],e.tempArray=[],e.choiceVendors=!1,e.getMsgList=!0,e.loadingGrid=!0,e.loadingHistory=!0,e.qData={sendSMS:0,sendEmail:0},e.toggleSelection=function(t,i,a){var n=e.tempArray.indexOf(t);e.tempSelected.indexOf(i);-1===n?(e.tempArray.push(t),e.tempSelected.push({srname:i,id:t})):(e.tempArray.splice(n,1),e.tempSelected.forEach(function(i,a){i.id===t&&e.tempSelected.splice(a,1)}),a&&e.gridApi.selection.getSelectedGridRows().forEach(function(e){e.entity.nickname===i&&(e.isSelected=!1)}))},e.historyGridOptions={enableColumnResizing:!0,enableSorting:!0,enableFiltering:!0,flatEntityAccess:!0,rowHeight:66,columnDefs:[{field:"message",displayName:"信息内容",cellClass:"multiline",filter:{placeholder:"搜索..."},enableHiding:!1},{field:"receiver",displayName:"发送到",width:250,cellClass:"multiline",filter:{placeholder:"搜索..."},enableHiding:!1},{field:"created",displayName:"发送时间",width:80,enableHiding:!1,cellClass:"text-center time multiline",headerCellClass:"text-center",filter:{placeholder:"搜索..."},enableColumnMenu:!1},{field:"id",displayName:"发送状态",width:80,enableHiding:!1,cellClass:"text-center",headerCellClass:"text-center",cellTemplate:'<div class="ui-grid-cell-contents"><a ng-click="grid.appScope.openMsgDetailList(COL_FIELD, \'vendor\', row.entity.message, row.entity.created)">详情</a></div>',enableFiltering:!1}]},e.fillMsgSentList=function(t){e.historyGridOptions.data=t.re.list,e.loadingHistory=!1},e.getMsgSentList=function(){e.loadingHistory=!0;var t="admin/user/getMessageSendList",a={type:1};i.post(t,a,e.fillMsgSentList)},e.gridOptions={enableSorting:!0,enableFiltering:!0,enableSelectAll:!1,flatEntityAccess:!0,onRegisterApi:function(t){e.gridApi=t,t.selection.on.rowSelectionChanged(e,function(t){e.toggleSelection(t.entity.srid,t.entity.nickname)}),t.selection.on.rowSelectionChangedBatch(e,function(t){t.forEach(function(t){e.toggleSelection(t.entity.srid,t.entity.nickname)})})},columnDefs:[{field:"code",displayName:"公司账号",filter:{placeholder:"搜索..."},width:120,enableHiding:!1},{field:"nickname",displayName:"公司简称",filter:{placeholder:"搜索..."},width:200,enableHiding:!1},{field:"contacts",displayName:"联系人",filter:{placeholder:"搜索..."},width:100,cellClass:"text-center",headerCellClass:"text-center",enableHiding:!1},{field:"contactstel",displayName:"联系人手机",filter:{placeholder:"搜索..."},width:120,cellClass:"text-center",headerCellClass:"text-center",enableHiding:!1},{field:"contactsemail",displayName:"联系人邮箱",filter:{placeholder:"搜索..."},enableHiding:!1},{field:"status",displayName:"合作关系",width:100,filter:{type:a.filter.SELECT,selectOptions:[{value:"未合作",label:"未合作"},{value:"未生效",label:"未生效"},{value:"生效中",label:"生效中"},{value:"待续约",label:"待续约"},{value:"已失效",label:"已失效"},{value:"冻结中",label:"冻结中"}]},cellClass:"text-center",headerCellClass:"text-center",cellTemplate:'<div class="ui-grid-cell-contents"><span class="intact" ng-if="COL_FIELD === \'未合作\'">未合作</span><span class="ready" ng-if="COL_FIELD === \'未生效\'">未生效</span><span class="on-going" ng-if="COL_FIELD === \'生效中\'">生效中</span><span class="due" ng-if="COL_FIELD === \'待续约\'">待续约</span><span class="overdue" ng-if="COL_FIELD === \'已失效\'">已失效</span><span class="frozen" ng-if="COL_FIELD === \'冻结中\'">冻结中</span></div>',enableSorting:!1,enableColumnMenu:!1,enableHiding:!1}]},e.filterVendorData=function(t){e.filledArray=[],t.re.contacts.forEach(function(t){0===t.index&&e.filledArray.push(t)}),e.gridOptions.data=e.filledArray,e.loadingGrid=!1},e.fillExitingData=function(t){e.filledArray=[],t.re.contacts.forEach(function(t){0===t.index&&e.filledArray.push(t)}),e.gridOptions.data=e.filledArray,e.gridApi.selection.clearSelectedRows(),e.tempArray=[],e.tempSelected=[],e.tempArray.length=0,e.loadingGrid=!1},e.getExistingData=function(){e.loadingGrid=!0;var t="admin/servicer/getServicerContactsList",a={pageSize:999999};i.post(t,a,e.fillExitingData),delete e.qData.district},e.filterTicket=function(){e.loadingGrid=!0,e.filterData={},e.qData.district%1e4===0&&e.qData.district%100===0?e.filterData.province=e.qData.district:e.qData.district%100===0&&e.qData.district%1e4!==0?(e.filterData.city=100*Math.round(e.qData.district/100),e.filterData.province=1e4*Math.round(e.qData.district/1e4)):(e.filterData.district=e.qData.district,e.filterData.city=100*Math.round(e.qData.district/100),e.filterData.province=1e4*Math.round(e.qData.district/1e4));var t="admin/servicer/getServicerContactsList",a={};a=e.filterData,a.pageSize=999999,i.post(t,a,e.filterVendorData)},e.clearContent=function(){e.qData.content="",e.qData.subject=""},e.msgSent=function(){n.success("信息发送成功"),e.getExistingData()},e.sendMsg=function(t){var a,n="admin/servicer/sendMsgToServicerContacts";a=t,a.srids=e.tempArray.join(","),i.post(n,a,e.msgSent)},e.openVendorList=function(){e.choiceVendors=!0,e.getMsgList=!1,e.getExistingData()},e.openMsgSentList=function(){e.choiceVendors=!1,e.getMsgList=!0,e.getMsgSentList()},e.openMsgDetailList=function(e,t,i,a){var n=l.open({animation:!0,templateUrl:"tpl/modal/notificationHistoryDetail.html",size:"xl",controller:"notificationHistoryDetailModalCtrl",backdrop:"static",resolve:{notifyDetail:function(){return{id:e,type:t,message:i,created:a}}}});n.result.then(function(e){})},e.getMsgSentList()}]),t.controller("notificationHistoryDetailModalCtrl",["$scope","notifyDetail","$modalInstance","ycsApi","Notification",function(e,t,i,a,n){e.notifyDetail=t,e.cancel=function(){i.dismiss("cancel")},e.fillMsgDetailData=function(t){e.msgDetailList=t.re.list},e.getMsgSentDetail=function(t){var i="admin/servicer/getSendMsgDetailList",n={type:1,mslid:e.notifyDetail.id};a.post(i,n,e.fillMsgDetailData)},e.getMsgSentDetail()}])}(window.angular),function(e){"use strict";var t=e.module("backendApp");t.controller("vendorRatingCtrl",["$scope","ycsUtil","ycsApi","uiGridConstants","Notification","$state",function(t,i,a,n,l,r){t.getExistingData=function(){var e="admin/servicer/servicerList",i={};a.post(e,i,t.fillExitingData)},t.fillExitingData=function(e){t.detail=e.re.servicerList,t.detail.forEach(function(e){e.score=100*parseFloat(e.score)/100})},t.backToList=function(){r.go("vendor")},t.dataSaved=function(e,i){l.success("服务商评分保存成功！"),e?t.backToList():t.getExistingData()},t.save=function(i,n){var l="admin/servicer/editServicerScore";i.forEach(function(e){e.servicerId=e.id,e.score=Number(e.score).toPrecision(3),e.score=parseFloat(e.score)});var r={scoreList:e.toJson(i)};a.post(l,r,t.dataSaved.bind(this,n))},t.getExistingData()}])}(window.angular),function(e){"use strict";var t=e.module("backendApp");t.controller("wechatCtrl",["$scope","ycsUtil","ycsApi","uiGridConstants","Notification","$modal","$filter",function(e,t,i,a,n,l,r){e.loadingGrid=!0,e.qData={},e.gridOptions={enableSorting:!0,enableFiltering:!0,flatEntityAccess:!0,rowHeight:47,onRegisterApi:function(t){e.gridApi=t},columnDefs:[{field:"action_info",displayName:"场景名称",width:220,cellClass:"multiline",filter:{placeholder:"搜索..."},enableHiding:!1},{field:"id",displayName:"详情",width:60,cellTemplate:'<div class="ui-grid-cell-contents"><a ng-click="grid.appScope.editQrcode(COL_FIELD, row.entity.action_info, row.entity.action_desc, row.entity.remark)">详情</a></div>',cellClass:"text-center",headerCellClass:"text-center",enableColumnMenu:!1,enableSorting:!1,enableFiltering:!1,enableHiding:!1},{field:"created",displayName:"创建时间",width:150,cellClass:"text-center time multiline",headerCellClass:"text-center",filter:{placeholder:"搜索..."},enableHiding:!1},{field:"expire_seconds",displayName:"有效期",width:100,headerCellClass:"text-center",cellClass:"text-center",filter:{type:a.filter.SELECT,selectOptions:[{value:"7天有效",label:"7天有效"},{value:"长期有效",label:"长期有效"}]},enableHiding:!1},{field:"scans",displayName:"累计扫码次数",width:110,type:"number",cellClass:"text-center",filter:{placeholder:"搜索..."},enableHiding:!1},{field:"action_desc",displayName:"描述",width:220,cellClass:"multiline",filter:{placeholder:"搜索..."},enableHiding:!1},{field:"downLoadUrl",displayName:"二维码",width:80,cellTemplate:'<div class="ui-grid-cell-contents"><a href="{{COL_FIELD}}" target="_blank" tooltip="下载二维码" tooltip-placement="left"><i class="fa fa-lg fa-qrcode"></i></a></div>',cellClass:"text-center",headerCellClass:"text-center",enableColumnMenu:!1,enableSorting:!1,enableFiltering:!1,enableHiding:!1},{field:"remark",displayName:"备注",cellClass:"multiline",filter:{placeholder:"搜索..."},enableHiding:!1}]},e.editQrcode=function(t,i,a,n){var r=l.open({animation:!0,templateUrl:"tpl/modal/wechat/editQrcode.html",size:"md",backdrop:"static",controller:"editQrcodeModalCtrl",resolve:{qrcodeInfo:function(){return{id:t,length:e.remainingNumber,qrtitle:i,qrdescribe:a,qrremark:n}}}});r.result.then(function(t){e.getExistingData()})},e.renderTimeFrame=function(){var t=new Date,i=new Date(t.getTime()-864e5);e.qData.exportTime=i},e.fillExitingData=function(t){e.gridOptions.data=t.re.re,e.loadingGrid=!1,e.remainingNumber=t.re.remainingnumber},e.getExistingData=function(){e.loadingGrid=!0;var t="admin/qrcode/getList",a={pageSize:999999};i.post(t,a,e.fillExitingData)},e.statisticsExported=function(e){var t=new Blob([e],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),i=new Date,a=i.getFullYear()+"-"+(i.getMonth()+1)+"-"+i.getDate(),n=i.getHours()+"-"+((i.getMinutes()<10?"0":"")+i.getMinutes())+"-"+((i.getSeconds()<10?"0":"")+i.getSeconds()),l="YCS_Qrcode"+a+"_"+n+".xls",r=URL.createObjectURL(t),s=document.createElement("a");s.href=r,s.target="_blank",s.download=l,document.body.appendChild(s),s.click()},e.exportStatistics=function(t){var a="admin/qrcode/exportFollowList",n={};n.exporttime=r("date")(t,"yyyy-MM-dd"),i.postToGetStream(a,n,e.statisticsExported)},e.getExistingData(),e.renderTimeFrame()}]),t.controller("editQrcodeModalCtrl",["$scope","qrcodeInfo","$modalInstance","ycsApi","Notification",function(e,t,i,a,n){e.qrcodeInfo=t,e.qrcodeModal={},e.saving=!1,"new"===t.id?(e.qData={},e.qData.qrtype=0):e.qData=e.qrcodeInfo,e.cancel=function(){i.dismiss("cancel")},e.dataSaved=function(){n.success("二维码创建成功！"),i.close()},e.hasError=function(t){e.saving=!1,n.error("二维码创建失败")},e.save=function(t){var i="admin/qrcode/createQrcode",n={};n=t,1===n.qrtype&&delete n.qrid,e.saving=!0,a.post(i,n,e.dataSaved,null,null,e.hasError)}}])}(window.angular),function(e,t){"use strict";var i=e.module("backendApp");i.controller("serviceEditCtrl",["$scope","ycsUtil","ycsApi","Notification","$modal","$filter","$sce","$state",function(t,i,a,n,l,r,s,c){t.animationsEnabled=!0,t.qData={},t.backToList=function(){c.go("service.pack")},t._ueditor={ueditorConfig:{enableContextMenu:!1},ueditorContent:"",ueditorHtml:""},t._ueditor.ready=function(e){},t._ueditor.updateHtml=function(){t._ueditor.ueditorHtml=s.trustAsHtml(t._ueditor.ueditorContent)},t.editTags=function(){var e=l.open({animation:!0,templateUrl:"tpl/modal/addTags.html",size:"lg",backdrop:"static",controller:"tagsCompoundCtrl",resolve:{tagsCmpInfo:function(){return{currentSelected:t.qData.tagsInput,isBulkEdit:!1}}}});e.result.then(function(e){t.qData.tagsInput=e.currentSelected})},t.fillExistingData=function(e){if(e&&e.re){if(t.qData=e.re,"new"===t.serviceId&&(t.qData.status=0,t.qData.serviceitem=[]),t.qData.tagsInput=[],t.qData.tag&&t.qData.tag.length>0){var a=i.spliter(t.qData.tag,",");a.forEach(function(e){e.length>0&&t.qData.tagsInput.push(e)})}t.currentItem=t.qData.serviceitem,t.currentSelected=[],t.currentSelectedNames=[],t.newlyAdded=[],t.currentItem.forEach(function(e,a){t.currentItem[a].si_opts=[],t.currentSelected.push(e.siid),t.currentSelectedNames.push(e.siname);var n=i.spliter(e.sioptions,"|");n.forEach(function(e){e.length>0&&t.currentItem[a].si_opts.push(e)})}),t._ueditor.ueditorContent=t.qData.description}},t.removeItem=function(e,i,a){t.qData.serviceitem.splice(e,1);var n=t.currentSelected.indexOf(i);t.currentSelected.splice(n,1);var l=t.currentSelectedNames.indexOf(a);t.currentSelectedNames.splice(l,1)},t.getItemData=function(e){if(e=e||t.serviceId,!e||"new"===e)return void t.fillExistingData({re:{}});var i="admin/service/queryServiceDetail",n={serviceid:e};a.post(i,n,t.fillExistingData)},t.editPics=function(){var i=l.open({animation:!0,templateUrl:"tpl/modal/addPics.html",size:"lg",controller:"editPicModalCtrl",backdrop:"static",resolve:{picsInfo:function(){return{serviceName:t.qData.name,pics:e.extend([],t.qData.pics)}}}});i.result.then(function(e){t.qData.pics=e.pics})},t.serviceSaved=function(e,i){n.success("服务内容已成功保存！"),e&&t.backToList()},t.save=function(e,i){var n,l=e;n="new"===t.serviceId?"admin/service/addService":"admin/service/modifyService",l.tag=e.tagsInput.join(","),l.siids=t.currentSelected.join(","),l.description=t._ueditor.ueditorContent,a.post(n,l,t.serviceSaved.bind(this,i))},t.openServiceItemModal=function(){var i=e.extend([],t.currentSelectedNames),a=l.open({animation:!0,templateUrl:"tpl/modal/serviceItemList.html",size:"xl",controller:"serviceItemModalCtrl",resolve:{selectedServiceItem:function(){return{currentSelected:t.currentSelected,currentSelectedNames:t.currentSelectedNames}}}});a.result.then(function(e){var a=e.currentSelectedNames;if(a.forEach(function(e){-1===i.indexOf(e)&&t.newlyAdded.push(e)}),!(t.qData.serviceitem&&t.qData.serviceitem.length<1)){var n=[];t.qData.serviceitem.forEach(function(e){-1!==a.indexOf(e.siname)&&n.push(e)}),t.qData.serviceitem=n}})},t.getItemData()}]),i.controller("serviceItemModalCtrl",["$scope","selectedServiceItem","$modalInstance","ycsApi",function(e,t,i,a){e.selectedServiceItem=t.currentSelected,e.currentSelectedNames=t.currentSelectedNames,e.serviceItemList=[],e.currentCataIndex=0,e.renderServiceItemList=function(t){e.serviceItemList=t.re},e.loadServiceItemList=function(){var t="admin/serviceItem/serviceAll",i={};a.post(t,i,e.renderServiceItemList)},e.switchCategory=function(t){e.currentCataIndex=t},e.checkIfSelected=function(t){return-1!==e.selectedServiceItem.indexOf(t)?!0:!1},e.toggleSelected=function(t,i){var a=e.selectedServiceItem.indexOf(t);-1===a?e.selectedServiceItem.push(t):e.selectedServiceItem.splice(a,1);var n=e.currentSelectedNames.indexOf(i);-1===n?e.currentSelectedNames.push(i):e.currentSelectedNames.splice(n,1)},e.ok=function(){i.close(t)},e.cancel=function(){i.dismiss("cancel")},e.loadServiceItemList()}]),i.controller("editPicModalCtrl",["$scope","picsInfo","$modalInstance","ycsApi","ycsUtil","Notification","$timeout","$interval",function(e,t,i,a,n,l,r,s){e.picsInfo=t,e.pics=e.picsInfo.pics,e.tempPics=e.pics,e.uploadBtnDisabled=!1,e.setToCover=function(t){var i=e.tempPics.splice(t,1);i=i.toString(),e.tempPics.unshift(i),e.pics=e.tempPics},e.delPic=function(t){e.tempPics.splice(t,1)},e.imageUploaded=function(t){e.pics.push(t),n.disableButton(e,!1)},e.uploadImage=function(t){n.uploadImage(t,"serviceicon",e.imageUploaded,e)},e.$on("imageSelected",function(t,i){e.$apply(function(){e.uploadImage(i),n.disableButton(e,!0)})}),e.save=function(e){t.pics=e,i.close(t)},e.cancel=function(){i.dismiss("cancel")}}])}(window.angular,window.UE),function(e){"use strict";var t=e.module("backendApp");t.controller("serviceCtrl",["$scope","ycsUtil","ycsApi","uiGridConstants","Notification","$modal",function(e,t,i,a,n,l){e.tempArray=[],e.isEditStatus=!1,e.loadingGrid=!0,e.toggleSelection=function(t){var i=e.tempArray.indexOf(t);-1===i?e.tempArray.push(t):e.tempArray.splice(i,1)},e.gridOptions={enableSorting:!0,enableFiltering:!0,flatEntityAccess:!0,onRegisterApi:function(t){e.gridApi=t,t.selection.on.rowSelectionChanged(e,function(t){e.toggleSelection(t.entity.serviceid)}),t.selection.on.rowSelectionChangedBatch(e,function(t){t.forEach(function(t){e.toggleSelection(t.entity.serviceid)})})},columnDefs:[{field:"name",displayName:"服务名称",filter:{placeholder:"搜索..."},enableHiding:!1},{field:"code",displayName:"服务编号",width:120,type:"number",filter:{placeholder:"搜索..."},cellClass:"text-center",headerCellClass:"text-center",enableHiding:!1},{field:"serviceid",displayName:"操作",width:100,cellTemplate:'<div class="ui-grid-cell-contents"><a ui-sref="service.pack.edit({serviceId:COL_FIELD})">编辑</a></div>',cellClass:"text-center",headerCellClass:"text-center",enableColumnMenu:!1,enableSorting:!1,enableFiltering:!1,enableHiding:!1},{field:"status",displayName:"是否上架",width:100,filter:{type:a.filter.SELECT,selectOptions:[{value:"0",label:"否"},{value:"1",label:"是"}]},cellTemplate:'<div class="ui-grid-cell-contents"><span class="is-true" ng-if="COL_FIELD === 1">是</span><span class="is-false" ng-if="COL_FIELD === 0">否</span></div>',cellClass:"text-center",headerCellClass:"text-center",enableHiding:!1},{field:"tag",displayName:"标签",filter:{placeholder:"搜索..."},enableHiding:!1},{field:"categorynames",displayName:"所在分类",filter:{placeholder:"搜索..."},enableHiding:!1},{field:"serviceid",displayName:"统计数据",width:100,cellTemplate:'<div class="ui-grid-cell-contents"><a ng-click="grid.appScope.checkParameter(COL_FIELD)"><i class="fa fa-bar-chart"></i></a></div>',enableColumnMenu:!1,cellClass:"text-center",headerCellClass:"text-center",enableFiltering:!1,enableSorting:!1,enableHiding:!1}]},e.clearAll=function(){e.gridApi.selection.clearSelectedRows(),e.tempArray=[],e.isEditStatus=!1},e.startToEditStatus=function(){e.isEditStatus=!0},e.statusChanged=function(t){n.success("已修改"),e.getExistingData()},e.editStatus=function(t){var a="admin/service/modifyStatus",n={serviceids:e.tempArray.join(","),status:Number(t)};i.post(a,n,e.statusChanged)},e.getExistingData=function(){e.loadingGrid=!0;var t="admin/service/queryServiceList",a={};i.post(t,a,e.fillExitingData)},e.fillExitingData=function(t){e.gridOptions.data=t.re.list,e.gridApi.selection.clearSelectedRows(),e.isEditStatus=!1,e.tempArray=[],e.loadingGrid=!1},e.checkParameter=function(e){l.open({animation:!0,templateUrl:"tpl/modal/relativeParameter.html",size:"md",controller:["$scope","$modalInstance",function(t,a){t.ok=function(){a.close()},t.close=function(){a.dismiss("cancel")},t.getParameter=function(){var a="admin/service/queryServiceUrl",n={serviceid:e};i.post(a,n,t.renderParameter)},t.renderParameter=function(e){t.detail=e.re},t.getParameter()}]})},e.supportArea=function(e,t){l.open({animation:!0,templateUrl:"tpl/modal/supportArea.html",size:"xl",controller:"serviceSupportAreaModalCtrl",resolve:{supportAreas:function(){return{serviceid:e,servicename:t}}}})},e.addTagsCompound=function(){var t=l.open({animation:!0,templateUrl:"tpl/modal/addTags.html",size:"lg",backdrop:"static",controller:"tagsCompoundCtrl",resolve:{tagsCmpInfo:function(){return{currentSelected:[],ids:e.tempArray,ajaxUrl:"admin/service/modifyTags",isBulkEdit:!0}}}});t.result.then(function(t){n.success("标签已更新"),e.getExistingData()})},e.getExistingData()}]),t.controller("serviceSupportAreaModalCtrl",["$scope","supportAreas","$modalInstance","ycsApi",function(e,t,i,a){e.supportAreas=t,e.servicename=t.servicename,e.isLoading=!0,e.detail={},e.ok=function(){i.close(t)},e.cancel=function(){i.dismiss("cancel")},e.renderData=function(t){var i=[];e.tempArea=t.re.provinces,e.tempArea.forEach(function(e){var t=e.name;e.cities.forEach(function(e){var a=e.cityname,n="";e.supportdistricts&&e.supportdistricts.length>0?e.supportdistricts.forEach(function(e,t){n+=(t>0?", ":"")+e.districtname}):n="—";var l="";e.unsupportdistricts&&e.unsupportdistricts.length>0?e.unsupportdistricts.forEach(function(e,t){l+=(t>0?", ":"")+e.districtname}):l="—",i.push({province:t,city:a,districtStatus:{support:n,unsupport:l}})})}),e.detail.list=i,e.isLoading=!1},e.getData=function(){var t="admin/service/queryServiceArea",i={serviceid:e.supportAreas.serviceid};a.post(t,i,e.renderData)},e.getData()}])}(window.angular),function(e){"use strict";var t=e.module("backendApp");t.controller("supportRegionCtrl",["$scope","ycsUtil","ycsApi","Notification","$modal","$rootScope",function(e,t,i,a,n,l){e.detail={},e.getData=function(){var t="admin/service/queryServiceArea",a={serviceid:e.serviceId};i.post(t,a,e.renderData)},e.renderData=function(t){e.detail.servicename=t.re.servicename,e.detail.servicecode=t.re.servicecode;var i=[];e.tempArea=t.re.provinces,e.tempArea.forEach(function(e){var t=e.name;e.cities.forEach(function(e){var a=e.cityname,n="",l="";e.supportdistricts.forEach(function(e,t){n+=(t>0?", ":"")+e.districtname,l+=(t>0?", ":"")+e.servicers}),i.push({province:t,city:a,districts:n,servicers:l})})}),e.detail.list=i},e.getData()}])}(window.angular),function(e){"use strict";var t=e.module("backendApp");t.controller("attentionCtrl",["$scope","ycsUtil","ycsApi","Notification","$modal",function(e,t,i,a,n){e.loadingGrid=!0,e.gridOptions={enableSorting:!0,enableFiltering:!0,flatEntityAccess:!0,onRegisterApi:function(t){e.gridApi=t},columnDefs:[{field:"id",displayName:"操作",width:80,enableHiding:!1,cellClass:"text-center",headerCellClass:"text-center",enableColumnMenu:!1,cellTemplate:'<div class="ui-grid-cell-contents"><a ng-click="grid.appScope.editData(COL_FIELD, \'edit\')">编辑</a></div>',enableSorting:!1,enableFiltering:!1},{field:"name",displayName:"注意事项标题",filter:{placeholder:"搜索..."},enableHiding:!1},{field:"description",displayName:"注意事项正文",filter:{placeholder:"搜索..."},enableHiding:!1,enableSorting:!1},{field:"tag",displayName:"标签",filter:{placeholder:"搜索..."},enableHiding:!1},{field:"sort",displayName:"排序",width:100,type:"number",enableHiding:!1,cellClass:"text-center",headerCellClass:"text-center",enableFiltering:!1}]},e.fillExitingData=function(t){e.gridOptions.data=t.re.tabList,e.loadingGrid=!1},e.getExistingData=function(){e.loadingGrid=!0;var t="admin/specdefine/specdefineList",a={pid:5};i.post(t,a,e.fillExitingData)},e.openModal=function(t,i,a){var l=n.open({animation:!0,templateUrl:"tpl/modal/predefinded/editWithTag.html",size:"lg",controller:"attentionModalCtrl",backdrop:"static",resolve:{predefInfo:function(){return{id:t,func:i,data:a.re||{}}}}});l.result.then(function(t){e.getExistingData()})},e.editData=function(t,a){if("edit"===a){var n="admin/specdefine/specdefineById",l={specdefineid:t};i.post(n,l,e.openModal.bind(this,t,a))}else e.openModal(null,"add",{})},e.getExistingData()}]),t.controller("attentionModalCtrl",["$scope","predefInfo","$modalInstance","ycsApi","ycsUtil","Notification","$filter",function(t,i,a,n,l,r,s){if(t.predefInfo=i,t.isEdit=!1,t.title="attention",t.tagList=[],"add"===i.func)t.detail={},t.detail.tagsInput=[];else if(t.isEdit=!0,t.detail=e.extend({},i.data),t.detail.tagsInput=[],t.detail.tag&&t.detail.tag.length>0){var c=l.spliter(t.detail.tag,",");c.forEach(function(e){e.length>0&&t.detail.tagsInput.push({text:e})})}t.detail.itemSort=e.isNumber(t.detail.sort)&&t.detail.sort>0?t.detail.sort:0,t.dataSaved=function(){r.success("保存成功！"),a.close(i)},t.loadTags=function(e){return s("filter")(t.tagList,{$:e})},t.renderTagList=function(e){t.tagList=[],e.re&&e.re.tags&&e.re.tags.length>0&&e.re.tags.forEach(function(e){t.tagList.push({text:e})})},t.getAllTags=function(){var e="admin/tag/getAllTag",i={};n.post(e,i,t.renderTagList)},t.save=function(i){var a,l=i;t.isEdit?(a="admin/specdefine/editSpecdefine",l.specdefineid=t.detail.id):a="admin/specdefine/addSpecdefine",l.tag="",i.tagsInput.forEach(function(e,t){l.tag+=(t>0?",":"")+e.text}),l.pid=5,l.type=0,l.sort=e.isNumber(i.itemSort)&&i.itemSort>0?i.itemSort:0,n.post(a,l,t.dataSaved)},t.cancel=function(){a.dismiss("cancel")},t.getAllTags()}])}(window.angular),function(e){"use strict";var t=e.module("backendApp");t.controller("faqCtrl",["$scope","ycsUtil","ycsApi","Notification","$modal",function(e,t,i,a,n){e.loadingGrid=!0,e.gridOptions={enableSorting:!0,enableFiltering:!0,flatEntityAccess:!0,onRegisterApi:function(t){e.gridApi=t},columnDefs:[{field:"id",displayName:"操作",width:80,enableHiding:!1,cellClass:"text-center",headerCellClass:"text-center",enableColumnMenu:!1,cellTemplate:'<div class="ui-grid-cell-contents"><a ng-click="grid.appScope.editData(COL_FIELD, \'edit\')">编辑</a></div>',enableSorting:!1,enableFiltering:!1},{field:"name",displayName:"常见问题标题",filter:{placeholder:"搜索..."},enableHiding:!1},{field:"description",displayName:"常见问题正文",filter:{placeholder:"搜索..."},enableHiding:!1,enableSorting:!1},{field:"tag",displayName:"标签",filter:{placeholder:"搜索..."},enableHiding:!1},{field:"sort",displayName:"排序",width:100,type:"number",enableHiding:!1,cellClass:"text-center",headerCellClass:"text-center",enableSorting:!0,enableFiltering:!1}]},e.fillExitingData=function(t){e.gridOptions.data=t.re.tabList,e.loadingGrid=!1},e.getExistingData=function(){e.loadingGrid=!0;var t="admin/specdefine/specdefineList",a={pid:6};i.post(t,a,e.fillExitingData)},e.openModal=function(t,i,a){var l=n.open({animation:!0,templateUrl:"tpl/modal/predefinded/editWithTag.html",size:"lg",controller:"faqModalCtrl",backdrop:"static",resolve:{predefInfo:function(){return{id:t,func:i,data:a.re||{}}}}});l.result.then(function(t){e.getExistingData()})},e.editData=function(t,a){if("edit"===a){var n="admin/specdefine/specdefineById",l={specdefineid:t};i.post(n,l,e.openModal.bind(this,t,a))}else e.openModal(null,"add",{})},e.getExistingData()}]),t.controller("faqModalCtrl",["$scope","predefInfo","$modalInstance","ycsApi","ycsUtil","Notification","$filter",function(t,i,a,n,l,r,s){if(t.predefInfo=i,t.isEdit=!1,t.title="faq",t.tagList=[],"add"===i.func)t.detail={},t.detail.tagsInput=[];else if(t.isEdit=!0,t.detail=e.extend({},i.data),t.detail.tagsInput=[],t.detail.tag&&t.detail.tag.length>0){var c=l.spliter(t.detail.tag,",");c.forEach(function(e){e.length>0&&t.detail.tagsInput.push({text:e})})}t.detail.itemSort=e.isNumber(t.detail.sort)&&t.detail.sort>0?t.detail.sort:0,t.dataSaved=function(){r.success("保存成功！"),a.close(i)},t.loadTags=function(e){return s("filter")(t.tagList,{$:e})},t.renderTagList=function(e){t.tagList=[],e.re&&e.re.tags&&e.re.tags.length>0&&e.re.tags.forEach(function(e){t.tagList.push({text:e})})},t.getAllTags=function(){var e="admin/tag/getAllTag",i={};n.post(e,i,t.renderTagList)},t.save=function(i){var a,l=i;t.isEdit?(a="admin/specdefine/editSpecdefine",l.specdefineid=t.detail.id):a="admin/specdefine/addSpecdefine",l.tag="",i.tagsInput.forEach(function(e,t){l.tag+=(t>0?",":"")+e.text}),l.pid=6,l.type=0,l.sort=e.isNumber(i.itemSort)&&i.itemSort>0?i.itemSort:0,n.post(a,l,t.dataSaved)},t.cancel=function(){a.dismiss("cancel")},t.getAllTags()}])}(window.angular),function(e){"use strict";var t=e.module("backendApp");t.controller("invoiceCtrl",["$scope","ycsUtil","ycsApi","Notification","$modal",function(e,t,i,a,n){e.loadingGrid=!0,e.gridOptions={enableSorting:!0,flatEntityAccess:!0,columnDefs:[{field:"id",displayName:"操作",width:80,cellClass:"text-center",headerCellClass:"text-center",enableColumnMenu:!1,enableHiding:!1,cellTemplate:'<div class="ui-grid-cell-contents"><a ng-click="grid.appScope.editData(COL_FIELD, \'edit\')">编辑</a></div>',enableSorting:!1},{field:"name",displayName:"发票类型名称",enableHiding:!1},{field:"description",displayName:"相关描述",enableHiding:!1,enableSorting:!1},{field:"sort",displayName:"排序",width:100,type:"number",cellClass:"text-center",headerCellClass:"text-center",enableHiding:!1,enableSorting:!0}]},e.fillExitingData=function(t){e.gridOptions.data=t.re.tabList,e.loadingGrid=!1},e.getExistingData=function(){e.loadingGrid=!0;var t="admin/specdefine/specdefineList",a={pid:4};i.post(t,a,e.fillExitingData)},e.openModal=function(t,i,a){var l=n.open({animation:!0,templateUrl:"tpl/modal/predefinded/edit.html",size:"lg",controller:"invoiceModalCtrl",backdrop:"static",resolve:{predefInfo:function(){return{id:t,func:i,data:a.re||{}}}}});l.result.then(function(t){e.getExistingData()})},e.editData=function(t,a){if("edit"===a){var n="admin/specdefine/specdefineById",l={specdefineid:t};i.post(n,l,e.openModal.bind(this,t,a))}else e.openModal(null,"add",{})},e.getExistingData()}]),t.controller("invoiceModalCtrl",["$scope","predefInfo","$modalInstance","ycsApi","Notification",function(t,i,a,n,l){t.predefInfo=i,t.isEdit=!1,t.title="invoice","add"===i.func?t.detail={}:(t.isEdit=!0,t.detail=e.extend({},i.data)),t.detail.itemSort=e.isNumber(t.detail.sort)&&t.detail.sort>0?t.detail.sort:0,
t.dataSaved=function(){l.success("保存成功！"),a.close(i)},t.save=function(i){var a,l=i;t.isEdit?(a="admin/specdefine/editSpecdefine",l.specdefineid=t.detail.id):a="admin/specdefine/addSpecdefine",l.pid=4,l.type=0,l.sort=e.isNumber(i.itemSort)&&i.itemSort>0?i.itemSort:0,n.post(a,l,t.dataSaved)},t.cancel=function(){a.dismiss("cancel")}}])}(window.angular),function(e){"use strict";var t=e.module("backendApp");t.controller("materialCtrl",["$scope","ycsUtil","ycsApi","Notification","$modal",function(e,t,i,a,n){e.loadingGrid=!0,e.gridOptions={enableSorting:!0,enableFiltering:!0,flatEntityAccess:!0,onRegisterApi:function(t){e.gridApi=t},columnDefs:[{field:"id",displayName:"操作",width:80,enableHiding:!1,cellClass:"text-center",headerCellClass:"text-center",enableColumnMenu:!1,cellTemplate:'<div class="ui-grid-cell-contents"><a ng-click="grid.appScope.editData(COL_FIELD, \'edit\')">编辑</a></div>',enableSorting:!1,enableFiltering:!1},{field:"name",displayName:"需提供材料",filter:{placeholder:"搜索..."},enableHiding:!1},{field:"description",displayName:"相关描述",filter:{placeholder:"搜索..."},enableHiding:!1,enableSorting:!1},{field:"sort",displayName:"排序",width:100,type:"number",enableHiding:!1,cellClass:"text-center",headerCellClass:"text-center",enableSorting:!0,enableFiltering:!1}]},e.fillExitingData=function(t){e.gridOptions.data=t.re.tabList,e.loadingGrid=!1},e.getExistingData=function(){e.loadingGrid=!0;var t="admin/specdefine/specdefineList",a={pid:3};i.post(t,a,e.fillExitingData)},e.openModal=function(t,i,a){var l=n.open({animation:!0,templateUrl:"tpl/modal/predefinded/edit.html",size:"lg",controller:"materialeModalCtrl",backdrop:"static",resolve:{predefInfo:function(){return{id:t,func:i,data:a.re||{}}}}});l.result.then(function(t){e.getExistingData()})},e.editData=function(t,a){if("edit"===a){var n="admin/specdefine/specdefineById",l={specdefineid:t};i.post(n,l,e.openModal.bind(this,t,a))}else e.openModal(null,"add",{})},e.getExistingData()}]),t.controller("materialeModalCtrl",["$scope","predefInfo","$modalInstance","ycsApi","Notification",function(t,i,a,n,l){t.predefInfo=i,t.isEdit=!1,t.title="material","add"===i.func?t.detail={}:(t.isEdit=!0,t.detail=e.extend({},i.data)),t.detail.itemSort=e.isNumber(t.detail.sort)&&t.detail.sort>0?t.detail.sort:0,t.dataSaved=function(){l.success("保存成功！"),a.close(i)},t.save=function(i){var a,l=i;t.isEdit?(a="admin/specdefine/editSpecdefine",l.specdefineid=t.detail.id):a="admin/specdefine/addSpecdefine",l.pid=3,l.type=0,l.sort=e.isNumber(i.itemSort)&&i.itemSort>0?i.itemSort:0,n.post(a,l,t.dataSaved)},t.cancel=function(){a.dismiss("cancel")}}])}(window.angular),function(e){"use strict";var t=e.module("backendApp");t.controller("requirementCtrl",["$scope","ycsUtil","ycsApi","Notification","$modal",function(e,t,i,a,n){e.loadingGrid=!0,e.gridOptions={enableSorting:!0,enableFiltering:!0,flatEntityAccess:!0,onRegisterApi:function(t){e.gridApi=t},columnDefs:[{field:"id",displayName:"操作",width:80,enableHiding:!1,cellClass:"text-center",headerCellClass:"text-center",enableColumnMenu:!1,cellTemplate:'<div class="ui-grid-cell-contents"><a ng-click="grid.appScope.editData(COL_FIELD, \'edit\')">编辑</a></div>',enableFiltering:!1,enableSorting:!1},{field:"name",displayName:"需满足条件",filter:{placeholder:"搜索..."},enableHiding:!1},{field:"description",displayName:"相关描述",filter:{placeholder:"搜索..."},enableHiding:!1,enableSorting:!1},{field:"sort",displayName:"排序",width:100,type:"number",enableHiding:!1,cellClass:"text-center",headerCellClass:"text-center",enableFiltering:!1}]},e.fillExitingData=function(t){e.gridOptions.data=t.re.tabList,e.loadingGrid=!1},e.getExistingData=function(){e.loadingGrid=!0;var t="admin/specdefine/specdefineList",a={pid:2};i.post(t,a,e.fillExitingData)},e.openModal=function(t,i,a){var l=n.open({animation:!0,templateUrl:"tpl/modal/predefinded/edit.html",size:"lg",controller:"requirementModalCtrl",backdrop:"static",resolve:{predefInfo:function(){return{id:t,func:i,data:a.re||{}}}}});l.result.then(function(t){e.getExistingData()})},e.editData=function(t,a){if("edit"===a){var n="admin/specdefine/specdefineById",l={specdefineid:t};i.post(n,l,e.openModal.bind(this,t,a))}else e.openModal(null,"add",{})},e.getExistingData()}]),t.controller("requirementModalCtrl",["$scope","predefInfo","$modalInstance","ycsApi","Notification",function(t,i,a,n,l){t.predefInfo=i,t.isEdit=!1,t.title="requirement","add"===i.func?t.detail={}:(t.isEdit=!0,t.detail=e.extend({},i.data)),t.detail.itemSort=e.isNumber(t.detail.sort)&&t.detail.sort>0?t.detail.sort:0,t.dataSaved=function(){l.success("保存成功！"),a.close(i)},t.save=function(i){var a,l=i;t.isEdit?(a="admin/specdefine/editSpecdefine",l.specdefineid=t.detail.id):a="admin/specdefine/addSpecdefine",l.pid=2,l.type=0,l.sort=e.isNumber(i.itemSort)&&i.itemSort>0?i.itemSort:0,n.post(a,l,t.dataSaved)},t.cancel=function(){a.dismiss("cancel")}}])}(window.angular),function(e){"use strict";var t=e.module("backendApp"),i='<div><form name="inputForm"><textarea ng-class="\'colt\' + col.uid" ui-grid-editor ng-model="MODEL_COL_FIELD"></form></div>';t.controller("specsCtrl",["$scope","ycsUtil","ycsApi","uiGridConstants","Notification","$modal",function(e,t,a,n,l,r){e.loadingGrid=!0,e.gridOptions={enableSorting:!0,enableFiltering:!0,flatEntityAccess:!0,onRegisterApi:function(t){e.gridApi=t},columnDefs:[{field:"id",displayName:"操作",width:80,enableHiding:!1,cellClass:"text-center",headerCellClass:"text-center",enableColumnMenu:!1,enableSorting:!1,cellTemplate:'<div class="ui-grid-cell-contents"><a ng-click="grid.appScope.editData(COL_FIELD, \'edit\')">编辑</a></div>',enableFiltering:!1},{field:"name",displayName:"规格名称",filter:{placeholder:"搜索..."},enableHiding:!1},{field:"description",displayName:"相关描述",filter:{placeholder:"搜索..."},enableHiding:!1,enableSorting:!1,editableCellTemplate:i},{field:"_options",displayName:"规格值及价格调整",filter:{placeholder:"搜索..."},cellClass:"preserve-format",enableHiding:!1,enableSorting:!1},{field:"type",displayName:"允许多选",width:100,filter:{type:n.filter.SELECT,selectOptions:[{value:1,label:"否"},{value:2,label:"是"}]},enableHiding:!1,cellClass:"text-center",headerCellClass:"text-center",cellTemplate:'<div class="ui-grid-cell-contents"><span class="is-true" ng-if="COL_FIELD === 2">是</span><span class="is-false" ng-if="COL_FIELD === 1">否</span></div>'},{field:"sort",displayName:"排序",width:100,type:"number",enableHiding:!1,cellClass:"text-center",headerCellClass:"text-center",enableFiltering:!1}]},e.shapeOptionsCol=function(){var t=e.gridOptions.data;0!==t.length&&t.forEach(function(e){var t=e.options.split("|"),i=[];t.forEach(function(e){i.push(e.substr(e.indexOf(",")+1))}),e._options=i.join("\n")})},e.fillExitingData=function(t){e.gridOptions.data=t.re.tabList,e.shapeOptionsCol(),e.loadingGrid=!1},e.getExistingData=function(){e.loadingGrid=!0;var t="admin/specdefine/specdefineList",i={pid:1};a.post(t,i,e.fillExitingData)},e.openModal=function(t,i,a){var n=r.open({animation:!0,templateUrl:"tpl/modal/predefinded/editWithOption.html",size:"xl",controller:"specsModalCtrl",backdrop:"static",resolve:{predefInfo:function(){return{id:t,func:i,data:a.re||{}}}}});n.result.then(function(t){e.getExistingData()})},e.editData=function(t,i){if("edit"===i){var n="admin/specdefine/specdefineById",l={specdefineid:t};a.post(n,l,e.openModal.bind(this,t,i))}else e.openModal(null,"add",{})},e.getExistingData()}]),t.controller("specsModalCtrl",["$scope","predefInfo","$modalInstance","ycsApi","Notification",function(t,i,a,n,l){t.predefInfo=i,t.isEdit=!1;var r=0;t.predefInfo.data&&t.predefInfo.data.cutOptions?(r=t.predefInfo.data.cutOptions.length-1,t.maxSort=Number(t.predefInfo.data.cutOptions[r].sort)):t.maxSort=-1,"add"===i.func?(t.detail={},t.detail.cutOptions=[{}]):(t.isEdit=!0,t.detail=e.extend({},i.data)),t.addOptions=function(){t.detail.cutOptions.push({})},t.detail.itemSort=e.isNumber(t.detail.sort)&&t.detail.sort>0?t.detail.sort:0,t.dataSaved=function(){l.success("保存成功！"),a.close(i)},t.delOption=function(e){t.detail.cutOptions.splice(e,1)},t.save=function(a){var l,r=a,s=[];l=t.isEdit?"admin/specdefine/editSpecdefine":"admin/specdefine/addSpecdefine",r.specdefineid=t.detail.id,r.pid=1,r.sort=e.isNumber(a.itemSort)&&a.itemSort>0?a.itemSort:0,a.cutOptions.forEach(function(e,a){if(e.name&&e.name.length>0&&e.unit&&e.unit.length>0){var n;n="add"===i.func?a:e.sort||0===e.sort?e.sort:++t.maxSort,s.push(n+","+e.name.replace(/ /g,"")+","+(e.price||0)+","+e.unit)}});var c=""+s.join("|");r.options=c,n.post(l,r,t.dataSaved)},t.cancel=function(){a.dismiss("cancel")}}])}(window.angular),function(e){"use strict";var t=e.module("backendApp"),i={11:"次",12:"个",5:"年",4:"半年",3:"季度",2:"月",1:"日"};t.controller("serviceItemEditCtrl",["$scope","ycsUtil","ycsApi","Notification","$modal","$filter","$state",function(t,a,n,l,r,s,c){t.animationsEnabled=!0,t.isAddNew=!1,t.noRegion=!1,t.isEditing=!1,t.stepsTemplate=[{title:"办证流程",steps:[{sort:1,name:"筹办申请"},{sort:2,name:"相关部门材料受理"},{sort:3,name:"审核"},{sort:4,name:"审批完成"},{sort:5,name:"办结"}]}],t.regionUnitOpts=[{value:11,label:"元/次"},{value:12,label:"元/个"},{value:5,label:"元/年"},{value:4,label:"元/半年"},{value:3,label:"元/季度"},{value:2,label:"元/月"},{value:1,label:"元/日"},{value:99,label:"元起"}],t.backToList=function(){c.go("service.item")},t.fillExistingData=function(e){if(e&&e.re&&(t.qData=e.re,t.qData.tagsInput=[],t.qData.tag&&t.qData.tag.length>0)){var i=a.spliter(t.qData.tag,",");i.forEach(function(e){e.length>0&&t.qData.tagsInput.push({text:e})})}},t.fillSpecsBlock=function(e,i){t.currentRegion.globalSpecs=[];var a=i.re.tabList;a.forEach(function(i){-1!==e.indexOf(i.id)&&t.currentRegion.globalSpecs.push(i)})},t.getSpecs=function(e){var i="admin/specdefine/specdefineList",a={pid:1};n.post(i,a,t.fillSpecsBlock.bind(this,e))},t.fillCurrentRegionalData=function(e){if(t.currentRegion=e.re[0],t.currentRegion.specs=[],t.currentRegion.selectedSpecOpts={},t.currentRegion.stepdetail&&t.currentRegion.stepdetail.length>2?t.currentRegion.serviceSteps=a.spliter(t.currentRegion.stepdetail,","):t.currentRegion.serviceSteps=[],t.currentRegion.conditions&&t.currentRegion.conditions.length>2){var i,n=a.spliter(t.currentRegion.conditions,"|");t.currentRegion.requirements=[],n.forEach(function(e){i=a.spliter(e,","),t.currentRegion.requirements.push({text:i[1],id:Number(i[0])})})}else t.currentRegion.requirements=[];if(t.currentRegion.documents&&t.currentRegion.documents.length>2){var l,r=a.spliter(t.currentRegion.documents,"|");t.currentRegion.docs=[],r.forEach(function(e){l=a.spliter(e,","),t.currentRegion.docs.push({text:l[1],id:Number(l[0])})})}else t.currentRegion.docs=[];t.currentRegion.option.length>0&&(t.currentRegion.option.forEach(function(e){t.currentRegion.specs.push(e.ssdid),t.currentRegion.selectedSpecOpts[e.ssdid]={},t.currentRegion.selectedSpecOpts[e.ssdid].selected=[],e.cutOptions&&e.cutOptions.length>0&&e.cutOptions.forEach(function(i){t.currentRegion.selectedSpecOpts[e.ssdid].selected.push(i.name),t.currentRegion.selectedSpecOpts[e.ssdid][i.name]=i})}),t.currentRegion.specs.length>0&&t.getSpecs(t.currentRegion.specs))},t.getItemData=function(e){if(e=e||t.itemId,!e||"new"===e)return t.isAddNew=!0,void(t.qData={});var i="admin/serviceItem/serviceDetailItem",a={service_itemid:e};n.post(i,a,t.fillExistingData)},t.getRegionData=function(e,i,a){if(!t.isEditing)if(0!==t.qData.regionalList.length||a){t.noRegion=!1;var l="admin/serviceItem/serviceDetailRegional",r={service_itemid:e};void 0!==i&&null!==i&&(r.service_itemdetailid=i),n.post(l,r,t.fillCurrentRegionalData)}else t.noRegion=!0},t.switchRegion=function(e){t.currentRegion=[],t.getRegionData(t.itemId,e)},t.cloneExistingRegionData=function(e,i){i.re[0].city=e.districtCode,i.re[0].nickname=e.nickname,delete i.re[0].service_itemdetailid,t.saveRegionVersion(i.re[0])},t.addAreaVersion=function(e){if(t.isEditing=!0,e)return t.currentRegion={city:0,nickname:"全国",requirements:[],docs:[],specs:[],serviceSteps:[],stepDetail:[],option:[]},void(t.noRegion=!1);var i=r.open({animation:!0,templateUrl:"tpl/modal/addAreas.html",size:"md",controller:"selectAreaCtrl",backdrop:"static",resolve:{areaInfo:function(){return{districtCode:null,nickname:""}}}});i.result.then(function(e){var i="admin/serviceItem/serviceDetailRegional",a={service_itemid:t.qData.service_itemid};n.post(i,a,t.cloneExistingRegionData.bind(this,e))})},t.editRequirement=function(){var e=r.open({animation:!0,templateUrl:"tpl/modal/neededCondition.html",size:"xl",controller:"editRequirementDetail",backdrop:"static",resolve:{requirementDetail:function(){return{currentSelected:t.currentRegion.requirements}}}});e.result.then(function(e){t.currentRegion.requirements=e.currentSelected})},t.editDocument=function(){var e=r.open({animation:!0,templateUrl:"tpl/modal/neededDocs.html",size:"xl",controller:"editDocsDetail",backdrop:"static",resolve:{documentsDetail:function(){return{currentSelected:t.currentRegion.docs}}}});e.result.then(function(e){t.currentRegion.docs=e.currentSelected})},t.editSpecs=function(){var i=!t.currentRegion.specs||t.currentRegion.specs&&t.currentRegion.specs.length<1;t.oldRegionSpecs=i?{}:e.extend({},t.currentRegion),t.before=i?[]:e.extend([],t.currentRegion.specs);var a=r.open({animation:!0,templateUrl:"tpl/modal/supportedSpecs.html",size:"lg",controller:"editSpecsDetail",backdrop:"static",resolve:{specsDetail:function(){return{currentSelected:t.currentRegion.specs}}}});a.result.then(function(a){if(i)t.currentRegion.globalSpecs=a.options,t.currentRegion.selectedSpecOpts={},a.options.forEach(function(e){t.currentRegion.selectedSpecOpts[e.ssdid]={},t.currentRegion.selectedSpecOpts[e.ssdid].selected=[]}),t.currentRegion.option=e.extend([],a.options);else{var n=[];t.before&&t.before.length>0&&(t.oldRegionSpecs.globalSpecs.forEach(function(e){-1!==t.before.indexOf(e.id)&&n.push(e)}),a.options.forEach(function(e){-1===t.before.indexOf(e.id)&&(n.push(e),t.currentRegion.selectedSpecOpts[e.ssdid]={},t.currentRegion.selectedSpecOpts[e.ssdid].selected=[])}),t.currentRegion.globalSpecs=n,t.currentRegion.option=e.extend([],n))}})},t.editSteps=function(e,i){var a=r.open({animation:!0,controller:"editServiceItemSteps",templateUrl:"tpl/modal/serviceItemSteps.html",size:"md",backdrop:"static",resolve:{stepsInformation:function(){return{isNewStep:i,stepIndex:i?t.currentRegion.stepDetail.length:e,stepsObject:t.currentRegion.stepDetail,info:{}}}}});a.result.then(function(e){t.currentRegion.stepDetail[e.stepIndex]=e.info,t.currentRegion.serviceSteps[e.stepIndex]=e.info.name})},t.delRequirement=function(e){t.currentRegion.requirements.splice(e,1)},t.delDoc=function(e){t.currentRegion.docs.splice(e,1)},t.delSteps=function(e){t.currentRegion.stepDetail.splice(e,1),t.currentRegion.serviceSteps.splice(e,1)},t.delSpecs=function(e){t.currentRegion.globalSpecs.splice(e,1),t.currentRegion.option.splice(e,1),t.currentRegion.specs=[],t.currentRegion.selectedSpecOpts&&t.currentRegion.selectedSpecOpts.length>0&&t.currentRegion.selectedSpecOpts.forEach(function(e){t.currentRegion.specs.push(e.ssdid)})},t.checkIfSelected=function(e,i){var a=t.currentRegion.selectedSpecOpts[e].selected.indexOf(i);return-1===a?!1:!0},t.toggleOptSelection=function(e,i){var a=i.name,n=t.currentRegion.selectedSpecOpts[e].selected.indexOf(a);-1===n?(t.currentRegion.selectedSpecOpts[e].selected.push(a),t.currentRegion.selectedSpecOpts[e][a]=i):(t.currentRegion.selectedSpecOpts[e].selected.splice(n,1),delete t.currentRegion.selectedSpecOpts[e][a])},t.infoSaved=function(e){l.success("基础信息保存成功"),t.backToList()},t.currentRegionSaved=function(e){t.noRegion=!1,t.isEditing=!1,l.success("当前区域版本信息已保存"),t.getRegionData(t.itemId,t.currentRegion.service_itemdetailid,!0)},t.saveInfo=function(e){var i=e?"admin/serviceItem/addService":"admin/serviceItem/editService",a=t.qData;a.tag="",a.tagsInput.forEach(function(e,t){a.tag+=(t>0?",":"")+e.text}),n.post(i,a,t.infoSaved)},t.saveRegionVersion=function(a){var r="admin/serviceItem/editServiceDetail",s={};if(s.service_itemid=t.qData.service_itemid,s.name=t.qData.name,a.unitname=i[a.unit],a.requirements&&a.requirements.length>0){var c=[];a.requirements.forEach(function(e){c.push(e.id)});var o=c.join(",");a.conditions=o}else a.conditions="";if(a.docs&&a.docs.length>0){var d=[];a.docs.forEach(function(e){d.push(e.id)});var u=d.join(",");a.documents=u}else a.documents="";var p={};if(t.currentRegion.selectedSpecOpts&&Object.keys(t.currentRegion.selectedSpecOpts).length>0&&Object.keys(t.currentRegion.selectedSpecOpts).forEach(function(e){var i=t.currentRegion.selectedSpecOpts[e],a=[];i.selected.forEach(function(e){a.push(i[e])}),p[e]=a}),a.option&&a.option.length>0){var f=[];a.option.forEach(function(e){!e.ssdid&&e.id&&(e.ssdid=e.id),!e.id&&e.ssdid&&(e.id=e.ssdid),e.cutOptions=p[e.ssdid||e.id];var t=[];e.cutOptions&&e.cutOptions.length>0?(e.cutOptions.forEach(function(e,i){t.push([i,e.name,e.price,e.unit].join(","))}),e.options=t.join("|"),f.push(e)):l.warning({title:"注意",message:"您在“"+e.name+"”中未选择任何规格值，该服务规格添加失败。",delay:1e4})}),a.option=f}a.option&&0===a.option.length&&delete a.option;var g="";a.stepDetail&&a.stepDetail.length>0?(a.steps=a.stepDetail.length,a.stepDetail.forEach(function(e,t){e.sort=t+1,g+=(t>0?",":"")+e.name})):a.steps=0,a.stepdetail=g,s.regional=e.toJson(a),n.post(r,s,t.currentRegionSaved)},t.loadTags=function(e){return s("filter")(t.tagList,{$:e})},t.renderTagList=function(e){t.tagList=[],e.re&&e.re.sort&&e.re.sort.length>0&&e.re.sort.forEach(function(e){t.tagList.push({text:e.name})})},t.getAllTags=function(){var e="admin/article/getTag",i={};n.post(e,i,t.renderTagList)},t.addStepsTemplate=function(e){var i=t.stepsTemplate[e].steps;i.forEach(function(e){t.currentRegion.stepDetail.push(e),t.currentRegion.serviceSteps.push(e.name)})},t.getItemData(),t.getAllTags()}])}(window.angular),function(e){"use strict";var t=e.module("backendApp");t.controller("selectAreaCtrl",["$scope","areaInfo","$modalInstance","ycsUtil",function(e,t,i,a){e.areaInfo=t,e.ok=function(){t.nickname=a.getAreaLabelByCode(t.districtCode),i.close(t)},e.cancel=function(){i.dismiss("cancel")}}]),t.controller("editServiceItemSteps",["$scope","stepsInformation","$modalInstance",function(e,t,i){e.stepIndex=t.stepIndex,e.save=function(e){t.info=e,i.close(t)},e.cancel=function(){i.dismiss("cancel")},t.isNewStep?e.stepInfo={}:e.stepInfo=t.stepsObject[e.stepIndex],e.stepInfo.sort=e.stepIndex+1}]),t.controller("editRequirementDetail",["$scope","ycsApi","requirementDetail","$modalInstance","$filter",function(t,i,a,n,l){t.requirementDetail=a,t.requirementDetail.texts=[],t.requirementDetail.ids=[],t.requirementDetail.currentSelected.forEach(function(e){t.requirementDetail.texts.push(e.text),t.requirementDetail.ids.push(e.id)}),t.reqList=[],t.requirementSearch=null,t.fillExitingData=function(i){t._reqList=i.re.tabList,t.reqList=e.extend({},t._reqList)},t.getRequirements=function(){var e="admin/specdefine/specdefineList",a={pid:2};i.post(e,a,t.fillExitingData)},t.checkIfSelected=function(e){return t.requirementDetail.texts.indexOf(e)>-1},t.toggleSelected=function(e,i){var a=t.requirementDetail.texts.indexOf(e),n=t.requirementDetail.ids.indexOf(i);-1===a?(t.requirementDetail.texts.push(e),t.requirementDetail.ids.push(i)):(t.requirementDetail.texts.splice(a,1),t.requirementDetail.ids.splice(n,1))},t.filterRequirement=function(){var e=t.requirementSearch;t.reqList=l("filter")(t._reqList,{name:e})},t.delSelected=function(e){t.requirementDetail.texts.splice(e,1),t.requirementDetail.ids.splice(e,1)},t.ok=function(){t.requirementDetail.currentSelected=[];for(var e=0;e<t.requirementDetail.texts.length;e++)t.requirementDetail.currentSelected.push({text:t.requirementDetail.texts[e],id:t.requirementDetail.ids[e]});n.close(t.requirementDetail)},t.cancel=function(){n.dismiss("cancel")},t.getRequirements()}]),t.controller("editDocsDetail",["$scope","ycsApi","documentsDetail","$modalInstance","$filter",function(t,i,a,n,l){t.documentsDetail=a,t.documentsDetail.texts=[],t.documentsDetail.ids=[],t.documentsDetail.currentSelected.forEach(function(e){t.documentsDetail.texts.push(e.text),t.documentsDetail.ids.push(e.id)}),t.docsSearch=null,t.docsList=[],t.fillExitingData=function(i){t._docsList=i.re.tabList,t.docsList=e.extend({},t._docsList)},t.getRequirements=function(){var e="admin/specdefine/specdefineList",a={pid:3};i.post(e,a,t.fillExitingData)},t.checkIfSelected=function(e){return t.documentsDetail.texts.indexOf(e)>-1},t.toggleSelected=function(e,i){var a=t.documentsDetail.texts.indexOf(e),n=t.documentsDetail.ids.indexOf(i);-1===a?(t.documentsDetail.texts.push(e),t.documentsDetail.ids.push(i)):(t.documentsDetail.texts.splice(a,1),t.documentsDetail.ids.splice(n,1))},t.filterDocs=function(){var e=t.docsSearch;t.docsList=l("filter")(t._docsList,{name:e})},t.delSelected=function(e){t.documentsDetail.texts.splice(e,1),t.documentsDetail.ids.splice(e,1)},t.ok=function(){t.documentsDetail.currentSelected=[];for(var e=0;e<t.documentsDetail.texts.length;e++)t.documentsDetail.currentSelected.push({text:t.documentsDetail.texts[e],id:t.documentsDetail.ids[e]});n.close(t.documentsDetail)},t.cancel=function(){n.dismiss("cancel")},t.getRequirements()}]),t.controller("editSpecsDetail",["$scope","ycsApi","specsDetail","$modalInstance",function(e,t,i,a){e.specsDetail=i,e.specsDetail.options=[],e.specsList=[],e.fillExitingData=function(t){e.specsList=t.re.tabList},e.getSpecs=function(){var i="admin/specdefine/specdefineList",a={pid:1};t.post(i,a,e.fillExitingData)},e.checkIfSelected=function(t){return e.specsDetail.currentSelected.indexOf(t)>-1},e.toggleSelected=function(t,i){var a=e.specsDetail.currentSelected.indexOf(t);-1===a?e.specsDetail.currentSelected.push(t):e.specsDetail.currentSelected.splice(a,1)},e.ok=function(){e.specsList.forEach(function(t){-1!==e.specsDetail.currentSelected.indexOf(t.id)&&(t.ssdid=t.id,e.specsDetail.options.push(t))}),a.close(e.specsDetail)},e.cancel=function(){a.dismiss("cancel")},e.getSpecs()}])}(window.angular),function(e){"use strict";var t=e.module("backendApp");t.controller("serviceItemCtrl",["$scope","ycsUtil","ycsApi","uiGridConstants","Notification","$modal",function(e,t,i,a,n,l){e.isAdded=!1,e.loadingGrid=!0,e.gridOptions={enableColumnResizing:!0,enableSorting:!0,enableFiltering:!0,flatEntityAccess:!0,onRegisterApi:function(t){e.gridApi=t},columnDefs:[{field:"name",displayName:"服务名称",filter:{placeholder:"搜索..."},enableHiding:!1},{field:"code",displayName:"服务编号",filter:{placeholder:"搜索..."},width:100,type:"number",cellClass:"text-center",headerCellClass:"text-center",enableHiding:!1},{field:"id",displayName:"操作",width:100,enableHiding:!1,cellClass:"text-center",headerCellClass:"text-center",enableColumnMenu:!1,cellTemplate:'<div class="ui-grid-cell-contents"><a ui-sref="service.item.edit({itemId:COL_FIELD})">编辑</a></div>',enableSorting:!1,enableFiltering:!1},{field:"status",displayName:"是否提供",width:100,enableHiding:!1,filter:{type:a.filter.SELECT,selectOptions:[{value:"0",label:"否"},{value:"1",label:"是"}]},cellClass:"text-center",headerCellClass:"text-center",cellTemplate:'<div class="ui-grid-cell-contents"><span class="is-true" ng-if="COL_FIELD === 1">是</span><span class="is-false" ng-if="COL_FIELD === 0">否</span></div>'},{field:"tag",displayName:"标签",filter:{placeholder:"搜索..."},enableHiding:!1},{field:"categorynames",displayName:"所在分类",filter:{placeholder:"搜索..."},enableHiding:!1}]},e.getExistingData=function(){e.loadingGrid=!0;var t="admin/serviceItem/serviceList",a={};i.post(t,a,e.fillExitingData)},e.fillExitingData=function(t){e.gridOptions.data=t.re.serviceList,e.loadingGrid=!1},e.getExistingData()}])}(window.angular),function(e){"use strict";var t=e.module("backendApp");t.controller("slidersCtrl",["$scope","ycsUtil","ycsApi","uiGridConstants","Notification","$modal","$state",function(t,i,a,n,l,r,s){t.isHomeSlider=s.current.name.indexOf("Home")>-1?!0:!1,t.fillExitingData=function(e,i){i.re;"online"===e?t.sliderListOnline=i.re:"offline"===e&&(t.sliderListOffline=i.re)},t.getExistingData=function(){var e="admin/adconfig/adList",i=t.isHomeSlider?"index.ad":"info.ad",n={code:i,status:1},l={code:i,status:0};a.post(e,n,t.fillExitingData.bind(this,"online")),a.post(e,l,t.fillExitingData.bind(this,"offline"))},t.listSortingSaved=function(e){t.getExistingData(),l.success("排序已保存")},t.listDragEnd=function(){var i="admin/adconfig/changeSort",n=[];t.sliderListOnline.forEach(function(e,t){n.push({adid:e.id,sort:t})});var l={sortList:e.toJson(n)};a.post(i,l,t.listSortingSaved)},t.sliderSaved=function(e){t.getExistingData(),l.success("轮转图已保存")},t.addSlider=function(e,i){var a=i||{},n=r.open({animation:!0,templateUrl:"tpl/modal/system/addSlider.html",size:"lg",controller:"addSliderModalCtrl",backdrop:"static",resolve:{sliderInfo:function(){return{isEdit:e,isHomeSlider:t.isHomeSlider,sliderData:a,listLen:t.sliderListOnline.length}}}});n.result.then(function(){t.sliderSaved()})},t.sliderDeleted=function(){t.getExistingData(),l.success("轮转图已删除")},t.delSlider=function(e){var i="admin/adconfig/delete",n={adid:e};a.post(i,n,t.sliderDeleted)},t.editSlider=function(i,a){for(var n,l="online"===a?t.sliderListOnline:t.sliderListOffline,r=0;r<l.length;r++)if(l[r].id===i){n=e.copy(l[r],{});break}t.addSlider(!0,n)},t.getExistingData()}]),t.controller("addSliderModalCtrl",["$scope","sliderInfo","$modalInstance","ycsApi","ycsUtil","Notification",function(e,t,i,a,n,l){e.sliderInfo=t.sliderData,e.isEdit=t.isEdit,e.isHome=t.isHomeSlider,e.listLen=t.listLen,e.uploadBtnDisabled=!1,e.fileChanged=!1,void 0===e.sliderInfo.status&&(e.sliderInfo.status=1),e.imageUploaded=function(t){e.sliderInfo.image=t,e.fileChanged=!0,n.disableButton(e,!1)},e.uploadImage=function(t){var i=e.isHome?"idxturn":"infoturn";n.uploadImage(t,i,e.imageUploaded,e)},e.$on("imageSelected",function(t,i,a){e.$apply(function(){e.uploadImage(i),n.disableButton(e,!0)})}),e.saved=function(){i.close()},e.save=function(t){var i=e.isEdit?"admin/adconfig/edit":"admin/adconfig/add",n=t;n.code=e.isHome?"index.ad":"info.ad",e.isEdit?n.adid=n.id:n.sort=e.listLen,a.post(i,n,e.saved)},e.cancel=function(){i.dismiss("cancel")}}])}(window.angular),function(e){"use strict";var t=e.module("backendApp");t.controller("ticketClientCtrl",["$scope","ycsUtil","ycsApi","Notification","$modal",function(e,t,i,a,n){e.sourceOpts=[{value:"10",label:"网站"},{value:"20",label:"微信"},{value:"30",label:"直销"},{value:"40",label:"渠道"},{value:"50",label:"服务商"},{value:"60",label:"aV"},{value:"70",label:"pV"},{value:"80",label:"内部测试"},{value:"90",label:"其他"}],e.checkIfAccEmpty=function(){e.qData.username&&0!==e.qData.username.length||(e.qData={})},e.renderClientInfo=function(t,i){if(0===i.re.users.length)e.noUserFound=!0,e.insufficientInfo=!1;else{e.noUserFound=!0;for(var a,n=i.re.users,l=0;l<n.length;l++)if(n[l].username===t){a=n[l],e.noUserFound=!1;break}e.noUserFound||(a&&a.contacts&&0!==a.contacts.length&&a.contactsmobile&&a.contactsprovince&&a.contactscity&&a.contactsaddress?(e.insufficientInfo=!1,e.qData=a,e.qData.company&&""!==String(e.qData.company).trim()||(e.qData.company="无")):(e.insufficientInfo=!0,e.qData=a))}},e.dataSaved=function(t){a.success("修改客户信息成功"),e.orderModal.getExistingData()},e.searchClientInfo=function(t){var a="admin/user/getUserInfo",n={username:t};i.post(a,n,e.renderClientInfo.bind(this,t))},e.editUserInfo=function(t){var a="admin/user/editUserInfo",n=t;n.contacts&&n.contacts.trim(),i.post(a,n,e.dataSaved)}}])}(window.angular),function(e){"use strict";var t=e.module("backendApp");t.controller("ticketOrderCtrl",["$scope","ycsUtil","ycsApi","Notification","$modal","$interval",function(t,i,a,n,l,r){t.editPrice=!1,t.payTypeOpts=[{value:0,label:"支付宝支付"},{value:1,label:"网上银行支付"},{value:2,label:"线下支付"},{value:3,label:"微信支付"}],t.translateStatus=function(e){var t={0:"待审核",5:"待付款",10:"已付款",11:"已付款(金额有误)",15:"已收款",20:"服务中",30:"已完成",40:"申请中止",42:"已取消",44:"已中止",46:"已删除",48:"已作废"};return t[e]},t.translatePaytype=function(e){var t={0:"支付宝支付",1:"网上银行支付",2:"线下支付",3:"微信支付"};return t[e]},t.modifyServiceItemSpecs=function(){var i=l.open({animation:!0,templateUrl:"tpl/modal/ticket/modifyOrderSpecs.html",size:"lg",controller:"modifyOrderSpecsModalCtrl",backdrop:"static",resolve:{orderDetail:function(){return{func:"edit",data:e.extend({},t.qData)}}}});i.result.then(function(e){t.orderModal.getExistingData()})},t.changeVendor=function(){var i=l.open({animation:!0,templateUrl:"tpl/modal/ticket/modifyOrderSpecs.html",size:"lg",controller:"modifyOrderSpecsModalCtrl",backdrop:"static",resolve:{orderDetail:function(){return{func:"changeVendor",data:e.extend({},t.qData)}}}});i.result.then(function(e){t.orderModal.getExistingData()})},t.priceSaved=function(e){n.success("修改总价成功"),t.orderModal.getExistingData()},t.startEditPrice=function(){t.editPrice=!0},t.submitEditPrice=function(){t.editPrice=!1;var e="admin/order/updateOrderInfo",i={id:t.qData.orderid,price:t.qData.tmpPrice};a.post(e,i,t.priceSaved)},t.cancelEditPrice=function(){t.editPrice=!1,delete t.qData.tmpPrice},t.paytypeSaved=function(e){n.success("修改支付方式成功"),t.orderModal.getExistingData()},t.startEditPaytype=function(){t.editPaytype=!0},t.submitEditPaytype=function(){t.editPaytype=!1;var e="admin/order/updateOrderInfo",i={id:t.qData.orderid,paytype:t.qData.tmpPaytype};a.post(e,i,t.paytypeSaved)},t.cancelEditPaytype=function(){t.editPaytype=!1},t.remarkSaved=function(e){n.success("修改订单备注成功"),t.orderModal.getExistingData()},t.submitEditRemark=function(){var e="admin/order/updateOrderInfo",i={id:t.qData.orderid,remark:t.qData.remark};a.post(e,i,t.remarkSaved)},t.statusSaved=function(e){n.success("修改订单状态成功"),t.orderModal.getExistingData()},t.changeTicketStatus=function(e,i){var n="admin/order/updateOrderInfo",l={};l.id=e.orderid,l.status=i,a.post(n,l,t.statusSaved)}}])}(window.angular),function(e){"use strict";var t=e.module("backendApp");t.controller("editServiceDetail",["$scope","ycsApi","serviceDetail","$modalInstance","$filter",function(t,i,a,n,l){t.serviceDetail=a,t.serviceList=[],t.serviceSearch=null,t.fillExitingData=function(i){t._serviceList=i.re,t.serviceList=e.extend({},t._serviceList)},t.getServices=function(){var e="admin/serviceItem/qryServiceList",a={};i.post(e,a,t.fillExitingData)},t.checkIfSelected=function(e){return 0===t.serviceDetail.currentSelected.length?!1:t.serviceDetail.currentSelected[0].name.indexOf(e)>-1},t.toggleSelected=function(e){t.serviceDetail.currentSelected=[];var i=t.serviceDetail.currentSelected.indexOf(e);-1===i?t.serviceDetail.currentSelected.push(e):t.serviceDetail.currentSelected.splice(i,1)},t.filterRequirement=function(){var e=t.serviceSearch;t.serviceList=l("filter")(t._serviceList,{name:e})},t.delSelected=function(e){t.serviceDetail.currentSelected.splice(e,1)},t.ok=function(){n.close(t.serviceDetail.currentSelected)},t.cancel=function(){n.dismiss("cancel")},t.getServices()}]),t.controller("editVendorDetail",["$scope","ycsApi","vendorDetail","$modalInstance","$filter",function(t,i,a,n,l){t.vendorDetail=a,t.vendorList=[],t.vendorSearch=null,t.fillExitingData=function(){t._vendorList=a.vendorList,t.vendorList=e.copy(t._vendorList,[])},t.toggleSelected=function(e){t.vendorDetail.currentSelected=e},t.filterVendor=function(){var e=t.vendorSearch;t.vendorList=l("filter")(t._vendorList,{$:e})},t.ok=function(){n.close(a)},t.cancel=function(){n.dismiss("cancel")},t.fillExitingData()}]),t.controller("modifyOrderSpecsModalCtrl",["$scope","ycsApi","orderDetail","$modalInstance","$filter",function(e,t,i,a,n){e.orderDetail=i,e.orderSpecsModal={},e.fillExitingData=function(){e.editData={data:e.orderDetail.data}},e.cancel=function(){a.dismiss("cancel")},e.orderSpecsModal.close=function(){a.close(i)},e.fillExitingData()}])}(window.angular),function(e){"use strict";var t=e.module("backendApp");t.controller("orderDetailCtrl",["$scope","ycsUtil","ycsApi","Notification","$modal","$interval",function(t,i,a,n,l,r){t.isAllSelected=!1,t.qData||(t.qData={}),t.isEdit=!1,t.fillExistingData=function(){t.qData=e.extend({},t.editData.data),t.serviceItemList=e.copy(t.qData.serviceitems,[]),t.qData.servicername=t.qData.srname+"",
t.currentSelectedInit()},t.editService=function(){var e=l.open({animation:!0,templateUrl:"tpl/modal/ticket/selectService.html",size:"lg",controller:"editServiceDetail",backdrop:"static",resolve:{serviceDetail:function(){return{currentSelected:t.qData.service||[]}}}});e.result.then(function(e){t.qData.service=e,t.qData.servicename=e[0].name,t.qData.serviceid=e[0].id,t.editServiceItem()})},t.currentSelectedInit=function(){t.currentSelected={},0===t.serviceItemList.length?t.isAllSelected=!0:t.serviceItemList.forEach(function(e){t.currentSelected[e.id]={},e.specification&&e.specification.length>0&&e.specification.forEach(function(i){t.currentSelected[e.id][i.name]=[],i.content&&i.content.length>0&&(t.currentSelected[e.id][i.name]=i.content.split(","))}),t.currentSpecs=[],Object.keys(t.currentSelected).forEach(function(e){var i=t.currentSelected[e];Object.keys(i).forEach(function(e,i,a){t.currentSpecs.push(e)})})})},t.renderServiceItem=function(e){t.serviceItemList=e.re.specificationlist,t.currentSelectedInit()},t.editServiceItem=function(){var e="admin/serviceItem/qryServiceItemOptions",i={serviceid:t.qData.serviceid,district:t.qData.district,city:100*Math.round(t.qData.district/100),province:1e4*Math.round(t.qData.district/1e4)};a.post(e,i,t.renderServiceItem)},t.checkIfSelected=function(e,i,a){return t.currentSelected[i][a].indexOf(e)<0?!1:!0},t.toggleSelected=function(e,i,a,n){var l=t.currentSelected[a][n],r=l.indexOf(e);1===i?l[0]=e:2===i&&(-1===r?l.push(e):l.splice(r,1));var s=!1,c=[];Object.keys(t.currentSelected).forEach(function(e){var i=t.currentSelected[e];Object.keys(i).forEach(function(e,a,n){i[e].length>0&&c.push("selected"),c.length===t.currentSpecs.length&&(s=!0)}),s===!0&&(t.isAllSelected=!0)})},t.orderSaved=function(e){var i=e.re;n.success({title:"订单已创建成功",message:"订单号："+i.orderno+"（￥"+i.due+"）",delay:5e3}),t.orderModal.close()},t.orderModified=function(e){n.success("订单信息已更新！"),t.orderSpecsModal.close()},t.modifyOrder=function(){var i="admin/order/updateOrderInfo",n={qrycondition:t.qData.serviceitems};n.qrycondition&&n.qrycondition.length>0&&n.qrycondition.forEach(function(i){i.siid=Number(i.id),i.specification.forEach(function(e){var a=t.currentSelected[i.id][e.name].join(",");e.content=a,e.type+="",delete e.options}),i.options=e.copy(i.specification,[]),delete i.specification,delete i.price,delete i.id,delete i.stepsdetail,delete i.name});var l={id:t.qData.orderid,spid:t.qData.servicerid||t.qData.srid,qryConditions:e.toJson(n)};"changeVendor"===t.orderDetail.func&&delete l.qryConditions,a.post(i,l,t.orderModified)},t.generateOrder=function(){var i="admin/order/createOrder",n=t.qData;n.city=100*Math.round(t.qData.district/100),n.province=1e4*Math.round(t.qData.district/1e4),n.userid=t.orderUser.id;var l=t.verndorServiceItemInfo;l&&l.length>0&&l.forEach(function(e){for(var i=0;i<t.serviceItemList.length;i++){var a=t.serviceItemList[i];if(a.id===e.serviceItemId){e.selectedOpts=a.specification;for(var n=0;n<e.selectedOpts.length;n++){var l=e.selectedOpts[n];2===l.type&&(l.content=t.currentSelected[e.serviceItemId][l.name].join(","))}return}}});var r=0;t.verndorServiceItemInfo.forEach(function(e){r+=Number(e.price)}),n.discount=0,n.fee=0,n.amount=r,n.due=n.amount-n.discount+n.fee,n.serviceItemInfos=e.toJson(l),a.post(i,n,t.orderSaved)},t.appendVendorInfo=function(e){if(e){t.qData.servicerid=e;for(var i=0;i<t.filteredVendorList.length;i++){var a=t.filteredVendorList[i];if(a.id===e){t.verndorServiceItemInfo=a.serviceItemInfos,t.qData.servicername=a.nickname;break}}}},t.renderVendorList=function(i){t.filteredVendorList=i.re.serviceproviders;var a=l.open({animation:!0,templateUrl:"tpl/modal/ticket/selectVendor.html",size:"md",controller:"editVendorDetail",backdrop:"static",resolve:{vendorDetail:function(){return{currentSelected:null,vendorList:e.copy(t.filteredVendorList,[])}}}});a.result.then(function(e){t.appendVendorInfo(e.currentSelected)})},t.editVendor=function(){var i="admin/service/qryServiceProviders",n={qrycondition:e.copy(t.serviceItemList,[])};n.qrycondition&&n.qrycondition.length>0&&n.qrycondition.forEach(function(i){i.options=e.copy(i.specification,[]),i.options.forEach(function(e){var a=t.currentSelected[i.id][e.name].join(",");e.content=a,e.type+=""})});var l={id:t.qData.serviceid||t.qData.sdid,area:t.qData.district,city:100*Math.round(t.qData.district/100),province:1e4*Math.round(t.qData.district/1e4),qryConditions:e.toJson(n)};a.post(i,l,t.renderVendorList)},t.editData&&t.editData.data&&(t.fillExistingData(),t.isEdit=!0)}])}(window.angular),function(e){"use strict";var t=e.module("backendApp");t.controller("ticketServiceCtrl",["$scope","ycsUtil","ycsApi","Notification","$filter",function(e,t,i,a,n){e.dataSaved=function(t){a.success("修改步骤状态成功"),e.orderModal.getExistingData(),e.currentEdit=""},e.changeSerivceStepsStatus=function(t,a,l,r,s){var c="admin/order/updateStepStatus",o={id:t,orderno:a,siid:l,status:r};s&&e.currentEdit===t&&(o.modified=n("date")(s,"yyyy-MM-dd HH:mm:ss")),i.post(c,o,e.dataSaved)},e.showEditWrapper=function(t){e.currentEdit=t,e.changeTime=new Date},e.hiddenEditWrapper=function(){e.currentEdit=""}}])}(window.angular),function(e){"use strict";var t=e.module("backendApp");t.controller("basicInfoCtrl",["$scope","ycsUtil","ycsApi","Notification","$modal","$filter","$state",function(e,t,i,a,n,l,r){"new"===e.vendorId&&(e.qData={registedTime:new Date,fieldArray:[10,20,30,40,50,60,70,80,90]}),e.accAvailable=!0,e.uploadBtnDisabled=!1,e.typeUnitOpts=[{value:1,label:"服务商机构"},{value:2,label:"服务商分支机构"},{value:3,label:"客户公司"},{value:4,label:"客户分支公司"}],e.peopleUnitOpts=[{value:0,label:"1-10"},{value:1,label:"11-20"},{value:2,label:"21-50"},{value:3,label:"51-100"},{value:4,label:"101-300"},{value:5,label:"301-1000"},{value:6,label:"1000-5000"},{value:7,label:"5000-10000"},{value:8,label:"10000以上"}],e.fieldOpts=[{value:10,label:"工商"},{value:20,label:"财务会计"},{value:30,label:"审计"},{value:40,label:"税务"},{value:50,label:"法律"},{value:60,label:"资产评估"},{value:70,label:"许可证"},{value:80,label:"商标专利"},{value:90,label:"人力资源"}],e.imageUploaded=function(i){e.qData.logo=i,t.disableButton(e,!1)},e.uploadImage=function(i){t.uploadImage(i,"serlogo",e.imageUploaded,e)},e.$on("imageSelected",function(i,a){e.$apply(function(){e.uploadImage(a),t.disableButton(e,!0)})}),e.deleteLogo=function(){delete e.qData.logo},e.basicInfoSaved=function(t){a.success("服务商信息已保存！"),e.getExistingData()},e.newVendorAdded=function(e){a.success("已成功添加服务商！"),r.go("vendor")},e.toggleSelected=function(t){var i=e.qData.fieldArray.indexOf(t);-1===i?e.qData.fieldArray.push(t):e.qData.fieldArray.splice(i,1)},e.checkIfSelected=function(t){return e.qData&&e.qData.fieldArray&&-1!==e.qData.fieldArray.indexOf(t)?!0:!1},e.checkAccountResult=function(t){t&&200===Number(t.status)?e.accAvailable=!0:e.accAvailable=!1},e.checkAccountAvailability=function(t,a){if(!t){var n="admin/servicer/checkServicerCodeValid",l={code:a};i.post(n,l,e.checkAccountResult,null,null,e.checkAccountResult)}},e.save=function(t){var a,n=t;n.tag="",n.tagsInput&&n.tagsInput.length>0&&n.tagsInput.forEach(function(e,t){n.tag+=(t>0?",":"")+e.text}),n.logo&&0!==n.logo.length||delete n.logo,n.registed=l("date")(n.registedTime,"yyyy-MM-dd"),n.field=e.qData.fieldArray.join(","),"new"===e.vendorId?(a="admin/servicer/addServicerBasicInfo",n.industry=1400,n.city=100*Math.round(n.district/100),n.province=1e4*Math.round(n.district/1e4),delete n.servicerid,i.post(a,n,e.newVendorAdded)):(a="admin/servicer/modifyServicerBasicInfo",i.post(a,n,e.basicInfoSaved))},e.resetVendorPassword=function(e,t,i,a){n.open({animation:!0,templateUrl:"tpl/modal/vendor/resetVendorPassword.html",size:"md",backdrop:"static",controller:"resetVendorPasswordCtrl",resolve:{vendorInfo:function(){return{servicerid:Number(e),username:t,mobile:i,email:a}}}})}}]),t.controller("resetVendorPasswordCtrl",["$scope","vendorInfo","$modalInstance","ycsApi","Notification",function(e,t,i,a,n){e.vendorInfo=t,e.detail={},e.detail.username=e.vendorInfo.username,e.detail.password="00000000",e.detail.contactstel=e.vendorInfo.mobile,e.detail.contactsemail=e.vendorInfo.email,e.dataSaved=function(){n.success("服务商登录密码重置成功！"),i.close()},e.save=function(t){var i="admin/servicer/resetServicerPwd",n=t;n.servicerid=e.vendorInfo.servicerid,n.tel===!0&&n.tel||delete n.contactstel,n.email===!0&&n.email||delete n.contactsemail,a.post(i,n,e.dataSaved)},e.cancel=function(){i.dismiss("cancel")}}])}(window.angular),function(e){"use strict";var t=e.module("backendApp");t.controller("capacityCtrl",["$scope","ycsUtil","ycsApi","uiGridConstants","Notification","$modal",function(t,i,a,n,l,r){t.loadingGrid=!0,t.gridOptions={enableSorting:!0,enableFiltering:!0,flatEntityAccess:!0,onRegisterApi:function(e){t.gridApi=e},columnDefs:[{field:"name",displayName:"服务名称",filter:{placeholder:"搜索..."},enableHiding:!1},{field:"id",displayName:"编辑",width:70,enableColumnMenu:!1,cellTemplate:'<div class="ui-grid-cell-contents"><a ng-click="grid.appScope.editData(row.entity.id, row.entity.srid, row.entity.siid, row.entity.name)">编辑</a></div>',cellClass:"text-center",headerCellClass:"text-center",enableFiltering:!1,enableHiding:!1},{field:"status",displayName:"是否提供",width:100,filter:{type:n.filter.SELECT,selectOptions:[{value:"0",label:"否"},{value:"1",label:"是"}]},cellClass:"text-center",headerCellClass:"text-center",cellTemplate:'<div class="ui-grid-cell-contents"><span class="is-true" ng-if="COL_FIELD === 1">是</span><span class="is-false" ng-if="COL_FIELD === 0">否</span></div>',enableHiding:!1},{field:"price",displayName:"价格",width:160,filter:{placeholder:"搜索..."},type:"number",cellClass:"text-right",headerCellClass:"text-center",cellTemplate:'<div class="ui-grid-cell-contents"><p>{{COL_FIELD}} <span ng-if="row.entity.unit === 99" class="text-muted">元起</span><span ng-if="row.entity.unit !== 99" class="text-muted">元 / {{row.entity.unitname}}</span>&nbsp;<span ng-if="row.entity.pricetype !== 0" class="accumulated">累进</span></p></div>',enableHiding:!1},{field:"options",displayName:"服务规格",filter:{placeholder:"搜索..."},enableHiding:!1},{field:"advantage",displayName:"服务特色说明",enableColumnMenu:!1,filter:{placeholder:"搜索..."},enableSorting:!1,enableHiding:!1},{field:"invoicetype",displayName:"提供发票类型",filter:{type:n.filter.SELECT,selectOptions:[{value:"均可",label:"均可"},{value:"收据",label:"收据"},{value:"国税通用机打发票",label:"国税通用机打发票"},{value:"增值税普通发票",label:"增值税普通发票"},{value:"增值税专用发票",label:"增值税专用发票"},{value:"小规模普通发票",label:"小规模普通发票"}]},enableHiding:!1},{field:"special",displayName:"例外规则",width:100,cellTemplate:'<div class="ui-grid-cell-contents"><a ng-click="grid.appScope.openExceptionList(row.entity.id, row.entity.siid, row.entity.name)">管理 ({{row.entity.special}})</a></div>',cellClass:"text-center",headerCellClass:"text-center",enableSorting:!1,enableFiltering:!1,enableHiding:!1},{field:"id",displayName:"删除",width:70,enableColumnMenu:!1,cellTemplate:'<div class="ui-grid-cell-contents"><a class="link-delete" ng-click="grid.appScope.delServiceItem(COL_FIELD)">删除</a></div>',cellClass:"text-center",headerCellClass:"text-center",enableFiltering:!1,enableHiding:!1}]},t.fillExitingData=function(e){t.gridOptions.data=e.re.list,t.selectedServiceItem=[],e.re.list.forEach(function(e){t.selectedServiceItem.push(e.siid)}),t.loadingGrid=!1},t.getExistingData=function(){t.loadingGrid=!0;var e="admin/servicer/getItems",i={srid:t.vendorId};a.post(e,i,t.fillExitingData)},t.editData=function(i,a,n,l){var s=(e.extend({},t.gridOptions.data)[i],r.open({animation:!0,templateUrl:"tpl/modal/vendor/serviceItemEdit.html",size:"xl",controller:"serviceItemEditModalCtrl",resolve:{serviceItemInfo:function(){return{srsid:i,srid:a,siid:n,name:l}}}}));s.result.then(function(e){t.getExistingData()})},t.delServiceItem=function(e){var i="admin/servicer/delItem",n={srsid:e};a.post(i,n,t.getExistingData)},t.openExceptionList=function(i,a,n){var l=e.extend({},t.gridOptions.data),s=r.open({animation:!0,templateUrl:"tpl/modal/vendor/editExceptionList.html",size:"lg",controller:"exceptionListModalCtrl",backdrop:"static",resolve:{exceptionListInfo:function(){return{data:l,srsid:i,srid:t.vendorId,siid:a,name:n}}}});s.result.then(function(e){t.getExistingData()})},t.addCapacity=function(){var e=r.open({animation:!0,templateUrl:"tpl/modal/vendor/addCapacity.html",size:"xl",controller:"addCapacityModalCtrl",backdrop:"static",resolve:{capacityInfo:function(){return{select:t.selectedServiceItem,srid:t.vendorId}}}});e.result.then(function(e){t.getExistingData()})},t.getExistingData()}])}(window.angular),function(e){"use strict";var t=e.module("backendApp");t.controller("vendorEditCtrl",["$scope","ycsUtil","ycsApi","Notification","$modal",function(e,t,i,a,n){e.stepsTpl=["tpl/vendor/corp/steps/defaultArea.html","tpl/vendor/corp/steps/defaultServiceItem.html","tpl/vendor/corp/steps/defaultPrice.html"],e.capacity={isInit:!1},e.initStep={current:0},e.tabsTpl={basicInfo:"tpl/vendor/corp/basicInfo.html",vendorInfo:"tpl/vendor/corp/vendorInfo.html",partnerShip:"tpl/vendor/corp/partnerShip.html",capacity:"tpl/vendor/corp/capacity.html",staff:"tpl/vendor/corp/staff.html"},e.currentTab=e.tabsTpl.basicInfo,e.switchTab=function(t){switch(t){case"vendorInfo":case"partnerShip":case"staff":e.currentTab=e.tabsTpl[t];break;case"capacity":e.capacity.isInit?e.currentTab=e.stepsTpl[e.initStep.current]:e.currentTab=e.tabsTpl.capacity;break;default:case"basicInfo":e.currentTab=e.tabsTpl.basicInfo}},e.fillExistingFullData=function(i){if(e.qData=i.re,e.qData.registedTime=new Date(e.qData.registed),e.qData.contracts.forEach(function(e){e.begindateTime=new Date(e.begindate),e.enddateTime=new Date(e.enddate)}),e.qData.fieldArray=[],e.qData.field&&e.qData.field.length>0){var a=t.spliter(e.qData.field,",");a.length>0&&a.forEach(function(t){Number(t)>0&&e.qData.fieldArray.push(Number(t))})}e.qData.existingCorpAccount=e.qData.code||"",2===e.qData.initialize?e.capacity.isInit=!1:(e.capacity.isInit=!0,e.initStep.current=e.qData.initialize)},e.getExistingData=function(){var t="admin/servicer/queryServicerDetail",a={servicerid:e.vendorId};i.post(t,a,e.fillExistingFullData)},"new"!==e.vendorId&&e.getExistingData()}])}(window.angular),function(e,t){"use strict";var i=e.module("backendApp");i.controller("modifyAreaCtrl",["$scope","ycsUtil","ycsApi","Notification","$modal","$state","$stateParams",function(e,t,i,a,n,l,r){e.isEmpty=!0,e.currentAreas=[],e.currentAreaList=[],e.backToVendorInfo=function(){l.go("vendor.corp.edit",{vendorId:r.vendorId})},e.renderSelectedAreaList=function(i){i.re.forEach(function(i){var a=[];i.cityList.forEach(function(i){i.districtList.forEach(function(e){a.push(e.city)}),e.currentAreaList.push({code:100*Math.round(i.districtList[0].city/100),name:t.getAreaLabelByCode(100*Math.round(i.districtList[0].city/100)," "),selected:a,checkAll:!1})})})},e.getSelectedAreaList=function(){var t="admin/servicer/queryAreaByServicerId",a={servicerid:e.srid};i.post(t,a,e.renderSelectedAreaList)},e.renderAreaList=function(){e.currentAreaList=[],0!==e.currentAreas.length&&e.currentAreas.forEach(function(i){e.currentAreaList.push({code:i,name:t.getAreaLabelByCode(i," "),checkAll:!1})})},e.appendAreaToList=function(i){e.currentAreaList.push({code:i,name:t.getAreaLabelByCode(i," "),selected:[],checkAll:!0})},e.addAvailableCity=function(){var t=n.open({animation:!0,templateUrl:"tpl/modal/vendor/addSupportArea.html",size:"md",controller:"selectVendorSupportAreaCtrl",resolve:{areaInfo:function(){return{districtCode:null}}}});t.result.then(function(t){var i=e.currentAreas.indexOf(t.districtCode);-1===i?(e.currentAreas.push(t.districtCode),e.isEmpty=!1,e.appendAreaToList(t.districtCode)):a.warning("此区域已存在，无需重复添加")})},e.removeArea=function(t){e.currentAreaList.splice(t,1),e.currentAreas.splice(t,1)},e.supportAreaSaved=function(t,i){a.success("服务区域信息保存成功！"),t&&e.backToVendorInfo()},e.save=function(t,a){var n="";t.forEach(function(e,t){n+=(t>0?",":"")+e.selected.join(",")});var l="admin/servicer/updateArea",r={id:Number(e.srid),cities:n};i.post(l,r,e.supportAreaSaved.bind(this,a))},e.getSelectedAreaList()}])}(window.angular,window.Neo),function(e){"use strict";var t=e.module("backendApp");t.controller("partnerShipCtrl",["appSettings","$scope","ycsUtil","ycsApi","Notification","$modal","$filter",function(e,t,i,a,n,l,r){t.addNew=!1,t.contracts={files:[]},t.uploadBtnDisabledArray=[];for(var s=0;s<t.qData.contracts.length;s++)t.uploadBtnDisabledArray[s]=!1;t.statusUnitOpts=[{value:1,label:"未合作"},{value:2,label:"未生效"},{value:3,label:"生效中"},{value:4,label:"待续约"},{value:5,label:"已失效"},{value:6,label:"已冻结"},{value:8,label:"特约专用"}],t.checkIfUploading=function(e){return e===!0?"loading":void 0},t.fillExisting=function(){t.qData&&(!t.qData.contracts||t.qData.contracts.length<1)?t.qData={contracts:[]}:t.qData&&t.qData.contracts&&t.qData.contracts.length>0&&t.qData.contracts.forEach(function(e){e.fileChanged=!1})},t.addPartnerShip=function(){t.qData.contracts.push({status:1,begindateTime:new Date,enddateTime:new Date,fileChanged:!1}),t.addNew=!0},t.delContract=function(e){delete t.qData.contracts[e].files},t.contractUploaded=function(e,i){t.qData.contracts[e].files=i,t.qData.contracts[e].fileChanged=!0,t.uploadBtnDisabledArray[e]=!1},t.uploadContract=function(e,a){i.uploadCommonFile(e,"admcontract",t.contractUploaded.bind(this,a))},t.$on("commonFileSelected",function(e,i,a){return i.size<1?void n.warning({title:"不能上传空文件",message:"你上传的文件大小为0字节，不是有效的文件，请重新选择",delay:5e3}):void t.$apply(function(){t.uploadContract(i,a),t.uploadBtnDisabledArray[a]=!0})}),t.dataSaved=function(e){n.success("合作关系保存成功！"),t.getExistingData()},t.save=function(e){var i,n=e;t.addNew===!0?(i="admin/servicer/addServicerContract",n.servicerid=t.vendorId):i="admin/servicer/modifyServicerContract",n.receiver&&n.receiver.trim(),n.contacts&&n.contacts.trim(),n.begindate=r("date")(n.begindateTime,"yyyy-MM-dd"),n.enddate=r("date")(n.enddateTime,"yyyy-MM-dd"),a.post(i,n,t.dataSaved),t.addNew=!1},t.fillExisting()}])}(window.angular),function(e){"use strict";var t=e.module("backendApp");t.controller("staffCtrl",["$scope","ycsUtil","ycsApi","uiGridConstants","Notification","$modal",function(e,t,i,a,n,l){e.gridOptions={enableSorting:!0,enableFiltering:!0,rowHeight:65,onRegisterApi:function(t){e.gridApi=t},columnDefs:[{field:"username",displayName:"用户名",filter:{placeholder:"搜索..."},enableHiding:!1},{field:"sn",displayName:"人员编号",width:120,type:"number",filter:{placeholder:"搜索..."},enableHiding:!1},{field:"realname",displayName:"真实姓名",width:80,filter:{placeholder:"搜索..."},enableHiding:!1},{field:"head",displayName:"真实照片",width:70,enableColumnMenu:!1,cellTemplate:'<div class="ui-grid-cell-contents"><div class="head" style="background:url({{COL_FIELD}})"></div></div>',cellClass:"text-center",headerCellClass:"text-center",enableFiltering:!1,enableSorting:!1,enableHiding:!1},{field:"id",displayName:"编辑",width:70,enableColumnMenu:!1,cellTemplate:'<div class="ui-grid-cell-contents"><a ng-click="grid.appScope.editData(row.entity.id)">编辑</a></div>',cellClass:"text-center",headerCellClass:"text-center",enableFiltering:!1,enableHiding:!1},{field:"address",displayName:"所在区域",filter:{placeholder:"搜索..."},enableHiding:!1},{field:"title",displayName:"职务头衔",filter:{placeholder:"搜索..."},enableHiding:!1},{field:"mobile",displayName:"联系手机",type:"number",filter:{placeholder:"搜索..."},enableHiding:!1},{field:"email",displayName:"电子邮箱",filter:{placeholder:"搜索..."},enableHiding:!1},{field:"grade",displayName:"级别",filter:{type:a.filter.SELECT,selectOptions:[{value:"0",label:"普通"},{value:"1",label:"专家"},{value:"2",label:"高级专家"}]},cellTemplate:'<div class="ui-grid-cell-contents"><span ng-if="COL_FIELD === 0">普通</span><span ng-if="COL_FIELD === 1">专家</span><span ng-if="COL_FIELD === 2">高级专家</span></div>',enableHiding:!1},{field:"_field",displayName:"专业领域",filter:{type:a.filter.SELECT,selectOptions:[{value:"工商",label:"工商"},{value:"财务会计",label:"财务会计"},{value:"审计",label:"审计"},{value:"税务",label:"税务"},{value:"法律",label:"法律"},{value:"资产评估",label:"资产评估"},{value:"许可证",label:"许可证"},{value:"商标专利",label:"商标专利"},{value:"人力资源",label:"人力资源"}]},enableHiding:!1},{field:"id",displayName:"删除",width:70,enableColumnMenu:!1,cellTemplate:'<div class="ui-grid-cell-contents"><a class="link-delete" ng-click="grid.appScope.deleteStaff(COL_FIELD)" ng-if="row.entity.username !== \'admin\'">删除</a><span ng-if="row.entity.username === \'admin\'" title="不能删除管理员账户">—</span></div>',cellClass:"text-center",headerCellClass:"text-center",enableFiltering:!1,enableHiding:!1}]},e.shapeFieldCol=function(){var t=e.gridOptions.data;0!==t.length&&t.forEach(function(e){var t=e.field.join(","),i=[];i.push(t),e._field=i.join("\n")})},e.fillExitingData=function(t){e.gridOptions.data=t.re.persons,e.shapeFieldCol()},e.deleteSaved=function(){n.error("人员已删除"),e.getExistingData()},e.deleteStaff=function(t){var a="admin/servicer/deletePerson",n={id:Number(t)};i.post(a,n,e.deleteSaved)},e.getExistingData=function(){var t="admin/servicer/qryPersonLists",a={id:Number(e.vendorId),pageSize:999999};i.post(t,a,e.fillExitingData)},e.editData=function(t){var i=l.open({animation:!0,templateUrl:"tpl/modal/vendor/editStaff.html",size:"xl",backdrop:"static",controller:"editStaffModalCtrl",resolve:{staffInfo:function(){return{id:t,servicerid:e.vendorId}}}});i.result.then(function(t){e.getExistingData()})},e.addStaff=function(){e.isEdit=!0},e.getExistingData()}]),t.controller("editStaffModalCtrl",["$scope","staffInfo","$modalInstance","ycsApi","ycsUtil","Notification","$filter","$modal",function(e,t,i,a,n,l,r,s){e.staffInfo=t,e.fieldArray=[],e.uploadBtnDisabled=!1,e.qData={},"new"===e.staffInfo.id&&(e.qData.worklifeTime=new Date),e.certificateArray=[],e.certList=[],e.fieldOpts=[{value:"10",label:"工商"},{value:"20",label:"财务会计"},{value:"30",label:"审计"},{value:"40",label:"税务"},{value:"50",label:"法律"},{value:"60",label:"资产评估"},{value:"70",label:"许可证"},{value:"80",label:"商标专利"},{value:"90",label:"人力资源"}],e.certificateOpts=[{value:"11",label:"会计专业技术资格(中级)"},{value:"12",label:"会计专业技术资格(高级)"},{value:"13",label:"注册会计师(CPA)"},{value:"14",label:"特许公认会计师(ACC)"},{value:"15",label:"英国国际会计师(AIA)"},{value:"16",label:"英国特许管理会计师(CIM)"},{value:"17",label:"英国财务会计师(IFA)"},{value:"18",label:"美国注册管理会计师(CMA)"},{value:"19",label:"加拿大国际会计师(CGA)"},{value:"20",label:"澳大利亚注册会计师(ASCPA）"},{value:"41",label:"国际注册内部审计师(CIA)"},{value:"42",label:"国际注册信息系统审计师(CISA)"},{value:"61",label:"注册税务师(CTA)"},{value:"81",label:"注册资产评估师(CPV)"}],e.rankUnitOpts=[{value:"0",label:"普通"},{value:"1",label:"专家"},{value:"2",label:"高级专家"}],e.cancel=function(){i.dismiss("cancel")},e.checkIfSelected=function(t){return e.fieldArray.indexOf(t)>-1},e.addStaffSaved=function(e){l.success("人员信息添加成功！"),i.close()},e.editStaffSaved=function(e){l.success("人员信息编辑成功！"),i.close()},e.checkFieldIfSelected=function(t){return e.fieldArray.indexOf(t)>-1},e.toggleFieldSelected=function(t){var i=e.fieldArray.indexOf(t);-1===i?e.fieldArray.push(t):e.fieldArray.splice(i,1)},e.checkCertificateIfSelected=function(t){return e.certificateArray.indexOf(t)>-1},e.toggleCertificateSelected=function(t){var i=e.certificateArray.indexOf(t);-1===i?e.certificateArray.push(t):e.certificateArray.splice(i,1)},e.fillExitingData=function(t){e.qData=t.re,e.qData.worklife.length>0?e.qData.worklifeTime=new Date(e.qData.worklife):e.qData.worklifeTime=new Date,e.fieldArray=e.qData.fieldList,e.certificateArray=e.qData.certificatesList;e.qData.filesList&&e.qData.filesList.length>0&&e.qData.filesList.forEach(function(t){e.certList.push({text:t.fileName,image:t.fileUrl})})},e.imageUploaded=function(t){e.qData.head=t,n.disableButton(e,!1)},e.uploadImage=function(t){n.uploadImage(t,"propepo",e.imageUploaded,e)},e.$on("imageSelected",function(t,i){e.$apply(function(){e.uploadImage(i),n.disableButton(e,!0)})}),e.deletePortrait=function(){delete e.qData.head},e.addImageWithTitle=function(){var t=s.open({animation:!0,templateUrl:"tpl/modal/addPicsWithTitle.html",size:"lg",controller:"addVendorStaffCertFilesModalCtrl",backdrop:"static",resolve:{picsInfo:function(){return{targetTitle:"证明材料",image:"",imageText:""}}}});t.result.then(function(t){var i={text:t.imageText,image:t.image};e.certList.push(i)})},e.delPic=function(t){e.certList.splice(t,1)},e.getExistingData=function(){var t="admin/servicer/qryPersonById",i={id:e.staffInfo.id};a.post(t,i,e.fillExitingData)},e.save=function(t){var i,n=t;n.field=e.fieldArray.join(","),n.certificates=e.certificateArray.join(","),n.province=1e4*Math.round(n.city/1e4),n.worklife=r("date")(n.worklifeTime,"yyyy-MM-dd"),"0"===n.grade&&(delete n.worklife,delete n.introduction);var l;e.certList.length>0?(l="",e.certList.forEach(function(e,t){l+=(t>0?"|":"")+(e.text+","+e.image)}),n.files=l):n.files="","new"!==e.staffInfo.id?(i="admin/servicer/updatePerson",a.post(i,n,e.editStaffSaved)):(i="admin/servicer/addPerson",n.id=Number(e.staffInfo.servicerid),a.post(i,n,e.addStaffSaved))},"new"!==e.staffInfo.id&&e.getExistingData()}]),t.controller("addVendorStaffCertFilesModalCtrl",["$scope","picsInfo","$modalInstance","ycsApi","ycsUtil","Notification",function(e,t,i,a,n,l){e.picsInfo=t,e.uploadBtnDisabled=!1,e.imageUploaded=function(t){e.picsInfo.image=t,n.disableButton(e,!1)},e.uploadImage=function(t){n.uploadImage(t,"serlicense",e.imageUploaded)},e.$on("imageSelected",function(t,i,a){e.$apply(function(){e.uploadImage(i),n.disableButton(e,!0)})}),e.save=function(e){i.close(e)},e.cancel=function(){i.dismiss("cancel")}}])}(window.angular),function(e){"use strict";var t=e.module("backendApp");t.controller("vendorInfoCtrl",["$scope","ycsUtil","ycsApi","Notification","$modal",function(e,t,i,a,n){e.certList=[],e.photoList=[],e.legalidcardUploadBtnDisabled=!1,e.licenceUploadBtnDisabled=!1,e.organizationUploadBtnDisabled=!1,e.fillExistingData=function(){var i;e.qData.certificates&&e.qData.certificates.length>0&&(i=t.spliter(e.qData.certificates,"|"),i.forEach(function(i){if(i.length>0){var a=t.spliter(i,",");e.certList.push({text:a[0],image:a[1]})}})),e.qData.photos&&e.qData.photos.length>0&&(i=t.spliter(e.qData.photos,"|"),i.forEach(function(i){if(i.length>0){var a=t.spliter(i,",");e.photoList.push({text:a[0],image:a[1]})}}))},e.delPic=function(t,i){"certificate"===i?e.certList.splice(t,1):"photo"===i&&e.photoList.splice(t,1)},e.addImageWithTitle=function(t){var i;switch(t){case"certificate":i="资质证书";break;case"photo":i="实地环境";break;default:return}var a=n.open({animation:!0,templateUrl:"tpl/modal/addPicsWithTitle.html",size:"lg",controller:"addVendorInfoImageWithTitleCtrl",backdrop:"static",resolve:{picsInfo:function(){return{targetTitle:i,targetType:t,image:"",imageText:""}}}});a.result.then(function(t){var i={text:t.imageText,image:t.image};"certificate"===t.targetType?e.certList.push(i):"photo"===t.targetType&&e.photoList.push(i)})},e.imageUploaded=function(i,a){switch(i){case"legalPersonId":e.qData.legalidcard=a,t.disableButton(e,!1,"legalidcardUploadBtnDisabled");break;case"corpLicence":e.qData.licence=a,t.disableButton(e,!1,"licenceUploadBtnDisabled");break;case"corpOrgCert":e.qData.organization=a,t.disableButton(e,!1,"organizationUploadBtnDisabled");break;default:return}},e.uploadImage=function(i,a){t.uploadImage(i,"common",e.imageUploaded.bind(this,a),e)},e.$on("imageSelected",function(i,a,n){e.$apply(function(){e.uploadImage(a,n.id),"legalPersonId"===n.id?t.disableButton(e,!0,"legalidcardUploadBtnDisabled"):"corpLicence"===n.id?t.disableButton(e,!0,"licenceUploadBtnDisabled"):"corpOrgCert"===n.id&&t.disableButton(e,!0,"organizationUploadBtnDisabled")})}),e.dataSaved=function(){a.success("服务商信息保存成功！"),e.getExistingData()},e.save=function(t){var a,n="admin/servicer/modifyServicerLegalInfo",l=t;e.certList.length>0?(a="",e.certList.forEach(function(e,t){a+=(t>0?"|":"")+(e.text+","+e.image)}),l.certificates=a):l.certificates="",e.photoList.length>0?(a="",e.photoList.forEach(function(e,t){a+=(t>0?"|":"")+(e.text+","+e.image)}),l.photos=a):l.photos="",i.post(n,l,e.dataSaved)},e.fillExistingData()}]),t.controller("addVendorInfoImageWithTitleCtrl",["$scope","picsInfo","$modalInstance","ycsApi","ycsUtil","Notification",function(e,t,i,a,n,l){e.picsInfo=t,e.uploadBtnDisabled=!1,e.imageUploaded=function(t){e.picsInfo.image=t,n.disableButton(e,!1)},e.uploadImage=function(t){n.uploadImage(t,"serlicense",e.imageUploaded,e)},e.$on("imageSelected",function(t,i,a){e.$apply(function(){e.uploadImage(i),n.disableButton(e,!0)})}),e.save=function(e){i.close(e)},e.cancel=function(){i.dismiss("cancel")}}])}(window.angular),function(e){"use strict";var t=e.module("backendApp");t.controller("addCapacityModalCtrl",["$scope","capacityInfo","$modalInstance","ycsApi","Notification",function(t,i,a,n,l){t.currentStep=1,t.capacityInfo=i,t.invoiceTypeUnitOpts=[{value:"均可",label:"均可"},{value:"收据",label:"收据"},{value:"国税通用机打发票",label:"国税通用机打发票"},{value:"增值税普通发票",label:"增值税普通发票"},{value:"增值税专用发票",label:"增值税专用发票"},{value:"小规模普通发票",label:"小规模普通发票"}],t.cancel=function(){a.dismiss("cancel")},t.currentCataIndex=0,t.serviceItemList=[],t.currentSelectedNames=[],t.qData={},t.renderServiceItemList=function(e){t.serviceItemList=e.re},t.loadServiceItemList=function(){var e="admin/serviceItem/serviceAll",i={};n.post(e,i,t.renderServiceItemList)},t.switchCategory=function(e){t.currentCataIndex=e},t.checkIfSelected=function(e){return-1!==t.capacityInfo.select.indexOf(e)?!0:!1},t.toggleSelected=function(e,i){t.currentSelectedServiceItem=e,t.currentSelectedNames=[i]},t.addServiceItem=function(){var e="admin/servicer/getItemDetailById",i={itemid:t.currentSelectedServiceItem};n.post(e,i,t.serviceItemSaved)},t.prevStep=function(){t.currentStep=1},t.serviceItemSaved=function(e){t.currentStep=2,t.detail=e.re,t.detail.tempOptions=e.re.options},t.dataSaved=function(e){l.success("服务能力添加成功！"),t.loadServiceItemList(),a.close()},t.save=function(i){var a="admin/servicer/addItemSpecial",l=i;l.remark=i.advantage&&i.advantage.length>0?i.advantage:"",l.siid=t.currentSelectedServiceItem,l.srid=Number(t.capacityInfo.srid);var r=[];i.tempOptions&&i.tempOptions.length>0&&i.tempOptions.forEach(function(t){var i=e.extend([],t.option),a=[];i.forEach(function(e){e.selected&&a.push(e)}),t.option=a,r.push(t)});var s={};s.list=r,l.options=e.toJson(s),n.post(a,l,t.dataSaved)},t.loadServiceItemList()}])}(window.angular),function(e){"use strict";var t=e.module("backendApp");t.controller("exceptionDetailModalCtrl",["$scope","exceptionDetailInfo","$modalInstance","ycsApi","ycsUtil","Notification","$modal","$timeout",function(t,i,a,n,l,r,s,c){t.exceptionDetailInfo=i,t.srid=Number(i.data.srid),t.srsid=Number(i.data.srsid),t.siid=Number(i.data.siid),t.exceptionDetail={},t.currentAreaList=[],t.selectedCities=[],t.invoiceTypeUnitOpts=[{value:"均可",label:"均可"},{value:"收据",label:"收据"},{value:"国税通用机打发票",label:"国税通用机打发票"},{value:"增值税普通发票",label:"增值税普通发票"},{value:"增值税专用发票",label:"增值税专用发票"},{value:"小规模普通发票",label:"小规模普通发票"}],t.cancel=function(){a.dismiss("cancel")},t.renderSupportedArea=function(e){t.exceptionDetail.tempArea=e.re},t.getSupportedArea=function(){var e="admin/servicer/queryAreaByServicerId",i={servicerid:t.srid};n.post(e,i,t.renderSupportedArea)},t.checkIfSelected=function(e){return-1!==t.selectedCities.indexOf(e)?!0:!1},t.toggleSelected=function(e){var i=t.selectedCities.indexOf(e);-1===i?t.selectedCities.push(e):t.selectedCities.splice(i,1)},t.renderOptions=function(e){t.exceptionDetail=e.re,t.exceptionDetail.tempOptions=e.re.options},t.getOptions=function(){var e="admin/servicer/getStandard",i={srid:t.srid,srsid:t.srsid};n.post(e,i,t.renderOptions)},t.renderExceptionDetail=function(e){t.exceptionDetail=e.re,t.exceptionDetail.specialName=e.re.name,t.exceptionDetail.tempOptions=e.re.options,e.re.area.forEach(function(e){e.cityList[0].districtList.forEach(function(e){e.isSelected===!0&&t.selectedCities.push(e.city)})})},t.getExceptionDetail=function(){var e="admin/servicer/getDetail",i={srid:t.srid,srsid:t.srsid,name:t.exceptionDetailInfo.name};n.post(e,i,t.renderExceptionDetail)},t.renderAreaList=function(){t.currentAreaList=[],0!==t.currentAreas.length&&t.currentAreas.forEach(function(e){
t.currentAreaList.push({code:e,name:l.getAreaLabelByCode(e," "),checkAll:!1})})},t.appendAreaToList=function(e){t.currentAreaList.push({code:e,name:l.getAreaLabelByCode(e," "),selected:[],checkAll:!1})},t.addAvailableCity=function(){var e=s.open({animation:!0,templateUrl:"tpl/modal/vendor/addSupportArea.html",size:"md",controller:"selectVendorSupportAreaCtrl",backdrop:"static",resolve:{areaInfo:function(){return{districtCode:null}}}});e.result.then(function(e){var i=t.currentAreas.indexOf(e.districtCode);-1===i?(t.currentAreas.push(e.districtCode),t.isEmpty=!1,t.appendAreaToList(e.districtCode)):r.warning("此区域已存在，无需重复添加")})},t.removeArea=function(e){t.currentAreaList.splice(e,1),t.currentAreas.splice(e,1)},t.dataSaved=function(e){c(function(){a.close(i)},500)},t.save=function(i){var a="",l="admin/servicer/addSpecial";a+=t.selectedCities.join(",");var r=i;if(r.addCitys=a,r.srsid=t.srsid,r.siid=t.siid,r.srid=t.srid,r.options={},"add"===t.exceptionDetailInfo.func?r.addOrEdit="add":r.addOrEdit="edit",r.remark=r.advantage&&r.advantage.length>0?r.advantage:"",i.tempOptions&&i.tempOptions.length>0){var s={};s.list=i.tempOptions,r.options=e.toJson(s)}else delete r.options;delete r.id,n.post(l,r,t.dataSaved)},"add"===t.exceptionDetailInfo.func?t.getOptions():t.getExceptionDetail(),t.getSupportedArea()}]),t.controller("selectVendorSupportAreaCtrl",["$scope","areaInfo","$modalInstance","ycsUtil",function(e,t,i,a){e.areaInfo=t,e.ok=function(){i.close(t)},e.cancel=function(){i.dismiss("cancel")}}])}(window.angular),function(e){"use strict";var t=e.module("backendApp");t.controller("exceptionListModalCtrl",["$scope","exceptionListInfo","$modalInstance","ycsApi","Notification","$modal",function(t,i,a,n,l,r){t.exceptionListInfo=i,t.ok=function(){a.close()},t.cancel=function(){a.dismiss("cancel")},t.detail=e.extend({},i.data[0]),t.srid=t.detail.srid,t.renderList=function(e){t.detailList=e.re.list},t.getList=function(e){var i="admin/servicer/specialList",a={srid:t.srid,srsid:t.exceptionListInfo.srsid};n.post(i,a,t.renderList)},t.delException=function(e,i,a){var l="admin/servicer/delSpecial",r={srid:e,srsid:i,name:a};n.post(l,r,t.getList)},t.addException=function(i,a,n,l){var s=e.extend({},t.exceptionListInfo),c=r.open({animation:!0,templateUrl:"tpl/modal/vendor/editExceptionDetail.html",size:"xl",controller:"exceptionDetailModalCtrl",backdrop:"static",resolve:{exceptionDetailInfo:function(){return{srid:i,name:a,srsid:n,siid:t.exceptionListInfo.siid,func:l,data:s}}}});c.result.then(function(e){t.getList(e)})},t.getList()}])}(window.angular),function(e){"use strict";var t=e.module("backendApp");t.controller("serviceItemEditModalCtrl",["$scope","serviceItemInfo","$modalInstance","ycsApi","Notification",function(t,i,a,n,l){t.serviceItemInfo=i,t.isEdit=!1,t.cancel=function(){a.dismiss("cancel")},t.invoiceTypeUnitOpts=[{value:"均可",label:"均可"},{value:"收据",label:"收据"},{value:"国税通用机打发票",label:"国税通用机打发票"},{value:"增值税普通发票",label:"增值税普通发票"},{value:"增值税专用发票",label:"增值税专用发票"},{value:"小规模普通发票",label:"小规模普通发票"}],t.loadServiceItemList=function(){var e="admin/serviceItem/serviceAll",i={};n.post(e,i,t.renderServiceItemList)},t.dataSaved=function(e){l.success("服务能力编辑成功！"),t.loadServiceItemList(),a.close()},t.save=function(i){var a="admin/servicer/editItem",l=i;l.srid=t.serviceItemInfo.srid,l.srsid=t.serviceItemInfo.srsid,l.siid=t.serviceItemInfo.siid,l.remark=i.advantage&&i.advantage.length>0?i.advantage:"",l.invoicetype=i.invoicetype&&i.invoicetype.length>0?i.invoicetype:"";var r=[];i.tempOptions&&i.tempOptions.length>0&&i.tempOptions.forEach(function(t){var i=e.extend([],t.option),a=[];i.forEach(function(e){e.selected&&a.push(e)}),t.option=a,r.push(t)});var s={};s.list=r,l.options=e.toJson(s),l.status=Number(i.status),n.post(a,l,t.dataSaved)},t.fillExistingData=function(e){t.detail=e.re,t.detail.tempOptions=e.re.options,t.detail.name=t.serviceItemInfo.name},t.getExistingData=function(){var e="admin/servicer/getStandard",i={srid:t.serviceItemInfo.srid,srsid:t.serviceItemInfo.srsid};n.post(e,i,t.fillExistingData)},t.getExistingData()}])}(window.angular),function(e,t){"use strict";var i=e.module("backendApp");i.controller("supportAreaCtrl",["$scope","ycsUtil","ycsApi","Notification","$modal",function(e,t,i,a,n){e.isEmpty=!0,e.currentAreas=[],e.currentAreaList=[],e.renderAreaList=function(){e.currentAreaList=[],0!==e.currentAreas.length&&e.currentAreas.forEach(function(i){e.currentAreaList.push({code:i,name:t.getAreaLabelByCode(i," "),checkAll:!1})})},e.appendAreaToList=function(i){e.currentAreaList.push({code:i,name:t.getAreaLabelByCode(i," "),selected:[],checkAll:!0})},e.addAvailableCity=function(){var t=n.open({animation:!0,templateUrl:"tpl/modal/vendor/addSupportArea.html",size:"md",controller:"selectVendorSupportAreaCtrl",resolve:{areaInfo:function(){return{districtCode:null}}}});t.result.then(function(t){var i=e.currentAreas.indexOf(t.districtCode);-1===i?(e.currentAreas.push(t.districtCode),e.isEmpty=!1,e.appendAreaToList(t.districtCode)):a.warning("此区域已存在，无需重复添加")})},e.removeArea=function(t){e.currentAreaList.splice(t,1),e.currentAreas.splice(t,1)},e.supportAreaSaved=function(t){a.success("服务区域信息保存成功！"),e.initStep.current=1,e.switchTab("capacity")},e.save=function(t){var a="";t.forEach(function(e,t){a+=(t>0?",":"")+e.selected.join(",")});var n="admin/servicer/area",l={srid:Number(e.vendorId),addCitys:a};i.post(n,l,e.supportAreaSaved)}}]),i.controller("selectVendorSupportAreaCtrl",["$scope","areaInfo","$modalInstance","ycsUtil",function(e,t,i,a){e.areaInfo=t,e.ok=function(){i.close(t)},e.cancel=function(){i.dismiss("cancel")}}])}(window.angular,window.Neo),function(e){"use strict";var t=e.module("backendApp");t.controller("defaultPriceCtrl",["$scope","ycsUtil","ycsApi","Notification","$modal","$filter",function(t,i,a,n,l,r){t.invoiceTypeUnitOpts=[{value:"均可",label:"均可"},{value:"收据",label:"收据"},{value:"国税通用机打发票",label:"国税通用机打发票"},{value:"增值税普通发票",label:"增值税普通发票"},{value:"增值税专用发票",label:"增值税专用发票"},{value:"小规模普通发票",label:"小规模普通发票"}],t.getExistingData=function(){var e="admin/servicer/getItems",i={srid:t.vendorId};a.post(e,i,t.fillExitingData)},t.fillExitingData=function(e){t.qData=e.re.list,t.tempArray=[],t.qData.forEach(function(e){t.tempArray.push(e.price),e.invoicetype||(e.invoicetype="均可")})},t.priceTableSaved=function(){n.success("服务价格信息已保存！"),t.capacity.isInit=!1,t.initStep.current=0,t.switchTab("capacity")},t.save=function(i){var n="admin/servicer/itemPrice",l={};l.list=i,l.list&&l.list.length>0&&l.list.forEach(function(e){e.advantage=e.advantage&&e.advantage.length>0?e.advantage:""});var r={addCustom:e.toJson(l),srid:Number(t.vendorId)};a.post(n,r,t.priceTableSaved)},t.defaultPrice=function(e){t.qData[e].price=t.tempArray[e]},t.getExistingData()}])}(window.angular),function(e){"use strict";var t=e.module("backendApp");t.controller("defaultServiceItemCtrl",["$scope","ycsUtil","ycsApi","Notification","$modal","$filter",function(e,t,i,a,n,l){e.currentCataIndex=0,e.serviceItemList=[],e.selectedServiceItem=[],e.currentSelectedNames=[],e.qData={},e.subcatSelected=[],e.renderServiceItemList=function(t){e.serviceItemList=t.re},e.loadServiceItemList=function(){var t="admin/serviceItem/serviceAll",a={};i.post(t,a,e.renderServiceItemList)},e.switchCategory=function(t){e.currentCataIndex=t},e.toggleChildrenStatus=function(t,i,a){var n=e.subcatSelected[i][a]?!0:!1;t.forEach(function(t){var i=e.selectedServiceItem.indexOf(t.id);n&&-1===i?(e.selectedServiceItem.push(t.id),e.qData[t.id]=t.name):!n&&i>=0&&(e.selectedServiceItem.splice(i,1),delete e.qData[t.id]);var a=e.currentSelectedNames.indexOf(t.name);n&&-1===a?e.currentSelectedNames.push(t.name):!n&&a>=0&&e.currentSelectedNames.splice(a,1)})},e.checkIfSelected=function(t){return-1!==e.selectedServiceItem.indexOf(t)?!0:!1},e.toggleSelected=function(t,i){var a=e.selectedServiceItem.indexOf(t);-1===a?(e.selectedServiceItem.push(t),e.qData[t]=i):(e.selectedServiceItem.splice(a,1),delete e.qData[t]);var n=e.currentSelectedNames.indexOf(i);-1===n?e.currentSelectedNames.push(i):e.currentSelectedNames.splice(n,1)},e.serviceItemSaved=function(t){a.success("可提供的服务项信息保存成功！"),e.initStep.current=2,e.switchTab("capacity")},e.save=function(){var t="admin/servicer/addItem",a=[];Object.keys(e.qData).forEach(function(t){a.push(String(t+"-"+e.qData[t]))});var n={srid:Number(e.vendorId),addItems:a.join(",")};i.post(t,n,e.serviceItemSaved)},e.loadServiceItemList()}])}(window.angular);